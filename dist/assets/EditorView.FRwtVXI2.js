const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min.JuoVhvBY.js","assets/index.CIh8EjgO.js","assets/vendor.BZFRd1Xx.js","assets/index.D0Wx7yiH.css","assets/galleryStore.Bi-gAqB3.js"])))=>i.map(i=>d[i]);
import{u as ye,_ as $e,a as De,b as mt,c as gt,d as wt}from"./index.CIh8EjgO.js";import{r as $,d as Y,B as T,C as t,L as G,R as S,H as p,I as ie,K as M,p as Ue,F as Ee,G as Le,P as Ve,w as me,n as ge,q as bt,M as Fe,S as X,V as yt,y as te,U as ae,v as $t,Z as kt,Q as Pe,O as Ct}from"./vendor.BZFRd1Xx.js";function xt(){const{t:r}=ye(),n=$(!1),o=$(!1),s=$({x:0,y:0}),u=$({x:0,y:0}),v=$(!1),i=$(null),m=Y(()=>{if(!o.value)return null;const l=Math.min(s.value.x,u.value.x),d=Math.min(s.value.y,u.value.y),h=Math.abs(u.value.x-s.value.x),w=Math.abs(u.value.y-s.value.y);return{left:`${l}px`,top:`${d}px`,width:`${h}px`,height:`${w}px`}});function q(){return n.value&&o.value?"finish":(n.value=!n.value,n.value?(console.log("Crop-Modus aktiviert: Ziehen Sie einen Bereich auf"),window.$toast&&window.$toast.info(r("toast.crop.modeActivated"))):P(),n.value?"activated":"deactivated")}function P(){o.value=!1,s.value={x:0,y:0},u.value={x:0,y:0}}function I(l,d){o.value=!0,s.value={x:l,y:d},u.value={x:l,y:d}}function R(l,d){u.value={x:l,y:d}}async function O(l){const{canvas:d,currentImage:h,filters:w,imageStore:x}=l;if(!o.value||!d.value||!h.value)return;o.value=!1;const B=Math.min(s.value.x,u.value.x),y=Math.min(s.value.y,u.value.y),j=Math.abs(u.value.x-s.value.x),H=Math.abs(u.value.y-s.value.y);if(j<10||H<10){P(),console.warn("Crop-Bereich zu klein (mindestens 10x10 Pixel)"),window.$toast&&window.$toast.warning(r("toast.crop.tooSmall"),r("toast.crop.tooSmallDetail"));return}try{if(!v.value){const V=document.createElement("canvas"),F=V.getContext("2d");V.width=d.value.width,V.height=d.value.height;const de=`
          brightness(${w.value.brightness}%)
          contrast(${w.value.contrast}%)
          saturate(${w.value.saturation}%)
          blur(${w.value.blur}px)
          hue-rotate(${w.value.hue}deg)
        `;F.filter=de,F.drawImage(h.value,0,0,V.width,V.height),F.filter="none",i.value={dataUrl:V.toDataURL("image/png"),width:d.value.width,height:d.value.height,filters:{...w.value},texts:x?[...x.texts]:[]},console.log("Original-Bild (ohne Texte) vor Crop gespeichert")}const z=B,E=y,g=j,Q=H;if(console.log(`Crop-Bereich: x=${z}, y=${E}, w=${g}, h=${Q}`),z<0||E<0||z+g>d.value.width||E+Q>d.value.height)throw console.error(`Crop au√üerhalb: Canvas=${d.value.width}x${d.value.height}, Crop=${z},${E},${g},${Q}`),window.$toast&&window.$toast.error(r("toast.crop.outOfBounds")),new Error("Crop-Bereich muss vollst√§ndig auf dem Bild liegen");const L=document.createElement("canvas"),oe=L.getContext("2d");L.width=d.value.width,L.height=d.value.height;const Z=`
        brightness(${w.value.brightness}%)
        contrast(${w.value.contrast}%)
        saturate(${w.value.saturation}%)
        blur(${w.value.blur}px)
        hue-rotate(${w.value.hue}deg)
      `;oe.filter=Z,oe.drawImage(h.value,0,0,L.width,L.height),oe.filter="none";const A=document.createElement("canvas"),re=A.getContext("2d");if(A.width=Math.max(1,Math.round(g)),A.height=Math.max(1,Math.round(Q)),re.imageSmoothingEnabled=!0,re.imageSmoothingQuality="high",re.drawImage(L,Math.max(0,z),Math.max(0,E),Math.min(g,L.width-z),Math.min(Q,L.height-E),0,0,A.width,A.height),x&&x.texts){const V=[];x.texts.forEach(F=>{F.x<z||F.x>z+g||F.y<E||F.y>E+Q?V.push(F.id):x.updateText(F.id,{x:F.x-z,y:F.y-E})}),V.forEach(F=>{x.deleteText(F)}),console.log(`Text-Positionen angepasst. ${V.length} Texte entfernt.`)}const ue=A.toDataURL("image/png"),_=new Image;_.onload=()=>{l.onCropComplete&&l.onCropComplete(_,A.width,A.height),v.value=!0,console.log(`Bild zugeschnitten: ${A.width}√ó${A.height}px`),window.$toast&&window.$toast.success(r("toast.crop.success",{width:A.width,height:A.height}))},_.src=ue,n.value=!1,P()}catch(z){console.error("Crop-Fehler:",z),window.$toast&&window.$toast.error(r("toast.crop.error"),z.message),P()}}function K(l){if(!v.value||!i.value){console.warn("Kein gespeichertes Bild zum Wiederherstellen vorhanden"),window.$toast&&window.$toast.warning(r("toast.crop.undoNotAvailable"));return}if(!confirm("M√∂chten Sie den Zuschnitt r√ºckg√§ngig machen und das Original-Bild wiederherstellen?"))return;console.log("Stelle Original-Bild vor Crop wieder her...");const{imageStore:h}=l,w=new Image;w.onload=()=>{h&&i.value.texts&&(h.texts.splice(0,h.texts.length),h.texts.splice(0,0,...i.value.texts),console.log(`‚úÖ ${h.texts.length} Texte wiederhergestellt`)),l.onUndoComplete&&l.onUndoComplete(w,i.value),v.value=!1,i.value=null,console.log("‚úÖ Original-Bild erfolgreich wiederhergestellt"),window.$toast&&window.$toast.success(r("toast.crop.undoSuccess"))},w.src=i.value.dataUrl}function J(){n.value&&(n.value=!1,P()),v.value=!1,i.value=null}function W(l){return n.value?(I(l.x,l.y),!0):!1}function D(l){return o.value?(R(l.x,l.y),!0):!1}function U(){return!!o.value}return{cropMode:n,cropping:o,hasCropped:v,cropOverlayStyle:m,toggleCropMode:q,finishCrop:O,undoCrop:K,resetCropState:J,clearCropSelection:P,handleMouseDown:W,handleMouseMove:D,handleMouseUp:U}}function Bt(){const r=$({opacity:100,rotation:0,scale:100,flipHorizontal:!1,flipVertical:!1,borderRadius:0,borderWidth:0,borderColor:"#000000"}),n=Y(()=>{const l=[];r.value.rotation!==0&&l.push(`rotate(${r.value.rotation}deg)`);const d=r.value.scale/100;d!==1&&l.push(`scale(${d})`);const h=r.value.flipHorizontal?-1:1,w=r.value.flipVertical?-1:1;return(h!==1||w!==1)&&l.push(`scale(${h}, ${w})`),l.length>0?l.join(" "):"none"});function o(l){r.value.opacity=Math.max(0,Math.min(100,l))}function s(l){for(r.value.rotation=l;r.value.rotation>180;)r.value.rotation-=360;for(;r.value.rotation<-180;)r.value.rotation+=360}function u(l){s(r.value.rotation+l)}function v(){u(90)}function i(){u(-90)}function m(){u(180)}function q(){r.value.flipHorizontal=!r.value.flipHorizontal}function P(){r.value.flipVertical=!r.value.flipVertical}function I(l){r.value.scale=Math.max(10,Math.min(200,l))}function R(l){r.value.borderRadius=Math.max(0,Math.min(50,l))}function O(l){r.value.borderWidth=Math.max(0,Math.min(20,l))}function K(l){r.value.borderColor=l}function J(l,d){if(!l||!d)return;d.globalAlpha=r.value.opacity/100;const h=l.width/2,w=l.height/2;if(d.save(),d.translate(h,w),r.value.rotation!==0){const B=r.value.rotation*Math.PI/180;d.rotate(B)}const x=r.value.scale/100;if(x!==1&&d.scale(x,x),r.value.flipHorizontal||r.value.flipVertical){const B=r.value.flipHorizontal?-1:1,y=r.value.flipVertical?-1:1;d.scale(B,y)}return d.translate(-h,-w),()=>{d.restore(),d.globalAlpha=1}}async function W(l,d){return!l||!d?null:new Promise((h,w)=>{try{const x=r.value.rotation*Math.PI/180,B=Math.abs(Math.cos(x)),y=Math.abs(Math.sin(x)),j=r.value.scale/100,H=Math.round((d.width*B+d.height*y)*j),z=Math.round((d.width*y+d.height*B)*j),E=document.createElement("canvas");E.width=H,E.height=z;const g=E.getContext("2d");if(g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.globalAlpha=r.value.opacity/100,g.save(),g.translate(H/2,z/2),r.value.rotation!==0&&g.rotate(x),j!==1&&g.scale(j,j),r.value.flipHorizontal||r.value.flipVertical){const oe=r.value.flipHorizontal?-1:1,Z=r.value.flipVertical?-1:1;g.scale(oe,Z)}g.drawImage(l,-d.width/2,-d.height/2,d.width,d.height),g.restore();const Q=E.toDataURL("image/png"),L=new Image;L.onload=()=>{h({img:L,width:H,height:z})},L.onerror=()=>{w(new Error("Fehler beim Laden des transformierten Bildes"))},L.src=Q}catch(x){w(x)}})}function D(){r.value={opacity:100,rotation:0,scale:100,flipHorizontal:!1,flipVertical:!1,borderRadius:0,borderWidth:0,borderColor:"#000000"}}const U=Y(()=>r.value.opacity!==100||r.value.rotation!==0||r.value.scale!==100||r.value.flipHorizontal||r.value.flipVertical||r.value.borderRadius!==0||r.value.borderWidth!==0);return{transforms:r,transformStyle:n,hasTransforms:U,setOpacity:o,setRotation:s,rotate:u,rotate90:v,rotate90Counter:i,rotate180:m,flipHorizontal:q,flipVertical:P,setScale:I,setBorderRadius:R,setBorderWidth:O,setBorderColor:K,applyToCanvas:J,applyPermanently:W,resetTransforms:D}}const Mt={class:"transform-panel"},Tt={class:"panel-section"},St={class:"panel-section"},It={class:"control-group"},zt={class:"value"},Ft=["value"],Pt={class:"control-group"},Rt={class:"value"},Dt=["value"],Ut={class:"button-group"},Et=["title"],Lt=["title"],Vt=["title"],qt={class:"button-group"},At=["title"],Ot=["title"],jt={class:"control-group"},Wt={class:"value"},Ht=["value"],Nt={class:"control-group"},Gt={class:"value"},Kt=["value"],Qt={class:"control-group"},Xt={class:"value"},Yt=["value"],Jt={key:0,class:"color-picker-group"},Zt=["value"],_t={class:"color-label"},ea=["title"],ta={__name:"TransformPanel",props:{cropMode:{type:Boolean,required:!0},hasCropped:{type:Boolean,required:!0},transforms:{type:Object,required:!0},hasTransforms:{type:Boolean,default:!1}},emits:["toggle-crop","undo-crop","update:opacity","update:rotation","update:scale","update:border-radius","update:border-width","update:border-color","rotate-90","rotate-90-counter","rotate-180","flip-horizontal","flip-vertical","apply-transforms","reset-transforms"],setup(r){return(n,o)=>(M(),T("aside",Mt,[t("div",Tt,[t("h3",null,[o[15]||(o[15]=t("i",{class:"fas fa-crop"},null,-1)),S(" "+p(n.$t("transform.crop.title")),1)]),t("button",{class:ie(["transform-btn",{active:r.cropMode}]),onClick:o[0]||(o[0]=s=>n.$emit("toggle-crop"))},[t("i",{class:ie(r.cropMode?"fas fa-check":"fas fa-crop")},null,2),t("span",null,p(r.cropMode?n.$t("transform.crop.confirm"):n.$t("transform.crop.button")),1)],2),r.hasCropped?(M(),T("button",{key:0,class:"transform-btn undo-btn",onClick:o[1]||(o[1]=s=>n.$emit("undo-crop"))},[o[16]||(o[16]=t("i",{class:"fas fa-undo"},null,-1)),t("span",null,p(n.$t("transform.crop.undo")),1)])):G("",!0)]),t("div",St,[t("h3",null,[o[17]||(o[17]=t("i",{class:"fas fa-magic"},null,-1)),S(" "+p(n.$t("transform.title")),1)]),t("div",It,[t("label",null,[o[18]||(o[18]=t("i",{class:"fas fa-adjust"},null,-1)),S(" "+p(n.$t("transform.opacity"))+" ",1),t("span",zt,p(r.transforms.opacity)+"%",1)]),t("input",{type:"range",min:"0",max:"100",value:r.transforms.opacity,onInput:o[2]||(o[2]=s=>n.$emit("update:opacity",Number(s.target.value))),class:"slider"},null,40,Ft)]),t("div",Pt,[t("label",null,[o[19]||(o[19]=t("i",{class:"fas fa-redo"},null,-1)),S(" "+p(n.$t("transform.rotation"))+" ",1),t("span",Rt,p(r.transforms.rotation)+"¬∞",1)]),t("input",{type:"range",min:"-180",max:"180",value:r.transforms.rotation,onInput:o[3]||(o[3]=s=>n.$emit("update:rotation",Number(s.target.value))),class:"slider"},null,40,Dt)]),t("div",Ut,[t("button",{class:"quick-btn",onClick:o[4]||(o[4]=s=>n.$emit("rotate-90-counter")),title:n.$t("transform.rotationTooltip.counterClockwise")},[...o[20]||(o[20]=[t("i",{class:"fas fa-undo"},null,-1),S(" 90¬∞ ",-1)])],8,Et),t("button",{class:"quick-btn",onClick:o[5]||(o[5]=s=>n.$emit("rotate-180")),title:n.$t("transform.rotationTooltip.rotate180")},[...o[21]||(o[21]=[t("i",{class:"fas fa-sync"},null,-1),S(" 180¬∞ ",-1)])],8,Lt),t("button",{class:"quick-btn",onClick:o[6]||(o[6]=s=>n.$emit("rotate-90")),title:n.$t("transform.rotationTooltip.clockwise")},[...o[22]||(o[22]=[t("i",{class:"fas fa-redo"},null,-1),S(" 90¬∞ ",-1)])],8,Vt)]),t("div",qt,[t("button",{class:ie(["quick-btn",{active:r.transforms.flipHorizontal}]),onClick:o[7]||(o[7]=s=>n.$emit("flip-horizontal")),title:n.$t("transform.flip.horizontalTooltip")},[o[23]||(o[23]=t("i",{class:"fas fa-arrows-alt-h"},null,-1)),S(" "+p(n.$t("transform.flip.horizontal")),1)],10,At),t("button",{class:ie(["quick-btn",{active:r.transforms.flipVertical}]),onClick:o[8]||(o[8]=s=>n.$emit("flip-vertical")),title:n.$t("transform.flip.verticalTooltip")},[o[24]||(o[24]=t("i",{class:"fas fa-arrows-alt-v"},null,-1)),S(" "+p(n.$t("transform.flip.vertical")),1)],10,Ot)]),t("div",jt,[t("label",null,[o[25]||(o[25]=t("i",{class:"fas fa-search-plus"},null,-1)),S(" "+p(n.$t("transform.zoom"))+" ",1),t("span",Wt,p(r.transforms.scale)+"%",1)]),t("input",{type:"range",min:"10",max:"200",value:r.transforms.scale,onInput:o[9]||(o[9]=s=>n.$emit("update:scale",Number(s.target.value))),class:"slider"},null,40,Ht)]),t("div",Nt,[t("label",null,[o[26]||(o[26]=t("i",{class:"fas fa-circle"},null,-1)),S(" "+p(n.$t("transform.borderRadius"))+" ",1),t("span",Gt,p(r.transforms.borderRadius)+"px",1)]),t("input",{type:"range",min:"0",max:"50",value:r.transforms.borderRadius,onInput:o[10]||(o[10]=s=>n.$emit("update:border-radius",Number(s.target.value))),class:"slider"},null,40,Kt)]),t("div",Qt,[t("label",null,[o[27]||(o[27]=t("i",{class:"fas fa-border-style"},null,-1)),S(" "+p(n.$t("transform.border"))+" ",1),t("span",Xt,p(r.transforms.borderWidth)+"px",1)]),t("input",{type:"range",min:"0",max:"20",value:r.transforms.borderWidth,onInput:o[11]||(o[11]=s=>n.$emit("update:border-width",Number(s.target.value))),class:"slider"},null,40,Yt),r.transforms.borderWidth>0?(M(),T("div",Jt,[t("input",{type:"color",value:r.transforms.borderColor,onInput:o[12]||(o[12]=s=>n.$emit("update:border-color",s.target.value)),class:"color-input"},null,40,Zt),t("span",_t,p(n.$t("transform.borderColor")),1)])):G("",!0)]),r.hasTransforms?(M(),T("button",{key:0,class:"transform-btn apply-btn",onClick:o[13]||(o[13]=s=>n.$emit("apply-transforms")),title:n.$t("transform.applyTooltip")},[o[28]||(o[28]=t("i",{class:"fas fa-check-circle"},null,-1)),t("span",null,p(n.$t("transform.apply")),1)],8,ea)):G("",!0),r.hasTransforms?(M(),T("button",{key:1,class:"transform-btn reset-btn",onClick:o[14]||(o[14]=s=>n.$emit("reset-transforms"))},[o[29]||(o[29]=t("i",{class:"fas fa-undo-alt"},null,-1)),t("span",null,p(n.$t("transform.reset")),1)])):G("",!0)])]))}},aa=$e(ta,[["__scopeId","data-v-c66edaa7"]]),oa={class:"filter-presets"},na={class:"presets-header"},sa={class:"presets-actions"},ia=["title"],ra=["title"],la=["title"],ua={class:"presets-grid"},da=["onClick","title"],ca={class:"preset-icon"},fa={class:"preset-name"},pa=["onClick","title"],va={__name:"FilterPresets",props:{filters:{type:Object,required:!0}},emits:["apply-preset","filters-changed"],setup(r,{expose:n,emit:o}){const{t:s}=ye(),u=r,v=o,i=$(null),m=$([]),q=[{id:"normal",name:"Normal",icon:"üì∑",description:"Original",filters:{brightness:100,contrast:100,saturation:100,blur:0,hue:0}},{id:"vintage",name:"Vintage",icon:"üì∏",description:"Retro-Look",filters:{brightness:110,contrast:90,saturation:70,blur:0,hue:20}},{id:"bw",name:"Schwarz/Wei√ü",icon:"‚ö´",description:"Klassisch",filters:{brightness:100,contrast:120,saturation:0,blur:0,hue:0}},{id:"vivid",name:"Lebendig",icon:"üåà",description:"Kr√§ftige Farben",filters:{brightness:105,contrast:120,saturation:150,blur:0,hue:0}},{id:"sepia",name:"Sepia",icon:"üìú",description:"Nostalgischer Braun-Ton",filters:{brightness:110,contrast:95,saturation:60,blur:0,hue:30}},{id:"dramatic",name:"Dramatisch",icon:"üé≠",description:"Hoher Kontrast",filters:{brightness:90,contrast:160,saturation:120,blur:0,hue:0}},{id:"soft",name:"Soft",icon:"üå∏",description:"Weiche T√∂ne",filters:{brightness:115,contrast:80,saturation:90,blur:0,hue:0}},{id:"hdr",name:"HDR",icon:"üíé",description:"Sehr hohe S√§ttigung",filters:{brightness:110,contrast:140,saturation:180,blur:0,hue:0}},{id:"cold",name:"Kalt",icon:"‚ùÑÔ∏è",description:"K√ºhle T√∂ne",filters:{brightness:100,contrast:100,saturation:100,blur:0,hue:200}},{id:"warm",name:"Warm",icon:"üî•",description:"Warme T√∂ne",filters:{brightness:110,contrast:100,saturation:120,blur:0,hue:30}},{id:"sunset",name:"Sunset",icon:"üåÖ",description:"Orange/Rosa Sonnenuntergang",filters:{brightness:115,contrast:105,saturation:130,blur:0,hue:15}},{id:"ocean",name:"Ocean",icon:"üåä",description:"Blaue Meer-Stimmung",filters:{brightness:100,contrast:110,saturation:120,blur:0,hue:200}},{id:"cinematic",name:"Cinematic",icon:"üé¨",description:"Film-Look",filters:{brightness:95,contrast:125,saturation:110,blur:0,hue:10}},{id:"faded",name:"Faded",icon:"üëª",description:"Verblasst",filters:{brightness:120,contrast:70,saturation:70,blur:0,hue:0}}],P=Y(()=>[...q,...m.value]);function I(l){i.value=l.id,v("apply-preset",l),window.$toast&&window.$toast.success(s("toast.presets.applied",{name:l.name}))}function R(){const l=prompt(s("presets.dialogs.saveName"),s("presets.dialogs.defaultName"));if(!l)return;const d=prompt(s("presets.dialogs.saveDescription"),""),h={id:"custom_"+Date.now(),name:l.trim(),icon:"‚≠ê",description:(d==null?void 0:d.trim())||s("presets.custom"),filters:{...u.filters},custom:!0};m.value.push(h),W(),window.$toast&&window.$toast.success(s("toast.presets.saved",{name:l.trim()}))}function O(l){if(!confirm(s("presets.dialogs.confirmDelete")))return;const d=m.value.findIndex(h=>h.id===l);if(d!==-1){const h=m.value[d];m.value.splice(d,1),W(),i.value===l&&(i.value=null),window.$toast&&window.$toast.success(s("toast.presets.deleted",{name:h.name}))}}function K(){if(m.value.length===0){window.$toast&&window.$toast.warning(s("toast.presets.noCustomPresets"));return}const l=JSON.stringify(m.value,null,2),d=new Blob([l],{type:"application/json"}),h=URL.createObjectURL(d),w=document.createElement("a");w.href=h,w.download="filter-presets.json",w.click(),URL.revokeObjectURL(h),window.$toast&&window.$toast.success(s("toast.presets.exported",{count:m.value.length}))}function J(){const l=document.createElement("input");l.type="file",l.accept=".json",l.onchange=async d=>{const h=d.target.files[0];if(h)try{const w=await h.text(),x=JSON.parse(w);if(!Array.isArray(x))throw new Error(s("presets.errors.invalidFormat"));m.value=[...m.value,...x],W(),window.$toast&&window.$toast.success(s("toast.presets.imported",{count:x.length}))}catch(w){console.error("Import-Fehler:",w),window.$toast&&window.$toast.error(s("toast.presets.importError"),w.message)}},l.click()}function W(){try{localStorage.setItem("bildkonverter_filterPresets",JSON.stringify(m.value))}catch(l){console.error("Fehler beim Speichern:",l)}}function D(){try{const l=localStorage.getItem("bildkonverter_filterPresets");l&&(m.value=JSON.parse(l))}catch(l){console.error("Fehler beim Laden:",l)}}Ue(()=>{D()});function U(){i.value=null}return n({resetActivePreset:U}),(l,d)=>(M(),T("div",oa,[t("div",na,[t("h3",null,p(l.$t("presets.title")),1),t("div",sa,[t("button",{onClick:R,class:"action-btn",title:l.$t("presets.actions.save")},[...d[0]||(d[0]=[t("i",{class:"fas fa-save"},null,-1)])],8,ia),t("button",{onClick:J,class:"action-btn",title:l.$t("presets.actions.import")},[...d[1]||(d[1]=[t("i",{class:"fas fa-file-import"},null,-1)])],8,ra),t("button",{onClick:K,class:"action-btn",title:l.$t("presets.actions.export")},[...d[2]||(d[2]=[t("i",{class:"fas fa-file-export"},null,-1)])],8,la)])]),t("div",ua,[(M(!0),T(Ee,null,Le(P.value,h=>(M(),T("button",{key:h.id,class:ie(["preset-btn",{active:i.value===h.id}]),onClick:w=>I(h),title:h.description},[t("span",ca,p(h.icon),1),t("span",fa,p(l.$t(`presets.${h.id}`,h.name)),1),h.custom?(M(),T("button",{key:0,onClick:Ve(w=>O(h.id),["stop"]),class:"delete-btn",title:l.$t("presets.actions.delete")},[...d[3]||(d[3]=[t("i",{class:"fas fa-times"},null,-1)])],8,pa)):G("",!0)],10,da))),128))])]))}},ha=$e(va,[["__scopeId","data-v-329b7b48"]]),ma=()=>"/bildkonverter/api",we=ma(),Re={convertImage:`${we}/convert-image`,uploadImage:`${we}/upload`,getFormats:`${we}/formats`};class fe{static async convertImage(n,o,s,u={}){const v=new FormData;v.append("image",n,"canvas_image.png"),v.append("format",o),v.append("filename",s),u.quality&&v.append("quality",u.quality);try{const i=await fetch(Re.convertImage,{method:"POST",body:v});if(!i.ok){const m=await i.json().catch(()=>({}));throw new Error(m.message||`Server-Fehler: ${i.status}`)}return await i.blob()}catch(i){throw console.error("API-Fehler bei Bildkonvertierung:",i),i}}static async checkBackendAvailability(){try{return(await fetch(Re.getFormats,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch(n){return console.warn("Backend nicht erreichbar:",n),!1}}}const le={png:{name:"PNG",description:"Verlustfrei, mit Transparenz",extension:"png",mimeType:"image/png",supportsQuality:!1,requiresBackend:!1,maxSize:"500MB",recommended:"Logos, UI, Screenshots",icon:"üñºÔ∏è"},jpeg:{name:"JPEG",description:"Verlustbehaftet, kleine Dateigr√∂√üe",extension:"jpg",mimeType:"image/jpeg",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Fotos, Bilder",icon:"üì∑"},jpg:{name:"JPG",description:"Verlustbehaftet, kleine Dateigr√∂√üe",extension:"jpg",mimeType:"image/jpeg",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Fotos, Bilder",icon:"üì∑"},webp:{name:"WebP",description:"Modern, effizient, klein",extension:"webp",mimeType:"image/webp",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Web, moderne Browser",icon:"üåê"},tiff:{name:"TIFF",description:"Professionelles Format",extension:"tiff",mimeType:"image/tiff",supportsQuality:!1,requiresBackend:!0,maxSize:"1GB",recommended:"Druck, Archivierung",icon:"üìÑ"},tif:{name:"TIF",description:"Professionelles Format",extension:"tif",mimeType:"image/tiff",supportsQuality:!1,requiresBackend:!0,maxSize:"1GB",recommended:"Druck, Archivierung",icon:"üìÑ"},heif:{name:"HEIF",description:"Modern, hohe Effizienz",extension:"heif",mimeType:"image/heif",supportsQuality:!0,requiresBackend:!0,maxSize:"500MB",recommended:"Fotos (neuere Ger√§te)",icon:"üì±"},heic:{name:"HEIC",description:"Modern, hohe Effizienz (Apple)",extension:"heic",mimeType:"image/heic",supportsQuality:!0,requiresBackend:!0,maxSize:"500MB",recommended:"iOS, macOS",icon:"üçé"},gif:{name:"GIF",description:"Einzelbild-GIF",extension:"gif",mimeType:"image/gif",supportsQuality:!1,requiresBackend:!0,maxSize:"500MB",recommended:"Kompatibilit√§t, Retro",icon:"üé®"},pdf:{name:"PDF",description:"Dokument, A4-Format",extension:"pdf",mimeType:"application/pdf",supportsQuality:!1,requiresBackend:!1,maxSize:"500MB",recommended:"Dokumente, Druck",icon:"üìë"}},pe=Object.keys(le);pe.filter(r=>!le[r].requiresBackend);pe.filter(r=>le[r].requiresBackend);class ga{constructor(){this.jsPDF=null,this.backendAvailable=!1,this.initializePDF()}async initializePDF(){try{const{jsPDF:n}=await De(async()=>{const{jsPDF:o}=await import("./jspdf.es.min.JuoVhvBY.js").then(s=>s.j);return{jsPDF:o}},__vite__mapDeps([0,1,2,3]));return this.jsPDF=n,console.log("‚úÖ jsPDF erfolgreich geladen"),!0}catch(n){return console.warn("‚ö†Ô∏è jsPDF konnte nicht geladen werden:",n),!1}}async checkBackend(){return this.backendAvailable=await fe.checkBackendAvailability(),this.backendAvailable}async exportImage(n,o,s="image",u={}){if(!n||!(n instanceof HTMLCanvasElement))throw new Error("G√ºltiges Canvas-Element erforderlich");if(o=o.toLowerCase(),!pe.includes(o))throw new Error(`Format ${o} wird nicht unterst√ºtzt`);this.validateCanvas(n);const v={quality:u.quality||.92,texts:u.texts||[],...u};try{switch(o){case"png":return await this.exportPNG(n,s,v);case"jpeg":case"jpg":return await this.exportJPEG(n,s,v);case"webp":return await this.exportWebP(n,s,v);case"tiff":case"tif":return await this.exportTIFF(n,s,v);case"heif":case"heic":return await this.exportHEIF(n,s,v);case"gif":return await this.exportGIF(n,s,v);case"pdf":return await this.exportPDF(n,s,v);default:return await this.exportPNG(n,s,v)}}catch(i){throw console.error(`Export-Fehler (${o}):`,i),new Error(`Export fehlgeschlagen: ${i.message}`)}}validateCanvas(n){const o=n.width*n.height,s=5e4*5e4;if(o>s){const u=Math.sqrt(s).toFixed(0);throw new Error(`Bild zu gro√ü f√ºr Export. Maximum: ${u}x${u} Pixel`)}o>1e4*1e4&&console.warn("‚ö†Ô∏è Sehr gro√ües Bild - Export kann l√§nger dauern")}async exportPNG(n,o,s){const u=n.toDataURL("image/png");return this.downloadDataURL(u,`${o}.png`),{success:!0,format:"png",filename:`${o}.png`,size:this.getDataURLSize(u)}}async exportJPEG(n,o,s){const u=s.quality||.92,i=this.addWhiteBackground(n).toDataURL("image/jpeg",u);return this.downloadDataURL(i,`${o}.jpg`),{success:!0,format:"jpeg",filename:`${o}.jpg`,quality:Math.round(u*100),size:this.getDataURLSize(i)}}async exportWebP(n,o,s){if(!this.supportsWebP())throw new Error("WebP wird von diesem Browser nicht unterst√ºtzt");const u=s.quality||.85,v=n.toDataURL("image/webp",u);return this.downloadDataURL(v,`${o}.webp`),{success:!0,format:"webp",filename:`${o}.webp`,quality:Math.round(u*100),size:this.getDataURLSize(v)}}async exportTIFF(n,o,s){const u=await this.canvasToBlob(n,"image/png"),v=await fe.convertImage(u,"tiff",o,s);return this.downloadBlob(v,`${o}.tiff`),{success:!0,format:"tiff",filename:`${o}.tiff`,size:this.formatBytes(v.size)}}async exportHEIF(n,o,s){const u=await this.canvasToBlob(n,"image/png"),v=await fe.convertImage(u,"heif",o,s);return this.downloadBlob(v,`${o}.heif`),{success:!0,format:"heif",filename:`${o}.heif`,quality:s.quality?Math.round(s.quality*100):null,size:this.formatBytes(v.size)}}async exportGIF(n,o,s){const u=await this.canvasToBlob(n,"image/png"),v=await fe.convertImage(u,"gif",o,s);return this.downloadBlob(v,`${o}.gif`),{success:!0,format:"gif",filename:`${o}.gif`,size:this.formatBytes(v.size)}}async exportPDF(n,o,s){if(!this.jsPDF&&(await this.initializePDF(),!this.jsPDF))throw new Error("PDF-Export nicht verf√ºgbar - jsPDF konnte nicht geladen werden");const u=this.calculatePDFDimensions(n),v=new this.jsPDF({orientation:u.orientation,unit:"mm",format:u.format,compress:!0});v.setProperties({title:o,subject:"Konvertiertes Bild",author:"Vue Bildkonverter",creator:"KodiniTools"});const i=n.toDataURL("image/jpeg",.92);return v.addImage(i,"JPEG",u.x,u.y,u.width,u.height,void 0,"FAST"),v.save(`${o}.pdf`),{success:!0,format:"pdf",filename:`${o}.pdf`,pages:1,orientation:u.orientation}}calculatePDFDimensions(n){const o=n.width/n.height;let s,u,v,i,m,q;const P=210,I=297;return o>1?(u="landscape",s="a4",v=I-20,i=v/o,m=10,q=(P-i)/2):(u="portrait",s="a4",v=P-20,i=v/o,m=10,q=(I-i)/2,i>I-20&&(i=I-20,v=i*o,m=(P-v)/2,q=10)),{orientation:u,format:s,width:v,height:i,x:m,y:q}}addWhiteBackground(n){const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const s=o.getContext("2d");return s.fillStyle="#FFFFFF",s.fillRect(0,0,o.width,o.height),s.drawImage(n,0,0),o}canvasToBlob(n,o="image/png",s=.92){return new Promise((u,v)=>{n.toBlob(i=>{i?u(i):v(new Error("Canvas-zu-Blob-Konvertierung fehlgeschlagen"))},o,s)})}downloadDataURL(n,o){const s=document.createElement("a");s.download=o,s.href=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}downloadBlob(n,o){const s=URL.createObjectURL(n),u=document.createElement("a");u.download=o,u.href=s,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),setTimeout(()=>URL.revokeObjectURL(s),1e3)}getDataURLSize(n){const o=n.split(",")[1],s=Math.round(o.length*3/4);return this.formatBytes(s)}formatBytes(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(2)} MB`}supportsWebP(){const n=document.createElement("canvas");n.width=1,n.height=1;try{return n.toDataURL("image/webp").startsWith("data:image/webp")}catch{return!1}}}let be=null;function wa(){return be||(be=new ga),be}async function ba(r,n,o,s){return await wa().exportImage(r,n,o,s)}function ya(r){return le[r.toLowerCase()]||null}const $a={class:"editor-view"},ka={class:"editor-container"},Ca={class:"toolbar"},xa={class:"toolbar-section"},Ba={class:"toolbar-section"},Ma=["disabled"],Ta=["disabled"],Sa=["disabled"],Ia=["disabled","title"],za=["disabled"],Fa={class:"editor-main"},Pa={class:"sidebar"},Ra={class:"sidebar-section"},Da=["value"],Ua={key:0,class:"format-info"},Ea={class:"format-description"},La={class:"format-badge"},Va={key:0,class:"backend-badge",title:"Ben√∂tigt Backend-API"},qa={key:1,class:"filter-control"},Aa={class:"sidebar-section"},Oa={class:"filter-control"},ja={class:"filter-control"},Wa={class:"filter-control"},Ha={class:"filter-control"},Na={class:"filter-control"},Ga={class:"sidebar-section"},Ka={class:"sidebar-section"},Qa={class:"resize-controls"},Xa={class:"resize-input"},Ya=["disabled"],Ja={class:"resize-input"},Za=["disabled"],_a={class:"checkbox-label"},eo=["disabled"],to={class:"canvas-area"},ao={key:0,class:"empty-canvas"},oo={key:1,class:"canvas-container"},no={class:"canvas-info"},so={class:"preview-comparison"},io={class:"preview-item"},ro=["src"],lo={key:1,class:"preview-placeholder"},uo={class:"preview-item"},co=["src"],fo={key:1,class:"preview-placeholder"},po={__name:"EditorView",setup(r){const{t:n}=ye(),o=wt(),s=mt(),u=gt(),v=$(null),i=$(null),m=$(null),q=$(null),P=$(""),I=$([]),R=$(-1),O=$("png"),K=$(""),J=$(null),W=$(!0),D=$(null),U=$(null),l=$(92),d=$(!1),h=$(null),w=$(!1),x=$({x:0,y:0}),B=xt(),y=Bt(),j=$(!1),H=$(""),z=$(""),E=$(0),g=$({brightness:100,contrast:100,saturation:100,blur:0,hue:0}),Q=pe,L=Y(()=>R.value>0),oe=Y(()=>R.value<I.value.length-1),Z=Y(()=>ya(O.value)),A=Y(()=>{var e;return((e=Z.value)==null?void 0:e.supportsQuality)||!1}),re=Y(()=>{var e;return((e=Z.value)==null?void 0:e.requiresBackend)||!1}),ue=Y(()=>{if(!B.cropOverlayStyle.value||!i.value)return null;const e=i.value.getBoundingClientRect(),a=i.value.parentElement.getBoundingClientRect(),c=e.width/i.value.width,f=e.height/i.value.height,b=e.left-a.left,C=e.top-a.top,N=B.cropOverlayStyle.value,se=ht=>parseFloat(ht)||0;return{left:`${b+se(N.left)*c}px`,top:`${C+se(N.top)*f}px`,width:`${se(N.width)*c}px`,height:`${se(N.height)*f}px`}}),_=$(0),V=$(0),F=$(0);function de(){if(!i.value){_.value=0,V.value=0;return}_.value=i.value.width,V.value=i.value.height}function ne(){if(!i.value){F.value=0;return}try{const a=i.value.toDataURL(`image/${O.value}`,.92).split(",")[1],c=a.endsWith("==")?2:a.endsWith("=")?1:0,f=a.length*3/4-c;F.value=Math.round(f)}catch{F.value=Math.round(i.value.toDataURL().length*.75)}}function ke(){de(),ne()}me(O,()=>{ne()});function Ce(){var e;(e=v.value)==null||e.click()}function qe(e){const a=e.target.files[0];if(!a)return;const c=a.type.split("/")[1];K.value=c==="jpeg"?"jpg":c;const f=new FileReader;f.onload=b=>{const C=new Image;C.onload=async()=>{P.value=b.target.result,await ce(C);try{await s.loadImageFromFile(a)}catch(N){console.warn("Store save failed:",N)}},C.src=b.target.result,q.value=C},f.readAsDataURL(a)}async function ce(e){if(m.value=e,B.resetCropState(),y.resetTransforms(),await ge(),!i.value){console.warn("‚ö†Ô∏è Canvas noch nicht initialisiert, warte..."),setTimeout(()=>ce(e),50);return}const a=1200,c=800;let f=e.width,b=e.height;if(f>a||b>c){const C=Math.min(a/f,c/b);f*=C,b*=C}i.value.width=f,i.value.height=b,D.value=f,U.value=b,k(),ke(),ee()}function k(){if(!i.value||!m.value)return;const e=i.value.getContext("2d");e.clearRect(0,0,i.value.width,i.value.height);const a=y.applyToCanvas(i.value,e),c=`
    brightness(${g.value.brightness}%)
    contrast(${g.value.contrast}%)
    saturate(${g.value.saturation}%)
    blur(${g.value.blur}px)
    hue-rotate(${g.value.hue}deg)
  `;e.filter=c,y.transforms.value.borderRadius>0&&(e.save(),Te(e,0,0,i.value.width,i.value.height,y.transforms.value.borderRadius),e.clip()),e.drawImage(m.value,0,0,i.value.width,i.value.height),y.transforms.value.borderWidth>0&&(e.strokeStyle=y.transforms.value.borderColor,e.lineWidth=y.transforms.value.borderWidth,y.transforms.value.borderRadius>0?(Te(e,0,0,i.value.width,i.value.height,y.transforms.value.borderRadius),e.stroke()):e.strokeRect(0,0,i.value.width,i.value.height)),y.transforms.value.borderRadius>0&&e.restore(),e.filter="none",a&&a(),s.texts&&s.texts.length>0&&s.texts.forEach(f=>{if(e.save(),e.font=`${f.fontSize||f.size||32}px ${f.fontFamily||"Arial"}`,e.fillStyle=f.color||"#000000",e.textBaseline="top",e.fillText(f.content||f.txt||"",f.x||0,f.y||0),h.value===f.id){const b=e.measureText(f.content||f.txt||"");e.strokeStyle="#0066ff",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(f.x-4,f.y-4,b.width+8,(f.fontSize||f.size||32)+8),e.setLineDash([])}e.restore()}),de()}function Ae(){g.value={brightness:100,contrast:100,saturation:100,blur:0,hue:0},J.value=null,B.resetCropState(),console.log("Crop-Modus deaktiviert"),y.resetTransforms(),console.log("Transform-Zustand zur√ºckgesetzt"),k(),ee()}function Oe(){!m.value||!confirm("M√∂chten Sie das Bild wirklich entfernen? Alle √Ñnderungen gehen verloren.")||(m.value=null,q.value=null,P.value="",K.value="",_.value=0,V.value=0,F.value=0,i.value&&(i.value.getContext("2d").clearRect(0,0,i.value.width,i.value.height),i.value.width=0,i.value.height=0),g.value={brightness:100,contrast:100,saturation:100,blur:0,hue:0},J.value=null,B.resetCropState(),y.resetTransforms(),I.value=[],R.value=-1,D.value=null,U.value=null,u&&typeof u.clearAllTexts=="function"&&u.clearAllTexts(),h.value=null,s&&typeof s.clearImage=="function"&&s.clearImage(),v.value&&(v.value.value=""),console.log("üóëÔ∏è Bild erfolgreich gel√∂scht"),window.$toast&&window.$toast.success(n("toast.editor.imageDeleted")))}function je(e){g.value={...e.filters},J.value=e.id,k(),ee()}function xe(e){if(!(!W.value||!i.value))if(e==="width"){const a=D.value/i.value.width;U.value=Math.round(i.value.height*a)}else{const a=U.value/i.value.height;D.value=Math.round(i.value.width*a)}}function We(){!i.value||!m.value||(i.value.width=D.value,i.value.height=U.value,k(),ne(),ee(),window.$toast&&window.$toast.success(n("toast.editor.resizeSuccess",{width:D.value,height:U.value})))}async function He(){if(i.value){d.value=!0;try{const e=`image-${Date.now()}`,a=await ba(i.value,O.value,e,{quality:l.value/100,texts:s.texts||[]});console.log("‚úÖ Export erfolgreich:",a),window.$toast&&window.$toast.success(`Bild erfolgreich als ${a.format.toUpperCase()} exportiert`+(a.size?` (${a.size})`:""))}catch(e){console.error("‚ùå Export fehlgeschlagen:",e),window.$toast?window.$toast.error(`Export fehlgeschlagen: ${e.message}`):alert(`Export fehlgeschlagen: ${e.message}`)}finally{d.value=!1}}}function ee(){i.value&&(R.value<I.value.length-1&&(I.value=I.value.slice(0,R.value+1)),I.value.push({imageData:i.value.toDataURL(),filters:{...g.value},width:i.value.width,height:i.value.height}),R.value=I.value.length-1,I.value.length>30&&(I.value.shift(),R.value--))}function Ne(){L.value&&(R.value--,Be(I.value[R.value]))}function Ge(){oe.value&&(R.value++,Be(I.value[R.value]))}function Be(e){const a=new Image;a.onload=()=>{i.value.width=e.width,i.value.height=e.height,g.value={...e.filters},i.value.getContext("2d").drawImage(a,0,0),ke()},a.src=e.imageData}function Ke(e){if(e===0)return"0 Bytes";const a=1024,c=["Bytes","KB","MB"],f=Math.floor(Math.log(e)/Math.log(a));return Math.round(e/Math.pow(a,f)*100)/100+" "+c[f]}function Qe(){B.toggleCropMode()==="finish"&&Me()}function Me(){B.finishCrop({canvas:i,currentImage:m,filters:g,imageStore:s,onCropComplete:(e,a,c)=>{m.value=e,i.value.width=a,i.value.height=c,D.value=a,U.value=c,k(),ne(),ee()}})}function Xe(){B.undoCrop({imageStore:s,onUndoComplete:(e,a)=>{m.value=e,i.value.width=a.width,i.value.height=a.height,D.value=a.width,U.value=a.height,g.value={...a.filters},k(),ne(),ee()}})}function Ye(e){y.setOpacity(e),k()}function Je(e){y.setRotation(e),k()}function Ze(e){y.setScale(e),k()}function _e(e){y.setBorderRadius(e),k()}function et(e){y.setBorderWidth(e),k()}function tt(e){y.setBorderColor(e),k()}function at(){y.rotate90(),k(),window.$toast&&window.$toast.success(n("toast.transform.rotated90"))}function ot(){y.rotate90Counter(),k(),window.$toast&&window.$toast.success(n("toast.transform.rotated90"))}function nt(){y.rotate180(),k(),window.$toast&&window.$toast.success(n("toast.transform.rotated180"))}function st(){y.flipHorizontal(),k(),window.$toast&&window.$toast.success(n("toast.transform.flippedHorizontal"))}function it(){y.flipVertical(),k(),window.$toast&&window.$toast.success(n("toast.transform.flippedVertical"))}async function rt(){if(!(!m.value||!i.value))try{console.log("Wende Transformationen permanent an...");const e=await y.applyPermanently(m.value,i.value);e&&(m.value=e.img,i.value.width=e.width,i.value.height=e.height,D.value=e.width,U.value=e.height,k(),ne(),ee(),y.resetTransforms(),console.log("‚úÖ Transformationen erfolgreich angewendet"),window.$toast&&window.$toast.success(n("toast.editor.transformApplied")))}catch(e){console.error("Fehler beim Anwenden der Transformationen:",e),window.$toast&&window.$toast.error(n("toast.editor.transformError"),e.message)}}function lt(){y.resetTransforms(),k(),window.$toast&&window.$toast.info(n("toast.transform.reset"))}function Te(e,a,c,f,b,C){e.beginPath(),e.moveTo(a+C,c),e.lineTo(a+f-C,c),e.quadraticCurveTo(a+f,c,a+f,c+C),e.lineTo(a+f,c+b-C),e.quadraticCurveTo(a+f,c+b,a+f-C,c+b),e.lineTo(a+C,c+b),e.quadraticCurveTo(a,c+b,a,c+b-C),e.lineTo(a,c+C),e.quadraticCurveTo(a,c,a+C,c),e.closePath()}function ut(){m.value&&u.openAddTextModal({x:50,y:50})}function ve(e){const a=i.value.getBoundingClientRect(),c=e.clientX-a.left,f=e.clientY-a.top,b=i.value.width/a.width,C=i.value.height/a.height;return{x:c*b,y:f*C}}function he(e,a){if(!s.texts||s.texts.length===0)return null;const c=i.value.getContext("2d");for(let f=s.texts.length-1;f>=0;f--){const b=s.texts[f],C=b.fontSize||b.size||32,N=b.content||b.txt||"";c.font=`${C}px ${b.fontFamily||"Arial"}`;const se=c.measureText(N);if(e>=b.x&&e<=b.x+se.width&&a>=b.y-C&&a<=b.y+C*.2)return b}return null}function dt(e){const a=ve(e);if(B.handleMouseDown(a))return;const f=he(a.x,a.y);f?(h.value=f.id,w.value=!0,x.value={x:a.x-f.x,y:a.y-f.y},i.value.style.cursor="grabbing"):h.value=null,k()}function ct(e){const a=ve(e);if(!B.handleMouseMove(a))if(w.value&&h.value){const f=s.texts.find(b=>b.id===h.value);f&&(f.x=a.x-x.value.x,f.y=a.y-x.value.y,k())}else{const f=he(a.x,a.y);i.value.style.cursor=f?"grab":B.cropMode.value?"crosshair":"default"}}function ft(){if(B.handleMouseUp()){Me();return}w.value&&(w.value=!1,i.value.style.cursor="default",ee())}function pt(e){const a=ve(e),c=he(a.x,a.y);c&&u.openEditTextModal(c.id)}me(()=>s.texts,()=>{k()},{deep:!0});function vt(){!m.value||!i.value||(k(),setTimeout(()=>{H.value=P.value||s.workingUrl||"",i.value&&(z.value=i.value.toDataURL("image/png")),E.value++,j.value=!0,console.log("üñºÔ∏è Preview aktualisiert:",{hasOriginal:!!H.value,hasEdited:!!z.value,trigger:E.value})},100))}function Se(){j.value=!1}async function Ie(e){if(!e)return!1;try{const{useGalleryStore:a}=await De(async()=>{const{useGalleryStore:b}=await import("./galleryStore.Bi-gAqB3.js");return{useGalleryStore:b}},__vite__mapDeps([4,1,2,3])),f=a().getImage(Number(e));if(f){console.log("Lade Bild aus Galerie:",f.name);const b=new Image;return b.onload=async()=>{P.value=f.url,q.value=b;const C=f.name.match(/\.(\w+)$/);if(C){const N=C[1].toLowerCase();K.value=N==="jpeg"?"jpg":N}await ce(b),console.log("‚úÖ Bild aus Galerie geladen (inkl. Original f√ºr Vorschau)"),window.$toast&&window.$toast.success(n("toast.editor.galleryLoaded"))},b.src=f.url,!0}}catch(a){console.error("Fehler beim Laden aus Galerie:",a),window.$toast&&window.$toast.error(n("toast.editor.galleryError"),a.message)}return!1}Ue(async()=>{window.addEventListener("keydown",ze),await ge(),!await Ie(o.query.galleryImageId)&&s.hasImage&&s.originalImage&&(m.value=s.originalImage,await ge(),i.value&&ce(s.originalImage))}),me(()=>o.query.galleryImageId,async(e,a)=>{e&&e!==a&&(console.log("üîÑ Galerie-Bild-ID ge√§ndert:",e),await Ie(e))}),bt(()=>{window.removeEventListener("keydown",ze)});function ze(e){(e.ctrlKey||e.metaKey)&&(e.key==="z"?(e.preventDefault(),Ne()):e.key==="y"&&(e.preventDefault(),Ge())),(e.key==="Delete"||e.key==="Backspace")&&h.value&&(e.preventDefault(),s.deleteText(h.value),h.value=null)}return(e,a)=>(M(),T("div",$a,[t("div",ka,[t("div",Ca,[t("div",xa,[t("button",{class:"btn btn-primary",onClick:Ce},[a[13]||(a[13]=t("i",{class:"fas fa-file-upload"},null,-1)),S(" "+p(e.$t("editor.toolbar.upload")),1)]),t("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/*",onChange:qe,style:{display:"none"}},null,544)]),t("div",Ba,[t("button",{class:"btn btn-secondary",onClick:ut,disabled:!m.value},[...a[14]||(a[14]=[t("i",{class:"fas fa-font"},null,-1),S(" Text ",-1)])],8,Ma),t("button",{class:"btn btn-secondary",onClick:vt,disabled:!m.value},[a[15]||(a[15]=t("i",{class:"fas fa-eye"},null,-1)),S(" "+p(e.$t("editor.toolbar.preview","Vorschau")),1)],8,Ta),t("button",{class:"btn btn-secondary",onClick:Ae,disabled:!m.value},[a[16]||(a[16]=t("i",{class:"fas fa-undo"},null,-1)),S(" "+p(e.$t("editor.toolbar.reset")),1)],8,Sa),t("button",{class:"btn btn-danger",onClick:Oe,disabled:!m.value,title:e.$t("editor.toolbar.clearImage","Bild entfernen")},[a[17]||(a[17]=t("i",{class:"fas fa-trash"},null,-1)),S(" "+p(e.$t("editor.toolbar.clearImage","L√∂schen")),1)],8,Ia),t("button",{class:"btn btn-success",onClick:He,disabled:!m.value||d.value},[t("i",{class:ie(d.value?"fas fa-spinner fa-spin":"fas fa-download")},null,2),S(" "+p(d.value?"Exportiere...":e.$t("editor.toolbar.download")),1)],8,za)])]),t("div",Fa,[t("aside",Pa,[t("div",Ra,[t("h3",null,p(e.$t("editor.sidebar.format")),1),X(t("select",{"onUpdate:modelValue":a[0]||(a[0]=c=>O.value=c),class:"form-select"},[(M(!0),T(Ee,null,Le(te(Q),c=>{var f;return M(),T("option",{key:c,value:c},p((f=te(le)[c])==null?void 0:f.icon)+" "+p(c.toUpperCase()),9,Da)}),128))],512),[[yt,O.value]]),Z.value?(M(),T("div",Ua,[t("p",Ea,p(Z.value.description),1),t("span",La,p(Z.value.recommended),1),re.value?(M(),T("span",Va," üåê Backend ")):G("",!0)])):G("",!0),A.value?(M(),T("div",qa,[t("label",null,p(e.$t("editor.export.quality","Qualit√§t")),1),X(t("input",{type:"range",min:"1",max:"100","onUpdate:modelValue":a[1]||(a[1]=c=>l.value=c)},null,512),[[ae,l.value,void 0,{number:!0}]]),t("span",null,p(l.value)+"%",1)])):G("",!0)]),t("div",Aa,[t("h3",null,p(e.$t("editor.sidebar.adjustments")),1),t("div",Oa,[t("label",null,p(e.$t("editor.filters.brightness")),1),X(t("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[2]||(a[2]=c=>g.value.brightness=c),onInput:k},null,544),[[ae,g.value.brightness,void 0,{number:!0}]]),t("span",null,p(g.value.brightness)+"%",1)]),t("div",ja,[t("label",null,p(e.$t("editor.filters.contrast")),1),X(t("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[3]||(a[3]=c=>g.value.contrast=c),onInput:k},null,544),[[ae,g.value.contrast,void 0,{number:!0}]]),t("span",null,p(g.value.contrast)+"%",1)]),t("div",Wa,[t("label",null,p(e.$t("editor.filters.saturation")),1),X(t("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[4]||(a[4]=c=>g.value.saturation=c),onInput:k},null,544),[[ae,g.value.saturation,void 0,{number:!0}]]),t("span",null,p(g.value.saturation)+"%",1)]),t("div",Ha,[t("label",null,p(e.$t("editor.filters.blur")),1),X(t("input",{type:"range",min:"0",max:"20","onUpdate:modelValue":a[5]||(a[5]=c=>g.value.blur=c),onInput:k},null,544),[[ae,g.value.blur,void 0,{number:!0}]]),t("span",null,p(g.value.blur)+"px",1)]),t("div",Na,[t("label",null,p(e.$t("editor.filters.hue")),1),X(t("input",{type:"range",min:"0",max:"360","onUpdate:modelValue":a[6]||(a[6]=c=>g.value.hue=c),onInput:k},null,544),[[ae,g.value.hue,void 0,{number:!0}]]),t("span",null,p(g.value.hue)+"¬∞",1)])]),t("div",Ga,[t("h3",null,p(e.$t("editor.sidebar.presets")),1),$t(ha,{filters:g.value,onApplyPreset:je},null,8,["filters"])]),t("div",Ka,[t("h3",null,p(e.$t("editor.sidebar.resize")),1),t("div",Qa,[t("div",Xa,[t("label",null,p(e.$t("editor.resize.width")),1),X(t("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=c=>D.value=c),disabled:!m.value,onChange:a[8]||(a[8]=c=>xe("width"))},null,40,Ya),[[ae,D.value,void 0,{number:!0}]])]),t("div",Ja,[t("label",null,p(e.$t("editor.resize.height")),1),X(t("input",{type:"number","onUpdate:modelValue":a[9]||(a[9]=c=>U.value=c),disabled:!m.value,onChange:a[10]||(a[10]=c=>xe("height"))},null,40,Za),[[ae,U.value,void 0,{number:!0}]])]),t("label",_a,[X(t("input",{type:"checkbox","onUpdate:modelValue":a[11]||(a[11]=c=>W.value=c)},null,512),[[kt,W.value]]),S(" "+p(e.$t("editor.resize.maintainAspect")),1)]),t("button",{class:"btn btn-primary",onClick:We,disabled:!m.value},p(e.$t("editor.resize.apply")),9,eo)])])]),t("div",to,[m.value?(M(),T("div",oo,[t("canvas",{ref_key:"canvas",ref:i,class:"main-canvas",style:Pe({cursor:te(B).cropMode.value?"crosshair":"default"}),onMousedown:dt,onMousemove:ct,onMouseup:ft,onDblclick:pt},null,36),te(B).cropping.value&&ue.value?(M(),T("div",{key:0,class:"crop-overlay",style:Pe(ue.value)},null,4)):G("",!0),t("div",no,[t("span",null,[a[20]||(a[20]=t("i",{class:"fas fa-expand-arrows-alt"},null,-1)),S(" "+p(_.value)+" √ó "+p(V.value)+"px",1)]),t("span",null,[a[21]||(a[21]=t("i",{class:"fas fa-file"},null,-1)),S(" "+p(Ke(F.value)),1)]),t("span",null,[a[22]||(a[22]=t("i",{class:"fas fa-image"},null,-1)),S(" "+p(K.value.toUpperCase()),1)])])])):(M(),T("div",ao,[a[19]||(a[19]=t("i",{class:"fas fa-image"},null,-1)),t("h2",null,p(e.$t("editor.canvas.empty.title")),1),t("p",null,p(e.$t("editor.canvas.empty.description")),1),t("button",{class:"btn btn-primary btn-large",onClick:Ce},[a[18]||(a[18]=t("i",{class:"fas fa-file-upload"},null,-1)),S(" "+p(e.$t("editor.canvas.empty.button")),1)])]))]),m.value?(M(),Fe(aa,{key:0,"crop-mode":te(B).cropMode.value,"has-cropped":te(B).hasCropped.value,transforms:te(y).transforms.value,"has-transforms":te(y).hasTransforms.value,onToggleCrop:Qe,onUndoCrop:Xe,"onUpdate:opacity":Ye,"onUpdate:rotation":Je,"onUpdate:scale":Ze,"onUpdate:borderRadius":_e,"onUpdate:borderWidth":et,"onUpdate:borderColor":tt,onRotate90:at,onRotate90Counter:ot,onRotate180:nt,onFlipHorizontal:st,onFlipVertical:it,onApplyTransforms:rt,onResetTransforms:lt},null,8,["crop-mode","has-cropped","transforms","has-transforms"])):G("",!0)])]),(M(),Fe(Ct,{to:"body"},[j.value?(M(),T("div",{key:0,class:"preview-modal-overlay",onClick:Se},[t("div",{class:"preview-modal-content",onClick:a[12]||(a[12]=Ve(()=>{},["stop"]))},[t("button",{class:"preview-close-btn",onClick:Se},[...a[23]||(a[23]=[t("i",{class:"fas fa-times"},null,-1)])]),a[27]||(a[27]=t("h2",{class:"preview-title"},"Vorher / Nachher Vergleich",-1)),t("div",so,[t("div",io,[a[24]||(a[24]=t("h3",null,"Vorher (Original)",-1)),H.value?(M(),T("img",{key:0,src:H.value,alt:"Original"},null,8,ro)):(M(),T("div",lo,"Kein Original verf√ºgbar"))]),a[26]||(a[26]=t("div",{class:"preview-divider"},null,-1)),t("div",uo,[a[25]||(a[25]=t("h3",null,"Nachher (Bearbeitet)",-1)),z.value?(M(),T("img",{key:0,src:z.value,alt:"Bearbeitet"},null,8,co)):(M(),T("div",fo,"Keine Bearbeitung verf√ºgbar"))])])])])):G("",!0)]))]))}},mo=$e(po,[["__scopeId","data-v-6b09a973"]]);export{mo as default};
