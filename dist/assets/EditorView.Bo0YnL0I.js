const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/galleryStore.V44e_1hc.js","assets/index.jXFWo5yp.js","assets/vendor.3OznsCWS.js","assets/index.BDEZYf6d.css","assets/jspdf.es.min.hYDnrvS9.js"])))=>i.map(i=>d[i]);
import{u as ct,a as Zt,_ as Pt,b as Mt,c as bt,d as wt,e as ls}from"./index.jXFWo5yp.js";import{f as ce,r as D,w as ot,p as yt,B as N,C as e,R as F,G as v,F as qe,E as Je,Q as je,y as $,L as me,H as de,K as W,q as _t,S as ge,X as Ke,P as tt,c as is,n as ht,V as rs,U as Fe,Z as Kt,v as us,_ as Jt,a as Ct,M as Tt,O as ds}from"./vendor.3OznsCWS.js";const dt=[{id:"free",label:"Frei",ratio:null,icon:"fa-expand"},{id:"circle",label:"Kreis",ratio:1,icon:"fa-circle",isCircle:!0},{id:"1:1",label:"1:1",ratio:1,icon:"fa-square"},{id:"4:3",label:"4:3",ratio:4/3,icon:"fa-image"},{id:"16:9",label:"16:9",ratio:16/9,icon:"fa-tv"},{id:"9:16",label:"9:16",ratio:9/16,icon:"fa-mobile-alt"}];function cs(){const{t:d}=ct(),m=D(!1),g=D(!1),u=D({x:0,y:0}),o=D({x:0,y:0}),t=D(!1),n=D(null),y=D("free"),z=D({width:0,height:0}),ee=D(!1),_=D(!1),fe=D(!1),R=D(null),te=D({x:0,y:0}),ve=ce(()=>{if(!g.value)return null;const V=Math.min(u.value.x,o.value.x),E=Math.min(u.value.y,o.value.y),O=Math.abs(o.value.x-u.value.x),S=Math.abs(o.value.y-u.value.y);return{left:`${V}px`,top:`${E}px`,width:`${O}px`,height:`${S}px`}}),p=ce(()=>({x:Math.min(u.value.x,o.value.x),y:Math.min(u.value.y,o.value.y),width:Math.abs(o.value.x-u.value.x),height:Math.abs(o.value.y-u.value.y)}));function H(){return m.value&&g.value?"finish":(m.value=!m.value,m.value?(console.log("Crop-Modus aktiviert: Ziehen Sie einen Bereich auf"),window.$toast&&window.$toast.info(d("toast.crop.modeActivated"))):(X(),y.value="free"),m.value?"activated":"deactivated")}function X(){g.value=!1,ee.value=!1,_.value=!1,fe.value=!1,R.value=null,u.value={x:0,y:0},o.value={x:0,y:0}}function T(V,E){g.value=!0,fe.value=!0,u.value={x:V,y:E},o.value={x:V,y:E}}function Z(V){if(z.value.width<=0||z.value.height<=0)return;const E=z.value.width,O=z.value.height,S=E*.8,A=O*.8;let J,ue;V===null?(J=E*.6,ue=O*.6):S/V<=A?(J=S,ue=S/V):(ue=A,J=A*V);const we=(E-J)/2,I=(O-ue)/2;u.value={x:we,y:I},o.value={x:we+J,y:I+ue},g.value=!0}function k(V,E){const O=dt.find(Te=>Te.id===y.value);if(!O||O.ratio===null){o.value={x:V,y:E};return}const S=O.ratio,A=u.value.x,J=u.value.y;let ue=V-A,we=E-J;const I=Math.abs(ue),r=Math.abs(we);let i,c;I/S>r?(i=I,c=I/S):(c=r,i=r*S),ue<0&&(i=-i),we<0&&(c=-c);let j=A+i,oe=J+c;z.value.width>0&&z.value.height>0&&(j=Math.max(0,Math.min(z.value.width,j)),oe=Math.max(0,Math.min(z.value.height,oe))),o.value={x:j,y:oe}}function Y(V,E){const O=p.value;let S=V-te.value.x,A=E-te.value.y;z.value.width>0&&z.value.height>0&&(S=Math.max(0,Math.min(z.value.width-O.width,S)),A=Math.max(0,Math.min(z.value.height-O.height,A))),u.value={x:S,y:A},o.value={x:S+O.width,y:A+O.height}}function M(V,E){if(!R.value)return;const O=dt.find(c=>c.id===y.value),S=(O==null?void 0:O.ratio)||null;p.value,V=Math.max(0,Math.min(z.value.width,V)),E=Math.max(0,Math.min(z.value.height,E));let A={...u.value},J={...o.value};const ue=Math.min(u.value.x,o.value.x),we=Math.min(u.value.y,o.value.y),I=Math.max(u.value.x,o.value.x),r=Math.max(u.value.y,o.value.y);switch(R.value){case"nw":A={x:V,y:E},J={x:I,y:r};break;case"n":A={x:ue,y:E},J={x:I,y:r};break;case"ne":A={x:ue,y:E},J={x:V,y:r};break;case"e":A={x:ue,y:we},J={x:V,y:r};break;case"se":A={x:ue,y:we},J={x:V,y:E};break;case"s":A={x:ue,y:we},J={x:I,y:E};break;case"sw":A={x:V,y:we},J={x:I,y:E};break;case"w":A={x:V,y:we},J={x:I,y:r};break}if(S!==null){const c=Math.abs(J.x-A.x),j=Math.abs(J.y-A.y),oe=["e","w"].includes(R.value),Te=["n","s"].includes(R.value);let ye,he;oe?(ye=c,he=c/S):Te?(he=j,ye=j*S):c/S>j?(ye=c,he=c/S):(he=j,ye=j*S),R.value.includes("w")?A.x=J.x-ye:J.x=A.x+ye,R.value.includes("n")?A.y=J.y-he:J.y=A.y+he}const i=20;Math.abs(J.x-A.x)>=i&&Math.abs(J.y-A.y)>=i&&(u.value=A,o.value=J)}function B(V,E){if(!g.value)return!1;const O=p.value;return V>=O.x&&V<=O.x+O.width&&E>=O.y&&E<=O.y+O.height}function re(V,E,O=1){if(!g.value)return null;const S=p.value,A=Math.max(15,20/O),J={nw:{x:S.x,y:S.y},n:{x:S.x+S.width/2,y:S.y},ne:{x:S.x+S.width,y:S.y},e:{x:S.x+S.width,y:S.y+S.height/2},se:{x:S.x+S.width,y:S.y+S.height},s:{x:S.x+S.width/2,y:S.y+S.height},sw:{x:S.x,y:S.y+S.height},w:{x:S.x,y:S.y+S.height/2}};for(const[ue,we]of Object.entries(J))if(Math.abs(V-we.x)<=A&&Math.abs(E-we.y)<=A)return ue;return null}function ae(V){y.value,y.value=V;const E=dt.find(O=>O.id===V);if(!g.value&&E)Z(E.ratio);else if(g.value&&E&&E.ratio!==null){const O=p.value,S=O.x+O.width/2,A=O.y+O.height/2;let J,ue;const we=E.ratio;O.width/we<=O.height?(J=O.width,ue=O.width/we):(ue=O.height,J=O.height*we),J>z.value.width&&(J=z.value.width*.9,ue=J/we),ue>z.value.height&&(ue=z.value.height*.9,J=ue*we);let I=S-J/2,r=A-ue/2;I=Math.max(0,Math.min(z.value.width-J,I)),r=Math.max(0,Math.min(z.value.height-ue,r)),u.value={x:I,y:r},o.value={x:I+J,y:r+ue}}}function Xe(V,E){z.value={width:V,height:E}}async function G(V){const{canvas:E,currentImage:O,filters:S,imageStore:A}=V;if(!g.value||!E.value||!O.value)return;g.value=!1;const J=Math.min(u.value.x,o.value.x),ue=Math.min(u.value.y,o.value.y),we=Math.abs(o.value.x-u.value.x),I=Math.abs(o.value.y-u.value.y);if(we<10||I<10){X(),console.warn("Crop-Bereich zu klein (mindestens 10x10 Pixel)"),window.$toast&&window.$toast.warning(d("toast.crop.tooSmall"),d("toast.crop.tooSmallDetail"));return}try{if(!t.value){const Ie=document.createElement("canvas"),xe=Ie.getContext("2d");Ie.width=E.value.width,Ie.height=E.value.height;const Qe=`
          brightness(${S.value.brightness}%)
          contrast(${S.value.contrast}%)
          saturate(${S.value.saturation}%)
          blur(${S.value.blur}px)
          hue-rotate(${S.value.hue}deg)
        `;xe.filter=Qe,xe.drawImage(O.value,0,0,Ie.width,Ie.height),xe.filter="none",n.value={dataUrl:Ie.toDataURL("image/png"),width:E.value.width,height:E.value.height,filters:{...S.value},texts:A?[...A.texts]:[]},console.log("Original-Bild (ohne Texte) vor Crop gespeichert")}const r=J,i=ue,c=we,j=I;if(console.log(`Crop-Bereich: x=${r}, y=${i}, w=${c}, h=${j}`),r<0||i<0||r+c>E.value.width||i+j>E.value.height)throw console.error(`Crop außerhalb: Canvas=${E.value.width}x${E.value.height}, Crop=${r},${i},${c},${j}`),window.$toast&&window.$toast.error(d("toast.crop.outOfBounds")),new Error("Crop-Bereich muss vollständig auf dem Bild liegen");const oe=document.createElement("canvas"),Te=oe.getContext("2d");oe.width=E.value.width,oe.height=E.value.height;const ye=`
        brightness(${S.value.brightness}%)
        contrast(${S.value.contrast}%)
        saturate(${S.value.saturation}%)
        blur(${S.value.blur}px)
        hue-rotate(${S.value.hue}deg)
      `;Te.filter=ye,Te.drawImage(O.value,0,0,oe.width,oe.height),Te.filter="none";const he=document.createElement("canvas"),Ye=he.getContext("2d");he.width=Math.max(1,Math.round(c)),he.height=Math.max(1,Math.round(j)),Ye.imageSmoothingEnabled=!0,Ye.imageSmoothingQuality="high";const Ee=dt.find(Ie=>Ie.id===y.value),Oe=(Ee==null?void 0:Ee.isCircle)===!0;if(Oe){const Ie=he.width/2,xe=he.height/2,Qe=Math.min(he.width,he.height)/2;Ye.beginPath(),Ye.arc(Ie,xe,Qe,0,Math.PI*2),Ye.closePath(),Ye.clip(),Ye.drawImage(oe,Math.max(0,r),Math.max(0,i),Math.min(c,oe.width-r),Math.min(j,oe.height-i),0,0,he.width,he.height)}else Ye.drawImage(oe,Math.max(0,r),Math.max(0,i),Math.min(c,oe.width-r),Math.min(j,oe.height-i),0,0,he.width,he.height);if(A&&A.texts){const Ie=[];A.texts.forEach(xe=>{xe.x<r||xe.x>r+c||xe.y<i||xe.y>i+j?Ie.push(xe.id):A.updateText(xe.id,{x:xe.x-r,y:xe.y-i})}),Ie.forEach(xe=>{A.deleteText(xe)}),console.log(`Text-Positionen angepasst. ${Ie.length} Texte entfernt.`)}const at=he.toDataURL("image/png"),Ve=new Image;Ve.onload=()=>{V.onCropComplete&&V.onCropComplete(Ve,he.width,he.height,Oe),t.value=!0,console.log(`Bild zugeschnitten: ${he.width}×${he.height}px`),window.$toast&&window.$toast.success(d("toast.crop.success",{width:he.width,height:he.height}))},Ve.src=at,m.value=!1,X()}catch(r){console.error("Crop-Fehler:",r),window.$toast&&window.$toast.error(d("toast.crop.error"),r.message),X()}}function b(V){if(!t.value||!n.value){console.warn("Kein gespeichertes Bild zum Wiederherstellen vorhanden"),window.$toast&&window.$toast.warning(d("toast.crop.undoNotAvailable"));return}if(!confirm("Möchten Sie den Zuschnitt rückgängig machen und das Original-Bild wiederherstellen?"))return;console.log("Stelle Original-Bild vor Crop wieder her...");const{imageStore:O}=V,S=new Image;S.onload=()=>{O&&n.value.texts&&(O.texts.splice(0,O.texts.length),O.texts.splice(0,0,...n.value.texts),console.log(`✅ ${O.texts.length} Texte wiederhergestellt`)),V.onUndoComplete&&V.onUndoComplete(S,n.value),t.value=!1,n.value=null,console.log("✅ Original-Bild erfolgreich wiederhergestellt"),window.$toast&&window.$toast.success(d("toast.crop.undoSuccess"))},S.src=n.value.dataUrl}function Le(){m.value&&(m.value=!1,X()),t.value=!1,n.value=null}function L(V,E=1){if(!m.value)return!1;const{x:O,y:S}=V,A=re(O,S,E);if(A)return _.value=!0,R.value=A,!0;if(B(O,S)){ee.value=!0;const J=p.value;return te.value={x:O-J.x,y:S-J.y},!0}return T(O,S),!0}function Be(V){const{x:E,y:O}=V;return _.value?(M(E,O),!0):ee.value?(Y(E,O),!0):fe.value?(k(E,O),!0):!1}function Ce(){const V=_.value,E=ee.value,O=fe.value;return _.value=!1,ee.value=!1,fe.value=!1,R.value=null,!1}function Ge(V,E,O=1){if(!m.value||!g.value)return"crosshair";const S=re(V,E,O);return S?{nw:"nwse-resize",se:"nwse-resize",ne:"nesw-resize",sw:"nesw-resize",n:"ns-resize",s:"ns-resize",e:"ew-resize",w:"ew-resize"}[S]||"move":B(V,E)?"move":"crosshair"}function We(){_.value=!1,ee.value=!1,fe.value=!1,R.value=null}return{cropMode:m,cropping:g,hasCropped:t,cropOverlayStyle:ve,selectedAspectRatio:y,isDragging:ee,isResizing:_,isCreating:fe,normalizedCropBox:p,toggleCropMode:H,finishCrop:G,undoCrop:b,resetCropState:Le,clearCropSelection:X,setAspectRatio:ae,setCanvasSize:Xe,getCursorForPosition:Ge,getHandleAtPoint:re,cancelDragResize:We,handleMouseDown:L,handleMouseMove:Be,handleMouseUp:Ce}}const pt={opacity:100,rotation:0,scale:100,flipHorizontal:!1,flipVertical:!1,borderRadius:0,borderWidth:0,borderColor:"#000000",panX:0,panY:0,shadowEnabled:!1,shadowOffsetX:10,shadowOffsetY:10,shadowBlur:20,shadowColor:"#000000",shadowOpacity:50,skewX:0,skewY:0};function fs(){const d=D({...pt}),m=D([]),g=D(-1),u=50;function o(){g.value<m.value.length-1&&(m.value=m.value.slice(0,g.value+1));const I=JSON.parse(JSON.stringify(d.value)),r=m.value[m.value.length-1];r&&JSON.stringify(r)===JSON.stringify(I)||(m.value.push(I),m.value.length>u?m.value.shift():g.value++)}function t(){if(!z.value)return!1;g.value--;const I=m.value[g.value];return I?(d.value=JSON.parse(JSON.stringify(I)),!0):!1}function n(){if(!ee.value)return!1;g.value++;const I=m.value[g.value];return I?(d.value=JSON.parse(JSON.stringify(I)),!0):!1}function y(){m.value=[JSON.parse(JSON.stringify(pt))],g.value=0,d.value={...pt}}const z=ce(()=>g.value>0),ee=ce(()=>g.value<m.value.length-1),_=ce(()=>{const I=[];d.value.rotation!==0&&I.push(`rotate(${d.value.rotation}deg)`);const r=d.value.scale/100;r!==1&&I.push(`scale(${r})`);const i=d.value.flipHorizontal?-1:1,c=d.value.flipVertical?-1:1;return(i!==1||c!==1)&&I.push(`scale(${i}, ${c})`),I.length>0?I.join(" "):"none"});function fe(I,r=!1){d.value.opacity=Math.max(0,Math.min(100,I)),r&&o()}function R(I,r=!1){for(d.value.rotation=I;d.value.rotation>180;)d.value.rotation-=360;for(;d.value.rotation<-180;)d.value.rotation+=360;r&&o()}function te(I){R(d.value.rotation+I,!0)}function ve(){te(90)}function p(){te(-90)}function H(){te(180)}function X(){d.value.flipHorizontal=!d.value.flipHorizontal,o()}function T(){d.value.flipVertical=!d.value.flipVertical,o()}function Z(I,r=!1){d.value.scale=Math.max(10,Math.min(200,I)),d.value.scale<=100&&(d.value.panX=0,d.value.panY=0),r&&o()}function k(I,r){if(d.value.scale<=100){d.value.panX=0,d.value.panY=0;return}d.value.panX=I,d.value.panY=r}function Y(I,r){if(d.value.scale<=100)return;const i=(d.value.scale-100)*3,c=d.value.panX+I,j=d.value.panY+r;d.value.panX=Math.max(-i,Math.min(i,c)),d.value.panY=Math.max(-i,Math.min(i,j))}function M(){d.value.panX=0,d.value.panY=0}function B(I,r=!1){d.value.borderRadius=Math.max(0,Math.min(50,I)),r&&o()}function re(I,r=!1){d.value.borderWidth=Math.max(0,Math.min(20,I)),r&&o()}function ae(I,r=!1){d.value.borderColor=I,r&&o()}function Xe(I,r=!1){d.value.shadowEnabled=I,r&&o()}function G(I,r=!1){d.value.shadowOffsetX=Math.max(-50,Math.min(50,I)),r&&o()}function b(I,r=!1){d.value.shadowOffsetY=Math.max(-50,Math.min(50,I)),r&&o()}function Le(I,r=!1){d.value.shadowBlur=Math.max(0,Math.min(100,I)),r&&o()}function L(I,r=!1){d.value.shadowColor=I,r&&o()}function Be(I,r=!1){d.value.shadowOpacity=Math.max(0,Math.min(100,I)),r&&o()}function Ce(I,r=!1){d.value.skewX=Math.max(-45,Math.min(45,I)),r&&o()}function Ge(I,r=!1){d.value.skewY=Math.max(-45,Math.min(45,I)),r&&o()}function We(){o()}function V(I,r){if(!I||!r)return;r.globalAlpha=d.value.opacity/100;const i=I.width/2,c=I.height/2;if(r.save(),r.translate(i,c),d.value.scale>100&&(d.value.panX!==0||d.value.panY!==0)&&r.translate(d.value.panX,d.value.panY),d.value.rotation!==0){const oe=d.value.rotation*Math.PI/180;r.rotate(oe)}const j=d.value.scale/100;if(j!==1&&r.scale(j,j),d.value.flipHorizontal||d.value.flipVertical){const oe=d.value.flipHorizontal?-1:1,Te=d.value.flipVertical?-1:1;r.scale(oe,Te)}if(d.value.skewX!==0||d.value.skewY!==0){const oe=Math.tan(d.value.skewX*Math.PI/180),Te=Math.tan(d.value.skewY*Math.PI/180);r.transform(1,Te,oe,1,0,0)}return r.translate(-i,-c),()=>{r.restore(),r.globalAlpha=1}}async function E(I,r){return!I||!r?null:new Promise((i,c)=>{try{const j=d.value.rotation*Math.PI/180,oe=Math.abs(Math.cos(j)),Te=Math.abs(Math.sin(j)),ye=d.value.scale/100,he=Math.round((r.width*oe+r.height*Te)*ye),Ye=Math.round((r.width*Te+r.height*oe)*ye),Ee=document.createElement("canvas");Ee.width=he,Ee.height=Ye;const Oe=Ee.getContext("2d");if(Oe.imageSmoothingEnabled=!0,Oe.imageSmoothingQuality="high",Oe.globalAlpha=d.value.opacity/100,Oe.save(),Oe.translate(he/2,Ye/2),d.value.rotation!==0&&Oe.rotate(j),ye!==1&&Oe.scale(ye,ye),d.value.flipHorizontal||d.value.flipVertical){const Ie=d.value.flipHorizontal?-1:1,xe=d.value.flipVertical?-1:1;Oe.scale(Ie,xe)}if(d.value.skewX!==0||d.value.skewY!==0){const Ie=Math.tan(d.value.skewX*Math.PI/180),xe=Math.tan(d.value.skewY*Math.PI/180);Oe.transform(1,xe,Ie,1,0,0)}Oe.drawImage(I,-r.width/2,-r.height/2,r.width,r.height),Oe.restore();const at=Ee.toDataURL("image/png"),Ve=new Image;Ve.onload=()=>{i({img:Ve,width:he,height:Ye})},Ve.onerror=()=>{c(new Error("Fehler beim Laden des transformierten Bildes"))},Ve.src=at}catch(j){c(j)}})}function O(I=!0){d.value={...pt},I&&o()}const S=ce(()=>d.value.opacity!==100||d.value.rotation!==0||d.value.scale!==100||d.value.flipHorizontal||d.value.flipVertical||d.value.borderRadius!==0||d.value.borderWidth!==0||d.value.shadowEnabled||d.value.skewX!==0||d.value.skewY!==0),A=ce(()=>d.value.skewX!==0||d.value.skewY!==0),J=ce(()=>d.value.shadowEnabled),ue=ce(()=>d.value.panX!==0||d.value.panY!==0),we=ce(()=>d.value.scale>100);return{transforms:d,transformStyle:_,hasTransforms:S,hasPan:ue,canPan:we,hasShadow:J,hasSkew:A,canUndoTransform:z,canRedoTransform:ee,setOpacity:fe,setRotation:R,rotate:te,rotate90:ve,rotate90Counter:p,rotate180:H,flipHorizontal:X,flipVertical:T,setScale:Z,setPan:k,pan:Y,resetPan:M,setBorderRadius:B,setBorderWidth:re,setBorderColor:ae,setShadowEnabled:Xe,setShadowOffsetX:G,setShadowOffsetY:b,setShadowBlur:Le,setShadowColor:L,setShadowOpacity:Be,setSkewX:Ce,setSkewY:Ge,applyToCanvas:V,applyPermanently:E,resetTransforms:O,saveToHistory:o,undoTransform:t,redoTransform:n,initTransformHistory:y,commitTransform:We}}const st={brightness:100,contrast:100,saturation:100,blur:0,hue:0,sepia:0,grayscale:0,invert:0,exposure:0,highlights:0,shadows:0,sharpness:0,vignette:0},mt={color:"#ffffff",opacity:100};function vs(d={}){const{onFilterChange:m}=d,g=D({...st}),u=D({...mt}),o=D(null),t=D({adjustments:!0,lightColor:!1,effects:!1}),n=ce(()=>Object.keys(st).some(T=>g.value[T]!==st[T])),y=ce(()=>u.value.opacity>0);function z(){g.value={...st},o.value=null,m&&m()}function ee(){u.value={...mt},m&&m()}function _(){z(),ee()}function fe(T){g.value={...st,...T.filters},o.value=T.id,m&&m()}function R(T,Z){T in g.value&&(g.value[T]=Z,o.value=null,m&&m())}function te(T,Z){T in u.value&&(u.value[T]=Z,m&&m())}function ve(T){T in t.value&&(t.value[T]=!t.value[T])}function p(){const T=g.value,Z=100+T.exposure,k=100+T.highlights*.5,Y=100+T.shadows*.3;return`
      brightness(${T.brightness*(Z/100)*(k/100)}%)
      contrast(${T.contrast*(Y/100)}%)
      saturate(${T.saturation}%)
      blur(${T.blur}px)
      hue-rotate(${T.hue}deg)
      sepia(${T.sepia}%)
      grayscale(${T.grayscale}%)
      invert(${T.invert}%)
    `.trim()}function H(){return{filters:{...g.value},background:{...u.value},currentPreset:o.value}}function X(T){T.filters&&(g.value={...st,...T.filters}),T.background&&(u.value={...mt,...T.background}),"currentPreset"in T&&(o.value=T.currentPreset)}return{filters:g,background:u,currentPreset:o,sectionsOpen:t,hasActiveFilters:n,hasActiveBackground:y,resetFilters:z,resetBackground:ee,resetAll:_,applyPreset:fe,updateFilter:R,updateBackground:te,toggleSection:ve,getFilterString:p,exportState:H,importState:X,DEFAULT_FILTERS:st,DEFAULT_BACKGROUND:mt}}function hs(d={}){const{maxHistorySize:m=50,onRestore:g}=d,u=D([]),o=D(-1),t=ce(()=>o.value>0),n=ce(()=>o.value<u.value.length-1),y=ce(()=>o.value>=0&&o.value<u.value.length?u.value[o.value]:null),z=ce(()=>u.value.length);function ee(H){o.value<u.value.length-1&&(u.value=u.value.slice(0,o.value+1)),u.value.push({...H,timestamp:Date.now()}),u.value.length>m&&(u.value=u.value.slice(-m)),o.value=u.value.length-1}function _(){if(!t.value)return null;o.value--;const H=u.value[o.value];return g&&H&&g(H),H}function fe(){if(!n.value)return null;o.value++;const H=u.value[o.value];return g&&H&&g(H),H}function R(H){if(H<0||H>=u.value.length)return null;o.value=H;const X=u.value[H];return g&&X&&g(X),X}function te(){u.value=[],o.value=-1}function ve(H){o.value>=0&&o.value<u.value.length&&(u.value[o.value]={...H,timestamp:Date.now()})}function p(){return u.value.map((H,X)=>({index:X,timestamp:H.timestamp,isCurrent:X===o.value}))}return{history:u,historyIndex:o,canUndo:t,canRedo:n,currentState:y,historyLength:z,saveState:ee,undo:_,redo:fe,goToIndex:R,clearHistory:te,replaceCurrentState:ve,getHistoryList:p}}const ps=50;function ms(d){const{getTexts:m,setTexts:g,getSelectedTextId:u,setSelectedTextId:o}=d,t=D([]),n=D(-1),y=D(!1),z=ce(()=>n.value>0),ee=ce(()=>n.value<t.value.length-1);function _(){const H=m(),X=u();return{texts:JSON.parse(JSON.stringify(H||[])),selectedTextId:X}}function fe(){if(y.value)return;const H=_();n.value<t.value.length-1&&(t.value=t.value.slice(0,n.value+1)),t.value.push(H),t.value.length>ps?t.value.shift():n.value++}function R(){t.value=[_()],n.value=0}function te(){if(!z.value)return;y.value=!0,n.value--;const H=t.value[n.value];g(JSON.parse(JSON.stringify(H.texts))),o(H.selectedTextId),setTimeout(()=>{y.value=!1},0)}function ve(){if(!ee.value)return;y.value=!0,n.value++;const H=t.value[n.value];g(JSON.parse(JSON.stringify(H.texts))),o(H.selectedTextId),setTimeout(()=>{y.value=!1},0)}function p(){t.value=[],n.value=-1}return{canUndoText:z,canRedoText:ee,historyIndex:n,historyLength:ce(()=>t.value.length),saveTextHistory:fe,initTextHistory:R,undoText:te,redoText:ve,clearTextHistory:p}}function gs(d={}){const{getCurrentDimensions:m,onResize:g}=d,u=D(0),o=D(0),t=D(!0),n=D(0),y=D(0),z=ce(()=>y.value===0?1:n.value/y.value),ee=ce(()=>u.value!==n.value||o.value!==y.value),_=ce(()=>u.value>0&&o.value>0&&u.value<=1e4&&o.value<=1e4);function fe(M,B){n.value=M,y.value=B,u.value=M,o.value=B}function R(){if(m){const{width:M,height:B}=m();fe(M,B)}}function te(M){u.value=Math.max(1,Math.round(M)),t.value&&z.value>0&&(o.value=Math.max(1,Math.round(u.value/z.value)))}function ve(M){o.value=Math.max(1,Math.round(M)),t.value&&z.value>0&&(u.value=Math.max(1,Math.round(o.value*z.value)))}function p(M){M==="width"?te(u.value):ve(o.value)}function H(M){const B=M/100;u.value=Math.max(1,Math.round(n.value*B)),o.value=Math.max(1,Math.round(y.value*B))}function X(){u.value=n.value,o.value=y.value}function T(){if(!_.value)return null;const M={width:u.value,height:o.value};return g&&g(M),n.value=u.value,y.value=o.value,M}function Z(M,B){let re=n.value,ae=y.value;return re>M&&(re=M,ae=Math.round(re/z.value)),ae>B&&(ae=B,re=Math.round(ae*z.value)),u.value=re,o.value=ae,{width:re,height:ae}}const k={instagram:{width:1080,height:1080,name:"Instagram Post"},instagramStory:{width:1080,height:1920,name:"Instagram Story"},facebook:{width:1200,height:630,name:"Facebook Post"},twitter:{width:1200,height:675,name:"Twitter Post"},youtube:{width:1280,height:720,name:"YouTube Thumbnail"},hd:{width:1920,height:1080,name:"Full HD"},"4k":{width:3840,height:2160,name:"4K UHD"}};function Y(M){const B=k[M];B&&(u.value=B.width,o.value=B.height)}return{resizeWidth:u,resizeHeight:o,maintainAspectRatio:t,originalWidth:n,originalHeight:y,aspectRatio:z,hasChanges:ee,isValidSize:_,initFromDimensions:fe,syncWithCurrent:R,onWidthChange:te,onHeightChange:ve,onDimensionChange:p,scaleByPercent:H,resetToOriginal:X,applyResize:T,fitToBounds:Z,applyPreset:Y,presetSizes:k}}function ws(d={}){const{onImageLoad:m,onError:g}=d,u=Zt(),o=D(!1),t=D(null),n=D(null);async function y(){if(!n.value){const{useGalleryStore:R}=await Pt(async()=>{const{useGalleryStore:te}=await import("./galleryStore.V44e_1hc.js");return{useGalleryStore:te}},__vite__mapDeps([0,1,2,3]));n.value=R()}return n.value}async function z(R){if(!R||o.value)return null;o.value=!0;try{const ve=(await y()).images.find(H=>H.id===R);if(!ve)throw new Error(`Bild mit ID ${R} nicht gefunden`);t.value=R;const p={url:ve.url||ve.dataUrl,name:ve.name||"Galerie-Bild",type:ve.type||"image/png",id:R,metadata:{uploadedAt:ve.uploadedAt,size:ve.size}};return m&&await m(p),window.$toast&&window.$toast.success("Bild aus Galerie geladen"),p}catch(te){return console.error("Fehler beim Laden aus Galerie:",te),g&&g(te),window.$toast&&window.$toast.error("Fehler beim Laden aus Galerie",te.message),null}finally{o.value=!1}}async function ee(){var te;const R=(te=u.query)==null?void 0:te.galleryImageId;R&&R!==t.value&&await z(R)}async function _(){try{const te=(await y()).images;if(!te||te.length===0)return null;const ve=[...te].sort((p,H)=>{const X=p.editedAt||p.uploadedAt||0;return(H.editedAt||H.uploadedAt||0)-X});return await z(ve[0].id)}catch(R){return console.error("Fehler beim Laden des letzten Bildes:",R),null}}async function fe(){try{return(await y()).images||[]}catch(R){return console.error("Fehler beim Abrufen der Galerie-Bilder:",R),[]}}return ot(()=>{var R;return(R=u.query)==null?void 0:R.galleryImageId},async R=>{R&&await z(R)}),yt(()=>{ee()}),{isLoadingFromGallery:o,lastLoadedImageId:t,loadImageById:z,loadLastEdited:_,getAvailableImages:fe,checkRouteAndLoad:ee}}function bs(d){const m=Mt(),g=D(!1),u=D(!1),o=D(null),t=D({x:0,y:0}),n=D({x:0,y:0,width:0,height:0}),y=12;function z(k,Y){for(let M=m.imageLayers.length-1;M>=0;M--){const B=m.imageLayers[M];if(!(!B.visible||B.locked)&&ee(k,Y,B))return B}return null}function ee(k,Y,M){return k>=M.x&&k<=M.x+M.width&&Y>=M.y&&Y<=M.y+M.height}function _(k,Y,M){if(!M)return null;const B=fe(M);for(const[re,ae]of Object.entries(B))if(k>=ae.x-y/2&&k<=ae.x+y/2&&Y>=ae.y-y/2&&Y<=ae.y+y/2)return re;return null}function fe(k){return{nw:{x:k.x,y:k.y},n:{x:k.x+k.width/2,y:k.y},ne:{x:k.x+k.width,y:k.y},e:{x:k.x+k.width,y:k.y+k.height/2},se:{x:k.x+k.width,y:k.y+k.height},s:{x:k.x+k.width/2,y:k.y+k.height},sw:{x:k.x,y:k.y+k.height},w:{x:k.x,y:k.y+k.height/2}}}function R(k){if(!d.value)return{x:0,y:0};const Y=d.value.getBoundingClientRect(),M=d.value.width/Y.width,B=d.value.height/Y.height;return{x:(k.clientX-Y.left)*M,y:(k.clientY-Y.top)*B}}function te(k){if(!d.value)return;const Y=R(k),M=m.selectedImageLayer;if(M){const re=_(Y.x,Y.y,M);if(re){u.value=!0,o.value=re,t.value=Y,n.value={x:M.x,y:M.y,width:M.width,height:M.height},k.preventDefault();return}}const B=z(Y.x,Y.y);B?(m.selectImageLayer(B.id),g.value=!0,t.value=Y,n.value={x:B.x,y:B.y,width:B.width,height:B.height},k.preventDefault()):m.selectImageLayer(null)}function ve(k){if(!d.value)return;const Y=R(k),M=m.selectedImageLayer;if(M&&!g.value&&!u.value){const B=_(Y.x,Y.y,M);B?d.value.style.cursor=X(B):ee(Y.x,Y.y,M)?d.value.style.cursor="move":d.value.style.cursor="default"}if(g.value&&M){const B=Y.x-t.value.x,re=Y.y-t.value.y;m.updateImageLayer(M.id,{x:n.value.x+B,y:n.value.y+re})}if(u.value&&M&&o.value){const B=Y.x-t.value.x,re=Y.y-t.value.y,ae=H(o.value,B,re,n.value,k.shiftKey);m.updateImageLayer(M.id,ae)}}function p(){(g.value||u.value)&&m.saveState("Layer verschoben/skaliert","layer"),g.value=!1,u.value=!1,o.value=null,d.value&&(d.value.style.cursor="default")}function H(k,Y,M,B,re=!1){let{x:ae,y:Xe,width:G,height:b}=B;const Le=B.width/B.height;switch(k){case"se":G=Math.max(50,B.width+Y),b=re?G/Le:Math.max(50,B.height+M);break;case"e":G=Math.max(50,B.width+Y),re&&(b=G/Le);break;case"s":b=Math.max(50,B.height+M),re&&(G=b*Le);break;case"nw":G=Math.max(50,B.width-Y),b=re?G/Le:Math.max(50,B.height-M),ae=B.x+B.width-G,Xe=B.y+B.height-b;break;case"ne":G=Math.max(50,B.width+Y),b=re?G/Le:Math.max(50,B.height-M),Xe=B.y+B.height-b;break;case"sw":G=Math.max(50,B.width-Y),b=re?G/Le:Math.max(50,B.height+M),ae=B.x+B.width-G;break;case"n":b=Math.max(50,B.height-M),re&&(G=b*Le),Xe=B.y+B.height-b;break;case"w":G=Math.max(50,B.width-Y),re&&(b=G/Le),ae=B.x+B.width-G;break}return{x:ae,y:Xe,width:G,height:b}}function X(k){return{nw:"nw-resize",n:"n-resize",ne:"ne-resize",e:"e-resize",se:"se-resize",s:"s-resize",sw:"sw-resize",w:"w-resize"}[k]||"default"}function T(){d.value&&(d.value.addEventListener("mousedown",te),window.addEventListener("mousemove",ve),window.addEventListener("mouseup",p))}function Z(){d.value&&d.value.removeEventListener("mousedown",te),window.removeEventListener("mousemove",ve),window.removeEventListener("mouseup",p)}return{isDragging:g,isResizing:u,activeHandle:o,findLayerAtPosition:z,findHandleAtPosition:_,getCanvasCoords:R,handleMouseDown:te,handleMouseMove:ve,handleMouseUp:p,initListeners:T,removeListeners:Z}}const ys={class:"transform-panel"},$s={key:0,class:"panel-section text-section"},xs={class:"section-header"},ks={class:"text-history-controls"},Cs=["disabled","title"],Ts=["disabled","title"],Is={class:"control-group"},Ss=["value","placeholder"],Ps={class:"control-group"},Ms={class:"value"},Bs=["value"],zs={class:"control-group"},Rs=["value"],Ls=["label"],Os=["value"],Us=["label"],Ds=["value"],Fs={class:"control-group"},Xs={class:"color-picker-row"},Ys=["value"],Es=["value"],As={class:"control-group"},Ws={class:"value"},Hs=["value"],Ns={key:0,class:"color-picker-row mt-2"},qs=["value"],Vs=["value"],js={class:"control-group"},Gs={class:"value"},Ks=["value"],Js={key:0,class:"shadow-controls"},Qs={class:"shadow-offset-row"},Zs={class:"mini-control"},_s=["value"],en={class:"mini-control"},tn=["value"],an={class:"color-picker-row mt-2"},sn=["value"],nn=["value"],on={class:"control-group"},ln={class:"value"},rn=["value"],un={class:"control-group"},dn={class:"value"},cn=["value"],fn={key:1,class:"panel-section text-hint"},vn={class:"hint-text"},hn={class:"panel-section"},pn={key:0,class:"aspect-ratio-section"},mn={class:"aspect-label"},gn={class:"aspect-ratio-grid"},wn=["onClick","title"],bn={class:"panel-section"},yn={class:"section-header"},$n={class:"transform-history-controls"},xn=["disabled","title"],kn=["disabled","title"],Cn={class:"control-group"},Tn={class:"label-text"},In={class:"slider-with-input"},Sn=["value"],Pn={class:"number-input-wrapper"},Mn=["value"],Bn={class:"control-group"},zn={class:"label-text"},Rn={class:"slider-with-input"},Ln=["value"],On={class:"number-input-wrapper"},Un=["value"],Dn={class:"button-group"},Fn=["title"],Xn=["title"],Yn=["title"],En={class:"button-group"},An=["title"],Wn=["title"],Hn={class:"control-group skew-section"},Nn={class:"label-text"},qn={class:"skew-control-row"},Vn={class:"mini-label"},jn={class:"slider-with-input compact"},Gn=["value"],Kn={class:"number-input-wrapper"},Jn=["value"],Qn={class:"skew-control-row"},Zn={class:"mini-label"},_n={class:"slider-with-input compact"},eo=["value"],to={class:"number-input-wrapper"},ao=["value"],so={class:"control-group"},no={class:"label-text"},oo={class:"slider-with-input"},lo=["value"],io={class:"number-input-wrapper"},ro=["value"],uo={key:0,class:"pan-info"},co={class:"pan-hint"},fo={class:"control-group"},vo={class:"label-text"},ho={class:"slider-with-input"},po=["value"],mo={class:"number-input-wrapper"},go=["value"],wo={class:"control-hint"},bo={class:"control-group"},yo={class:"label-text"},$o={class:"slider-with-input"},xo=["value"],ko={class:"number-input-wrapper"},Co=["value"],To={key:0,class:"color-picker-group"},Io=["value"],So={class:"color-label"},Po={class:"control-group shadow-section"},Mo={class:"shadow-toggle-label"},Bo={class:"label-text"},zo={key:0,class:"shadow-controls-panel"},Ro={class:"shadow-control-row"},Lo={class:"mini-label"},Oo={class:"slider-with-input compact"},Uo=["value"],Do={class:"number-input-wrapper"},Fo=["value"],Xo={class:"shadow-control-row"},Yo={class:"mini-label"},Eo={class:"slider-with-input compact"},Ao=["value"],Wo={class:"number-input-wrapper"},Ho=["value"],No={class:"shadow-control-row"},qo={class:"mini-label"},Vo={class:"slider-with-input compact"},jo=["value"],Go={class:"number-input-wrapper"},Ko=["value"],Jo={class:"shadow-control-row"},Qo={class:"mini-label"},Zo={class:"slider-with-input compact"},_o=["value"],el={class:"number-input-wrapper"},tl=["value"],al={class:"shadow-control-row"},sl={class:"mini-label"},nl={class:"color-picker-row"},ol=["value"],ll=["value"],il={__name:"TransformPanel",props:{cropMode:{type:Boolean,required:!0},hasCropped:{type:Boolean,required:!0},selectedAspectRatio:{type:String,default:"free"},aspectRatioPresets:{type:Array,default:()=>[]},transforms:{type:Object,required:!0},canPan:{type:Boolean,default:!1},hasPan:{type:Boolean,default:!1},selectedText:{type:Object,default:null},hasTexts:{type:Boolean,default:!1},canUndoText:{type:Boolean,default:!1},canRedoText:{type:Boolean,default:!1},canUndoTransform:{type:Boolean,default:!1},canRedoTransform:{type:Boolean,default:!1}},emits:["toggle-crop","undo-crop","set-aspect-ratio","update:opacity","update:rotation","update:scale","update:border-radius","update:border-width","update:border-color","update:shadow-enabled","update:shadow-offset-x","update:shadow-offset-y","update:shadow-blur","update:shadow-color","update:shadow-opacity","update:skew-x","update:skew-y","rotate-90","rotate-90-counter","rotate-180","flip-horizontal","flip-vertical","reset-pan","undo-transform","redo-transform","commit-transform","update:text-content","update:text-font-size","update:text-font-family","update:text-color","update:text-rotation","update:text-opacity","update:text-stroke-width","update:text-stroke-color","update:text-shadow-blur","update:text-shadow-offset-x","update:text-shadow-offset-y","update:text-shadow-color","save-text-history","undo-text","redo-text","delete-text","deselect-text"],setup(d){const{t:m}=ct({useScope:"global"}),g=["Arial","Helvetica","Times New Roman","Georgia","Verdana","Courier New"];[...wt,...g];function u(o){return o.id==="free"||o.id==="circle"?m(`transform.crop.presets.${o.id}`):o.label}return(o,t)=>(W(),N("aside",ys,[d.selectedText?(W(),N("div",$s,[e("div",xs,[e("h3",null,[t[94]||(t[94]=e("i",{class:"fas fa-font"},null,-1)),F(" "+v(o.$t("textPanel.title","Text bearbeiten")),1)]),e("div",ks,[e("button",{class:"btn-icon-small",onClick:t[0]||(t[0]=n=>o.$emit("undo-text")),disabled:!d.canUndoText,title:o.$t("textPanel.undo","Rückgängig")},[...t[95]||(t[95]=[e("i",{class:"fas fa-undo"},null,-1)])],8,Cs),e("button",{class:"btn-icon-small",onClick:t[1]||(t[1]=n=>o.$emit("redo-text")),disabled:!d.canRedoText,title:o.$t("textPanel.redo","Wiederherstellen")},[...t[96]||(t[96]=[e("i",{class:"fas fa-redo"},null,-1)])],8,Ts)])]),e("div",Is,[e("label",null,[t[97]||(t[97]=e("i",{class:"fas fa-i-cursor"},null,-1)),F(" "+v(o.$t("textPanel.content","Text")),1)]),e("input",{type:"text",value:d.selectedText.content||d.selectedText.txt,onInput:t[2]||(t[2]=n=>o.$emit("update:text-content",n.target.value)),onChange:t[3]||(t[3]=n=>o.$emit("save-text-history")),class:"text-input",placeholder:o.$t("textPanel.placeholder","Text eingeben...")},null,40,Ss)]),e("div",Ps,[e("label",null,[t[98]||(t[98]=e("i",{class:"fas fa-text-height"},null,-1)),F(" "+v(o.$t("textPanel.fontSize","Schriftgröße"))+" ",1),e("span",Ms,v(d.selectedText.fontSize||d.selectedText.size||32)+"px",1)]),e("input",{type:"range",min:"8",max:"200",value:d.selectedText.fontSize||d.selectedText.size||32,onInput:t[4]||(t[4]=n=>o.$emit("update:text-font-size",Number(n.target.value))),onChange:t[5]||(t[5]=n=>o.$emit("save-text-history")),class:"slider"},null,40,Bs)]),e("div",zs,[e("label",null,[t[99]||(t[99]=e("i",{class:"fas fa-font"},null,-1)),F(" "+v(o.$t("textPanel.fontFamily","Schriftart")),1)]),e("select",{value:d.selectedText.fontFamily||"Satoshi Regular",onChange:t[6]||(t[6]=n=>o.$emit("update:text-font-family",n.target.value)),class:"font-select"},[e("optgroup",{label:o.$t("textPanel.customFonts","Benutzerdefinierte Schriften")},[(W(!0),N(qe,null,Je($(wt),n=>(W(),N("option",{key:n,value:n,style:je({fontFamily:n})},v(n),13,Os))),128))],8,Ls),e("optgroup",{label:o.$t("textPanel.systemFonts","System-Schriften")},[(W(),N(qe,null,Je(g,n=>e("option",{key:n,value:n,style:je({fontFamily:n})},v(n),13,Ds)),64))],8,Us)],40,Rs)]),e("div",Fs,[e("label",null,[t[100]||(t[100]=e("i",{class:"fas fa-palette"},null,-1)),F(" "+v(o.$t("textPanel.color","Farbe")),1)]),e("div",Xs,[e("input",{type:"color",value:d.selectedText.color||"#000000",onInput:t[7]||(t[7]=n=>o.$emit("update:text-color",n.target.value)),onChange:t[8]||(t[8]=n=>o.$emit("save-text-history")),class:"color-input",style:je({backgroundColor:d.selectedText.color||"#000000"})},null,44,Ys),e("input",{type:"text",value:d.selectedText.color||"#000000",onInput:t[9]||(t[9]=n=>o.$emit("update:text-color",n.target.value)),onChange:t[10]||(t[10]=n=>o.$emit("save-text-history")),class:"color-text",maxlength:"7"},null,40,Es)])]),e("div",As,[e("label",null,[t[101]||(t[101]=e("i",{class:"fas fa-border-style"},null,-1)),F(" "+v(o.$t("textPanel.strokeWidth","Umrandung"))+" ",1),e("span",Ws,v(d.selectedText.strokeWidth||0)+"px",1)]),e("input",{type:"range",min:"0",max:"50",value:d.selectedText.strokeWidth||0,onInput:t[11]||(t[11]=n=>o.$emit("update:text-stroke-width",Number(n.target.value))),onChange:t[12]||(t[12]=n=>o.$emit("save-text-history")),class:"slider"},null,40,Hs),(d.selectedText.strokeWidth||0)>0?(W(),N("div",Ns,[e("input",{type:"color",value:d.selectedText.strokeColor||"#000000",onInput:t[13]||(t[13]=n=>o.$emit("update:text-stroke-color",n.target.value)),onChange:t[14]||(t[14]=n=>o.$emit("save-text-history")),class:"color-input",style:je({backgroundColor:d.selectedText.strokeColor||"#000000"})},null,44,qs),e("input",{type:"text",value:d.selectedText.strokeColor||"#000000",onInput:t[15]||(t[15]=n=>o.$emit("update:text-stroke-color",n.target.value)),onChange:t[16]||(t[16]=n=>o.$emit("save-text-history")),class:"color-text",maxlength:"7"},null,40,Vs)])):me("",!0)]),e("div",js,[e("label",null,[t[102]||(t[102]=e("i",{class:"fas fa-clone"},null,-1)),F(" "+v(o.$t("textPanel.shadow","Schatten"))+" ",1),e("span",Gs,v(d.selectedText.shadowBlur||0)+"px",1)]),e("input",{type:"range",min:"0",max:"20",value:d.selectedText.shadowBlur||0,onInput:t[17]||(t[17]=n=>o.$emit("update:text-shadow-blur",Number(n.target.value))),onChange:t[18]||(t[18]=n=>o.$emit("save-text-history")),class:"slider"},null,40,Ks),(d.selectedText.shadowBlur||0)>0?(W(),N("div",Js,[e("div",Qs,[e("div",Zs,[t[103]||(t[103]=e("label",null,"X",-1)),e("input",{type:"number",min:"-50",max:"50",value:d.selectedText.shadowOffsetX??2,onInput:t[19]||(t[19]=n=>o.$emit("update:text-shadow-offset-x",Number(n.target.value))),onChange:t[20]||(t[20]=n=>o.$emit("save-text-history")),class:"mini-input"},null,40,_s)]),e("div",en,[t[104]||(t[104]=e("label",null,"Y",-1)),e("input",{type:"number",min:"-50",max:"50",value:d.selectedText.shadowOffsetY??2,onInput:t[21]||(t[21]=n=>o.$emit("update:text-shadow-offset-y",Number(n.target.value))),onChange:t[22]||(t[22]=n=>o.$emit("save-text-history")),class:"mini-input"},null,40,tn)])]),e("div",an,[e("input",{type:"color",value:d.selectedText.shadowColor||"#000000",onInput:t[23]||(t[23]=n=>o.$emit("update:text-shadow-color",n.target.value)),onChange:t[24]||(t[24]=n=>o.$emit("save-text-history")),class:"color-input",style:je({backgroundColor:d.selectedText.shadowColor||"#000000"})},null,44,sn),e("input",{type:"text",value:d.selectedText.shadowColor||"#000000",onInput:t[25]||(t[25]=n=>o.$emit("update:text-shadow-color",n.target.value)),onChange:t[26]||(t[26]=n=>o.$emit("save-text-history")),class:"color-text",maxlength:"7"},null,40,nn)])])):me("",!0)]),e("div",on,[e("label",null,[t[105]||(t[105]=e("i",{class:"fas fa-redo"},null,-1)),F(" "+v(o.$t("textPanel.rotation","Rotation"))+" ",1),e("span",ln,v(d.selectedText.rotation||0)+"°",1)]),e("input",{type:"range",min:"-180",max:"180",value:d.selectedText.rotation||0,onInput:t[27]||(t[27]=n=>o.$emit("update:text-rotation",Number(n.target.value))),onChange:t[28]||(t[28]=n=>o.$emit("save-text-history")),class:"slider"},null,40,rn)]),e("div",un,[e("label",null,[t[106]||(t[106]=e("i",{class:"fas fa-adjust"},null,-1)),F(" "+v(o.$t("textPanel.opacity","Opacity"))+" ",1),e("span",dn,v(d.selectedText.opacity!==void 0?d.selectedText.opacity:100)+"%",1)]),e("input",{type:"range",min:"0",max:"100",value:d.selectedText.opacity!==void 0?d.selectedText.opacity:100,onInput:t[29]||(t[29]=n=>o.$emit("update:text-opacity",Number(n.target.value))),onChange:t[30]||(t[30]=n=>o.$emit("save-text-history")),class:"slider"},null,40,cn)]),e("button",{class:"transform-btn delete-btn",onClick:t[31]||(t[31]=n=>o.$emit("delete-text"))},[t[107]||(t[107]=e("i",{class:"fas fa-trash"},null,-1)),e("span",null,v(o.$t("textPanel.delete","Text löschen")),1)]),e("button",{class:"transform-btn",onClick:t[32]||(t[32]=n=>o.$emit("deselect-text"))},[t[108]||(t[108]=e("i",{class:"fas fa-times"},null,-1)),e("span",null,v(o.$t("textPanel.deselect","Auswahl aufheben")),1)])])):d.hasTexts?(W(),N("div",fn,[e("p",vn,[t[109]||(t[109]=e("i",{class:"fas fa-mouse-pointer"},null,-1)),F(" "+v(o.$t("textPanel.selectHint","Klicken Sie auf einen Text im Bild, um ihn zu bearbeiten")),1)])])):me("",!0),e("div",hn,[e("h3",null,[t[110]||(t[110]=e("i",{class:"fas fa-crop"},null,-1)),F(" "+v(o.$t("transform.crop.title")),1)]),e("button",{class:de(["transform-btn",{active:d.cropMode}]),onClick:t[33]||(t[33]=n=>o.$emit("toggle-crop"))},[e("i",{class:de(d.cropMode?"fas fa-check":"fas fa-crop")},null,2),e("span",null,v(d.cropMode?o.$t("transform.crop.confirm"):o.$t("transform.crop.button")),1)],2),d.cropMode?(W(),N("div",pn,[e("label",mn,[t[111]||(t[111]=e("i",{class:"fas fa-expand-arrows-alt"},null,-1)),F(" "+v(o.$t("transform.crop.aspectRatio")),1)]),e("div",gn,[(W(!0),N(qe,null,Je(d.aspectRatioPresets,n=>(W(),N("button",{key:n.id,class:de(["aspect-btn",{active:d.selectedAspectRatio===n.id}]),onClick:y=>o.$emit("set-aspect-ratio",n.id),title:u(n)},[e("i",{class:de("fas "+n.icon)},null,2),e("span",null,v(u(n)),1)],10,wn))),128))])])):me("",!0),d.hasCropped?(W(),N("button",{key:1,class:"transform-btn undo-btn",onClick:t[34]||(t[34]=n=>o.$emit("undo-crop"))},[t[112]||(t[112]=e("i",{class:"fas fa-undo"},null,-1)),e("span",null,v(o.$t("transform.crop.undo")),1)])):me("",!0)]),e("div",bn,[e("div",yn,[e("h3",null,[t[113]||(t[113]=e("i",{class:"fas fa-magic"},null,-1)),F(" "+v(o.$t("transform.title")),1)]),e("div",$n,[e("button",{class:"btn-icon-small",onClick:t[35]||(t[35]=n=>o.$emit("undo-transform")),disabled:!d.canUndoTransform,title:o.$t("transform.undo","Rückgängig")},[...t[114]||(t[114]=[e("i",{class:"fas fa-undo"},null,-1)])],8,xn),e("button",{class:"btn-icon-small",onClick:t[36]||(t[36]=n=>o.$emit("redo-transform")),disabled:!d.canRedoTransform,title:o.$t("transform.redo","Wiederherstellen")},[...t[115]||(t[115]=[e("i",{class:"fas fa-redo"},null,-1)])],8,kn)])]),e("div",Cn,[e("label",null,[e("span",Tn,[t[116]||(t[116]=e("i",{class:"fas fa-adjust"},null,-1)),F(" "+v(o.$t("transform.opacity")),1)])]),e("div",In,[e("input",{type:"range",min:"0",max:"100",value:d.transforms.opacity,onInput:t[37]||(t[37]=n=>o.$emit("update:opacity",Number(n.target.value))),onChange:t[38]||(t[38]=n=>o.$emit("commit-transform")),class:"slider"},null,40,Sn),e("div",Pn,[e("input",{type:"number",min:"0",max:"100",value:d.transforms.opacity,onInput:t[39]||(t[39]=n=>o.$emit("update:opacity",Math.min(100,Math.max(0,Number(n.target.value))))),onChange:t[40]||(t[40]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Mn),t[117]||(t[117]=e("span",{class:"unit"},"%",-1))])])]),e("div",Bn,[e("label",null,[e("span",zn,[t[118]||(t[118]=e("i",{class:"fas fa-redo"},null,-1)),F(" "+v(o.$t("transform.rotation")),1)])]),e("div",Rn,[e("input",{type:"range",min:"-180",max:"180",value:d.transforms.rotation,onInput:t[41]||(t[41]=n=>o.$emit("update:rotation",Number(n.target.value))),onChange:t[42]||(t[42]=n=>o.$emit("commit-transform")),class:"slider"},null,40,Ln),e("div",On,[e("input",{type:"number",min:"-180",max:"180",value:d.transforms.rotation,onInput:t[43]||(t[43]=n=>o.$emit("update:rotation",Math.min(180,Math.max(-180,Number(n.target.value))))),onChange:t[44]||(t[44]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Un),t[119]||(t[119]=e("span",{class:"unit"},"°",-1))])])]),e("div",Dn,[e("button",{class:"quick-btn",onClick:t[45]||(t[45]=n=>o.$emit("rotate-90-counter")),title:o.$t("transform.rotationTooltip.counterClockwise")},[...t[120]||(t[120]=[e("i",{class:"fas fa-undo"},null,-1),F(" 90° ",-1)])],8,Fn),e("button",{class:"quick-btn",onClick:t[46]||(t[46]=n=>o.$emit("rotate-180")),title:o.$t("transform.rotationTooltip.rotate180")},[...t[121]||(t[121]=[e("i",{class:"fas fa-sync"},null,-1),F(" 180° ",-1)])],8,Xn),e("button",{class:"quick-btn",onClick:t[47]||(t[47]=n=>o.$emit("rotate-90")),title:o.$t("transform.rotationTooltip.clockwise")},[...t[122]||(t[122]=[e("i",{class:"fas fa-redo"},null,-1),F(" 90° ",-1)])],8,Yn)]),e("div",En,[e("button",{class:de(["quick-btn",{active:d.transforms.flipHorizontal}]),onClick:t[48]||(t[48]=n=>o.$emit("flip-horizontal")),title:o.$t("transform.flip.horizontalTooltip")},[t[123]||(t[123]=e("i",{class:"fas fa-arrows-alt-h"},null,-1)),F(" "+v(o.$t("transform.flip.horizontal")),1)],10,An),e("button",{class:de(["quick-btn",{active:d.transforms.flipVertical}]),onClick:t[49]||(t[49]=n=>o.$emit("flip-vertical")),title:o.$t("transform.flip.verticalTooltip")},[t[124]||(t[124]=e("i",{class:"fas fa-arrows-alt-v"},null,-1)),F(" "+v(o.$t("transform.flip.vertical")),1)],10,Wn)]),e("div",Hn,[e("label",null,[e("span",Nn,[t[125]||(t[125]=e("i",{class:"fas fa-italic"},null,-1)),F(" "+v(o.$t("transform.skew.title","Neigung")),1)])]),e("div",qn,[e("label",Vn,[t[126]||(t[126]=e("i",{class:"fas fa-arrows-alt-h"},null,-1)),F(" "+v(o.$t("transform.skew.horizontal","Horizontal")),1)]),e("div",jn,[e("input",{type:"range",min:"-45",max:"45",value:d.transforms.skewX,onInput:t[50]||(t[50]=n=>o.$emit("update:skew-x",Number(n.target.value))),onChange:t[51]||(t[51]=n=>o.$emit("commit-transform")),class:"slider"},null,40,Gn),e("div",Kn,[e("input",{type:"number",min:"-45",max:"45",value:d.transforms.skewX,onInput:t[52]||(t[52]=n=>o.$emit("update:skew-x",Math.min(45,Math.max(-45,Number(n.target.value))))),onChange:t[53]||(t[53]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Jn),t[127]||(t[127]=e("span",{class:"unit"},"°",-1))])])]),e("div",Qn,[e("label",Zn,[t[128]||(t[128]=e("i",{class:"fas fa-arrows-alt-v"},null,-1)),F(" "+v(o.$t("transform.skew.vertical","Vertikal")),1)]),e("div",_n,[e("input",{type:"range",min:"-45",max:"45",value:d.transforms.skewY,onInput:t[54]||(t[54]=n=>o.$emit("update:skew-y",Number(n.target.value))),onChange:t[55]||(t[55]=n=>o.$emit("commit-transform")),class:"slider"},null,40,eo),e("div",to,[e("input",{type:"number",min:"-45",max:"45",value:d.transforms.skewY,onInput:t[56]||(t[56]=n=>o.$emit("update:skew-y",Math.min(45,Math.max(-45,Number(n.target.value))))),onChange:t[57]||(t[57]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,ao),t[129]||(t[129]=e("span",{class:"unit"},"°",-1))])])])]),e("div",so,[e("label",null,[e("span",no,[t[130]||(t[130]=e("i",{class:"fas fa-search-plus"},null,-1)),F(" "+v(o.$t("transform.zoom")),1)])]),e("div",oo,[e("input",{type:"range",min:"10",max:"200",value:d.transforms.scale,onInput:t[58]||(t[58]=n=>o.$emit("update:scale",Number(n.target.value))),onChange:t[59]||(t[59]=n=>o.$emit("commit-transform")),class:"slider"},null,40,lo),e("div",io,[e("input",{type:"number",min:"10",max:"200",value:d.transforms.scale,onInput:t[60]||(t[60]=n=>o.$emit("update:scale",Math.min(200,Math.max(10,Number(n.target.value))))),onChange:t[61]||(t[61]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,ro),t[131]||(t[131]=e("span",{class:"unit"},"%",-1))])])]),d.canPan?(W(),N("div",uo,[e("p",co,[t[132]||(t[132]=e("i",{class:"fas fa-hand-paper"},null,-1)),F(" "+v(o.$t("transform.panHint","Leertaste + Ziehen oder Mausrad-Klick zum Verschieben")),1)]),d.hasPan?(W(),N("button",{key:0,class:"transform-btn pan-reset-btn",onClick:t[62]||(t[62]=n=>o.$emit("reset-pan"))},[t[133]||(t[133]=e("i",{class:"fas fa-compress-arrows-alt"},null,-1)),e("span",null,v(o.$t("transform.resetPan","Ansicht zentrieren")),1)])):me("",!0)])):me("",!0),e("div",fo,[e("label",null,[e("span",vo,[t[134]||(t[134]=e("i",{class:"fas fa-circle"},null,-1)),F(" "+v(o.$t("transform.borderRadius")),1)])]),e("div",ho,[e("input",{type:"range",min:"0",max:"50",value:d.transforms.borderRadius,onInput:t[63]||(t[63]=n=>o.$emit("update:border-radius",Number(n.target.value))),onChange:t[64]||(t[64]=n=>o.$emit("commit-transform")),class:"slider"},null,40,po),e("div",mo,[e("input",{type:"number",min:"0",max:"50",value:d.transforms.borderRadius,onInput:t[65]||(t[65]=n=>o.$emit("update:border-radius",Math.min(50,Math.max(0,Number(n.target.value))))),onChange:t[66]||(t[66]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,go),t[135]||(t[135]=e("span",{class:"unit"},"%",-1))])]),e("p",wo,v(o.$t("transform.borderRadiusHint","50% = vollständiger Kreis")),1)]),e("div",bo,[e("label",null,[e("span",yo,[t[136]||(t[136]=e("i",{class:"fas fa-border-style"},null,-1)),F(" "+v(o.$t("transform.border")),1)])]),e("div",$o,[e("input",{type:"range",min:"0",max:"20",value:d.transforms.borderWidth,onInput:t[67]||(t[67]=n=>o.$emit("update:border-width",Number(n.target.value))),onChange:t[68]||(t[68]=n=>o.$emit("commit-transform")),class:"slider"},null,40,xo),e("div",ko,[e("input",{type:"number",min:"0",max:"20",value:d.transforms.borderWidth,onInput:t[69]||(t[69]=n=>o.$emit("update:border-width",Math.min(20,Math.max(0,Number(n.target.value))))),onChange:t[70]||(t[70]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Co),t[137]||(t[137]=e("span",{class:"unit"},"px",-1))])]),d.transforms.borderWidth>0?(W(),N("div",To,[e("input",{type:"color",value:d.transforms.borderColor,onInput:t[71]||(t[71]=n=>o.$emit("update:border-color",n.target.value)),onChange:t[72]||(t[72]=n=>o.$emit("commit-transform")),class:"color-input"},null,40,Io),e("span",So,v(o.$t("transform.borderColor")),1)])):me("",!0)]),e("div",Po,[e("label",Mo,[e("span",Bo,[t[138]||(t[138]=e("i",{class:"fas fa-clone"},null,-1)),F(" "+v(o.$t("transform.shadow.title","Schlagschatten")),1)]),e("button",{class:de(["toggle-btn",{active:d.transforms.shadowEnabled}]),onClick:t[73]||(t[73]=n=>o.$emit("update:shadow-enabled",!d.transforms.shadowEnabled))},[...t[139]||(t[139]=[e("span",{class:"toggle-slider"},null,-1)])],2)]),d.transforms.shadowEnabled?(W(),N("div",zo,[e("div",Ro,[e("label",Lo,[t[140]||(t[140]=e("i",{class:"fas fa-arrows-alt-h"},null,-1)),F(" "+v(o.$t("transform.shadow.offsetX","X-Versatz")),1)]),e("div",Oo,[e("input",{type:"range",min:"-50",max:"50",value:d.transforms.shadowOffsetX,onInput:t[74]||(t[74]=n=>o.$emit("update:shadow-offset-x",Number(n.target.value))),onChange:t[75]||(t[75]=n=>o.$emit("commit-transform")),class:"slider"},null,40,Uo),e("div",Do,[e("input",{type:"number",min:"-50",max:"50",value:d.transforms.shadowOffsetX,onInput:t[76]||(t[76]=n=>o.$emit("update:shadow-offset-x",Math.min(50,Math.max(-50,Number(n.target.value))))),onChange:t[77]||(t[77]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Fo),t[141]||(t[141]=e("span",{class:"unit"},"px",-1))])])]),e("div",Xo,[e("label",Yo,[t[142]||(t[142]=e("i",{class:"fas fa-arrows-alt-v"},null,-1)),F(" "+v(o.$t("transform.shadow.offsetY","Y-Versatz")),1)]),e("div",Eo,[e("input",{type:"range",min:"-50",max:"50",value:d.transforms.shadowOffsetY,onInput:t[78]||(t[78]=n=>o.$emit("update:shadow-offset-y",Number(n.target.value))),onChange:t[79]||(t[79]=n=>o.$emit("commit-transform")),class:"slider"},null,40,Ao),e("div",Wo,[e("input",{type:"number",min:"-50",max:"50",value:d.transforms.shadowOffsetY,onInput:t[80]||(t[80]=n=>o.$emit("update:shadow-offset-y",Math.min(50,Math.max(-50,Number(n.target.value))))),onChange:t[81]||(t[81]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Ho),t[143]||(t[143]=e("span",{class:"unit"},"px",-1))])])]),e("div",No,[e("label",qo,[t[144]||(t[144]=e("i",{class:"fas fa-adjust"},null,-1)),F(" "+v(o.$t("transform.shadow.blur","Weichzeichner")),1)]),e("div",Vo,[e("input",{type:"range",min:"0",max:"100",value:d.transforms.shadowBlur,onInput:t[82]||(t[82]=n=>o.$emit("update:shadow-blur",Number(n.target.value))),onChange:t[83]||(t[83]=n=>o.$emit("commit-transform")),class:"slider"},null,40,jo),e("div",Go,[e("input",{type:"number",min:"0",max:"100",value:d.transforms.shadowBlur,onInput:t[84]||(t[84]=n=>o.$emit("update:shadow-blur",Math.min(100,Math.max(0,Number(n.target.value))))),onChange:t[85]||(t[85]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,Ko),t[145]||(t[145]=e("span",{class:"unit"},"px",-1))])])]),e("div",Jo,[e("label",Qo,[t[146]||(t[146]=e("i",{class:"fas fa-eye"},null,-1)),F(" "+v(o.$t("transform.shadow.opacity","Deckkraft")),1)]),e("div",Zo,[e("input",{type:"range",min:"0",max:"100",value:d.transforms.shadowOpacity,onInput:t[86]||(t[86]=n=>o.$emit("update:shadow-opacity",Number(n.target.value))),onChange:t[87]||(t[87]=n=>o.$emit("commit-transform")),class:"slider"},null,40,_o),e("div",el,[e("input",{type:"number",min:"0",max:"100",value:d.transforms.shadowOpacity,onInput:t[88]||(t[88]=n=>o.$emit("update:shadow-opacity",Math.min(100,Math.max(0,Number(n.target.value))))),onChange:t[89]||(t[89]=n=>o.$emit("commit-transform")),class:"number-input"},null,40,tl),t[147]||(t[147]=e("span",{class:"unit"},"%",-1))])])]),e("div",al,[e("label",sl,[t[148]||(t[148]=e("i",{class:"fas fa-palette"},null,-1)),F(" "+v(o.$t("transform.shadow.color","Farbe")),1)]),e("div",nl,[e("input",{type:"color",value:d.transforms.shadowColor,onInput:t[90]||(t[90]=n=>o.$emit("update:shadow-color",n.target.value)),onChange:t[91]||(t[91]=n=>o.$emit("commit-transform")),class:"color-input",style:je({backgroundColor:d.transforms.shadowColor})},null,44,ol),e("input",{type:"text",value:d.transforms.shadowColor,onInput:t[92]||(t[92]=n=>o.$emit("update:shadow-color",n.target.value)),onChange:t[93]||(t[93]=n=>o.$emit("commit-transform")),class:"color-text",maxlength:"7"},null,40,ll)])])])):me("",!0)])])]))}},rl=bt(il,[["__scopeId","data-v-da99d6ab"]]),ul={class:"layer-control-panel"},dl={class:"tab-nav"},cl={class:"history-toolbar"},fl=["disabled","title"],vl=["disabled","title"],hl=["title"],pl={key:0,class:"history-info"},ml={class:"tab-content"},gl={class:"panel-section"},wl={class:"section-title"},bl={class:"layer-list"},yl=["onClick"],$l={class:"layer-preview"},xl=["src","alt"],kl={class:"layer-info"},Cl={class:"layer-name"},Tl={class:"layer-size"},Il={class:"layer-actions"},Sl=["onClick","title"],Pl=["onClick","title"],Ml={key:0,class:"layer-order-buttons"},Bl=["title"],zl=["title"],Rl=["title"],Ll={class:"panel-section"},Ol={class:"section-content"},Ul={class:"control-group"},Dl={class:"color-picker-row"},Fl=["value"],Xl=["value"],Yl=["title"],El={class:"quick-colors"},Al=["onClick","title"],Wl={key:0,class:"fas fa-chess-board"},Hl={key:0,class:"panel-section"},Nl={class:"section-content"},ql={class:"control-group"},Vl={class:"input-row"},jl={class:"input-field"},Gl=["value"],Kl={class:"input-field"},Jl=["value"],Ql={class:"control-group"},Zl={class:"input-row"},_l={class:"input-field"},ei=["value"],ti={class:"input-field"},ai=["value"],si=["title"],ni={class:"control-group"},oi=["value"],li={class:"quick-rotate"},ii={class:"control-group"},ri={class:"flip-buttons"},ui=["title"],di=["title"],ci={class:"control-group"},fi=["value"],vi={key:1,class:"panel-section"},hi={class:"section-content"},pi={class:"control-group"},mi=["value"],gi={class:"control-group"},wi=["value"],bi={class:"control-group"},yi=["value"],$i={class:"control-group"},xi=["value"],ki={key:2,class:"panel-section"},Ci={class:"section-content"},Ti={class:"control-group"},Ii=["value"],Si={class:"control-group"},Pi={class:"color-picker-row"},Mi=["value"],Bi=["value"],zi={class:"control-group"},Ri=["value"],Li={key:3,class:"panel-section"},Oi={class:"section-content"},Ui={class:"control-group"},Di={class:"toggle-label"},Fi=["checked"],Xi={class:"control-group"},Yi=["value"],Ei={class:"control-group"},Ai=["value"],Wi={class:"control-group"},Hi=["value"],Ni={class:"control-group"},qi={class:"color-picker-row"},Vi=["value"],ji=["value"],Gi={class:"control-group"},Ki=["value"],Ji={key:4,class:"panel-section"},Qi={class:"hint-text"},Zi={class:"tab-content"},_i={class:"panel-section"},er={key:0,class:"panel-section"},tr={class:"section-title"},ar={class:"text-list"},sr=["onClick"],nr={class:"text-info"},or={class:"text-content"},lr={class:"text-meta"},ir=["onClick","title"],rr={key:1,class:"panel-section"},ur={class:"section-title"},dr={class:"control-group"},cr=["value"],fr={class:"control-group"},vr=["value"],hr={class:"control-group"},pr=["value"],mr=["label"],gr=["value"],wr=["label"],br=["value"],yr={class:"control-group"},$r={class:"color-picker-row"},xr=["value"],kr=["value"],Cr={class:"control-group"},Tr=["value"],Ir={class:"control-group"},Sr=["value"],Pr={class:"subsection-title"},Mr={class:"control-group"},Br=["value"],zr={key:0,class:"control-group"},Rr={class:"color-picker-row"},Lr=["value"],Or=["value"],Ur={class:"subsection-title"},Dr={class:"control-group"},Fr=["value"],Xr={class:"control-group"},Yr=["value"],Er={class:"control-group"},Ar=["value"],Wr={class:"control-group"},Hr={class:"color-picker-row"},Nr=["value"],qr=["value"],Vr={key:2,class:"panel-section"},jr={class:"hint-text"},Gr={__name:"LayerControlPanel",props:{canvasSelectedTextId:{type:String,default:null}},emits:["render","add-text","select-text","preview"],setup(d,{emit:m}){const{t:g}=ct(),u=d,o=m,t=Mt(),n=D(!0),y=D("layers"),z=D(null);let ee=null;function _(r,i="layer"){ee&&clearTimeout(ee),ee=setTimeout(()=>{t.saveState(r,i),ee=null},500)}function fe(r,i="layer"){ee&&(clearTimeout(ee),ee=null),t.saveState(r,i)}ot(()=>u.canvasSelectedTextId,r=>{r?(z.value=r,y.value="text",t.selectImageLayer(null)):t.selectedLayerId&&(y.value="layers",z.value=null)}),ot(()=>t.selectedLayerId,r=>{r&&(y.value="layers",z.value=null)});const R=is({canvas:!0,transform:!0,filters:!1,border:!1,shadow:!1}),te=ce(()=>[{value:"transparent",label:g("layerPanel.background.transparent")},{value:"#ffffff",label:g("layerPanel.background.white")},{value:"#000000",label:g("layerPanel.background.black")},{value:"#f0f0f0",label:g("layerPanel.background.lightGray")},{value:"#808080",label:g("layerPanel.background.gray")},{value:"#ff0000",label:g("layerPanel.background.red")},{value:"#00ff00",label:g("layerPanel.background.green")},{value:"#0000ff",label:g("layerPanel.background.blue")}]),ve=["Arial","Helvetica","Times New Roman","Georgia","Verdana","Courier New","Impact","Tahoma","Trebuchet MS"],p=ce(()=>t.selectedImageLayer),H=ce(()=>[...t.imageLayers].reverse()),X=ce(()=>!z.value||!t.texts?null:t.texts.find(r=>r.id===z.value)),T=ce(()=>{const r=t.historyIndex+1,i=t.history.length;return i===0?"":`${r}/${i}`}),Z=ce(()=>{var r,i,c,j,oe,Te;return{width:((i=(r=p.value)==null?void 0:r.border)==null?void 0:i.width)||0,color:((j=(c=p.value)==null?void 0:c.border)==null?void 0:j.color)||"#000000",radius:((Te=(oe=p.value)==null?void 0:oe.border)==null?void 0:Te.radius)||0}}),k=ce(()=>{var r,i,c,j,oe,Te,ye,he,Ye,Ee,Oe,at;return{enabled:((i=(r=p.value)==null?void 0:r.shadow)==null?void 0:i.enabled)||!1,offsetX:((j=(c=p.value)==null?void 0:c.shadow)==null?void 0:j.offsetX)||5,offsetY:((Te=(oe=p.value)==null?void 0:oe.shadow)==null?void 0:Te.offsetY)||5,blur:((he=(ye=p.value)==null?void 0:ye.shadow)==null?void 0:he.blur)||10,color:((Ee=(Ye=p.value)==null?void 0:Ye.shadow)==null?void 0:Ee.color)||"#000000",opacity:((at=(Oe=p.value)==null?void 0:Oe.shadow)==null?void 0:at.opacity)||50}});function Y(r){R[r]=!R[r]}function M(r){t.canvasBackgroundColor=r,o("render"),_("Hintergrundfarbe geändert","layer")}function B(r){t.selectImageLayer(r),o("render")}function re(r){t.updateImageLayer(r.id,{visible:!r.visible}),o("render"),fe(r.visible?"Layer ausgeblendet":"Layer eingeblendet","layer")}function ae(r){confirm(g("layerPanel.layers.confirmDelete"))&&(t.deleteImageLayer(r),o("render"))}function Xe(r){p.value&&(t.moveImageLayerOrder(p.value.id,r),o("render"))}function G(){p.value&&(t.duplicateImageLayer(p.value.id),o("render"))}function b(r,i){p.value&&(t.updateImageLayer(p.value.id,{[r]:i}),o("render"),_(`Layer ${r} geändert`,"layer"))}function Le(r,i){if(!p.value)return;const c=p.value,j=c.originalWidth/c.originalHeight;n.value?r==="width"?t.updateImageLayer(c.id,{width:i,height:i/j}):t.updateImageLayer(c.id,{width:i*j,height:i}):t.updateImageLayer(c.id,{[r]:i}),o("render"),_("Layer-Größe geändert","layer")}function L(r){if(p.value){const i=(p.value.rotation+r)%360;b("rotation",i)}}function Be(r){if(p.value){const i=p.value[r]||!1;t.updateImageLayer(p.value.id,{[r]:!i}),o("render"),fe(r==="flipX"?"Horizontal gespiegelt":"Vertikal gespiegelt","layer")}}function Ce(r,i){if(p.value){const c={...p.value.filters,[r]:i};t.updateImageLayer(p.value.id,{filters:c}),o("render"),_(`Layer-Filter ${r} geändert`,"layer")}}function Ge(r,i){if(p.value){const j={...p.value.border||{width:0,color:"#000000",radius:0},[r]:i};t.updateImageLayer(p.value.id,{border:j}),o("render"),_("Layer-Umrandung geändert","layer")}}function We(r,i){if(p.value){const j={...p.value.shadow||{enabled:!1,offsetX:5,offsetY:5,blur:10,color:"#000000",opacity:50},[r]:i};t.updateImageLayer(p.value.id,{shadow:j}),o("render"),_("Layer-Schatten geändert","layer")}}function V(){p.value&&(t.updateImageLayer(p.value.id,{filters:{brightness:100,contrast:100,saturation:100,grayscale:0,sepia:0,blur:0,hue:0},rotation:0,opacity:100,border:{width:0,color:"#000000",radius:0},shadow:{enabled:!1,offsetX:5,offsetY:5,blur:10,color:"#000000",opacity:50}}),o("render"),fe("Layer-Filter zurückgesetzt","layer"))}function E(){const r={id:`text_${Date.now()}`,content:g("layerPanel.text.newText"),x:100,y:100,fontSize:48,fontFamily:wt[0]||"Arial",color:"#000000",opacity:100,rotation:0,strokeWidth:0,strokeColor:"#ffffff",shadowBlur:0,shadowOffsetX:2,shadowOffsetY:2,shadowColor:"#000000"};t.texts||(t.texts=[]),t.texts.push(r),z.value=r.id,o("render")}function O(r){z.value=r,t.selectImageLayer(null),o("select-text",r),o("render")}function S(r){if(confirm(g("layerPanel.text.confirmDelete"))){const i=t.texts.findIndex(c=>c.id===r);i!==-1&&(t.texts.splice(i,1),z.value===r&&(z.value=null),o("render"))}}function A(r,i){if(X.value){const c=t.texts.findIndex(j=>j.id===X.value.id);c!==-1&&(t.texts[c][r]=i,r==="content"&&(t.texts[c].txt=i),o("render"))}}function J(){t.canUndo&&(t.undo(),o("render"))}function ue(){t.canRedo&&(t.redo(),o("render"))}function we(){o("render"),o("preview")}function I(r){(r.ctrlKey||r.metaKey)&&!r.shiftKey&&r.key==="z"?(r.preventDefault(),J()):(r.ctrlKey||r.metaKey)&&(r.shiftKey&&r.key==="z"||r.key==="y")&&(r.preventDefault(),ue())}return yt(()=>{document.addEventListener("keydown",I)}),_t(()=>{document.removeEventListener("keydown",I)}),(r,i)=>(W(),N("div",ul,[e("div",dl,[e("button",{class:de(["tab-btn",{active:y.value==="layers"}]),onClick:i[0]||(i[0]=c=>y.value="layers")},[i[55]||(i[55]=e("i",{class:"fas fa-layer-group"},null,-1)),F(" "+v(r.$t("layerPanel.tabs.layers")),1)],2),e("button",{class:de(["tab-btn",{active:y.value==="text"}]),onClick:i[1]||(i[1]=c=>y.value="text")},[i[56]||(i[56]=e("i",{class:"fas fa-font"},null,-1)),F(" "+v(r.$t("layerPanel.tabs.text")),1)],2)]),e("div",cl,[e("button",{class:de(["history-btn",{disabled:!$(t).canUndo}]),disabled:!$(t).canUndo,onClick:J,title:r.$t("layerPanel.history.undo")},[...i[57]||(i[57]=[e("i",{class:"fas fa-undo"},null,-1)])],10,fl),e("button",{class:de(["history-btn",{disabled:!$(t).canRedo}]),disabled:!$(t).canRedo,onClick:ue,title:r.$t("layerPanel.history.redo")},[...i[58]||(i[58]=[e("i",{class:"fas fa-redo"},null,-1)])],10,vl),e("button",{class:"history-btn preview-btn",onClick:we,title:r.$t("layerPanel.history.preview")},[...i[59]||(i[59]=[e("i",{class:"fas fa-eye"},null,-1)])],8,hl),T.value?(W(),N("span",pl,[i[60]||(i[60]=e("i",{class:"fas fa-history"},null,-1)),F(" "+v(T.value),1)])):me("",!0)]),ge(e("div",ml,[e("div",gl,[e("h3",wl,[i[61]||(i[61]=e("i",{class:"fas fa-layer-group"},null,-1)),F(" "+v(r.$t("layerPanel.layers.title"))+" ("+v($(t).imageLayerCount)+") ",1)]),e("div",bl,[(W(!0),N(qe,null,Je(H.value,c=>(W(),N("div",{key:c.id,class:de(["layer-item",{selected:c.id===$(t).selectedLayerId}]),onClick:j=>B(c.id)},[e("div",$l,[e("img",{src:c.url,alt:c.name},null,8,xl)]),e("div",kl,[e("span",Cl,v(c.name),1),e("span",Tl,v(Math.round(c.width))+" × "+v(Math.round(c.height)),1)]),e("div",Il,[e("button",{class:"icon-btn",onClick:tt(j=>re(c),["stop"]),title:c.visible?r.$t("layerPanel.layers.hide"):r.$t("layerPanel.layers.show")},[e("i",{class:de(["fas",c.visible?"fa-eye":"fa-eye-slash"])},null,2)],8,Sl),e("button",{class:"icon-btn",onClick:tt(j=>ae(c.id),["stop"]),title:r.$t("layerPanel.layers.delete")},[...i[62]||(i[62]=[e("i",{class:"fas fa-trash"},null,-1)])],8,Pl)])],10,yl))),128))]),p.value?(W(),N("div",Ml,[e("button",{class:"btn btn-sm",onClick:i[2]||(i[2]=c=>Xe("up")),title:r.$t("layerPanel.layers.moveUp")},[...i[63]||(i[63]=[e("i",{class:"fas fa-arrow-up"},null,-1)])],8,Bl),e("button",{class:"btn btn-sm",onClick:i[3]||(i[3]=c=>Xe("down")),title:r.$t("layerPanel.layers.moveDown")},[...i[64]||(i[64]=[e("i",{class:"fas fa-arrow-down"},null,-1)])],8,zl),e("button",{class:"btn btn-sm",onClick:G,title:r.$t("layerPanel.layers.duplicate")},[...i[65]||(i[65]=[e("i",{class:"fas fa-copy"},null,-1)])],8,Rl)])):me("",!0)]),e("div",Ll,[e("h3",{class:"section-title collapsible",onClick:i[4]||(i[4]=c=>Y("canvas"))},[i[66]||(i[66]=e("i",{class:"fas fa-fill-drip"},null,-1)),F(" "+v(r.$t("layerPanel.background.title"))+" ",1),e("i",{class:de(["fas toggle-icon",R.canvas?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ge(e("div",Ol,[e("div",Ul,[e("label",null,v(r.$t("layerPanel.background.color")),1),e("div",Dl,[e("input",{type:"color",value:$(t).canvasBackgroundColor,onInput:i[5]||(i[5]=c=>M(c.target.value)),class:"color-input"},null,40,Fl),e("input",{type:"text",value:$(t).canvasBackgroundColor,onInput:i[6]||(i[6]=c=>M(c.target.value)),class:"color-text-input",maxlength:"7"},null,40,Xl),e("button",{class:de(["icon-btn",{active:$(t).canvasBackgroundColor==="transparent"}]),onClick:i[7]||(i[7]=c=>M("transparent")),title:r.$t("layerPanel.background.transparent")},[...i[67]||(i[67]=[e("i",{class:"fas fa-chess-board"},null,-1)])],10,Yl)])]),e("div",El,[(W(!0),N(qe,null,Je(te.value,c=>(W(),N("button",{key:c.value,class:de(["color-swatch",{active:$(t).canvasBackgroundColor===c.value,transparent:c.value==="transparent"}]),style:je(c.value!=="transparent"?{backgroundColor:c.value}:{}),onClick:j=>M(c.value),title:c.label},[c.value==="transparent"?(W(),N("i",Wl)):me("",!0)],14,Al))),128))])],512),[[Ke,R.canvas]])]),p.value?(W(),N("div",Hl,[e("h3",{class:"section-title collapsible",onClick:i[8]||(i[8]=c=>Y("transform"))},[i[68]||(i[68]=e("i",{class:"fas fa-arrows-alt"},null,-1)),F(" "+v(r.$t("layerPanel.transform.title"))+" ",1),e("i",{class:de(["fas toggle-icon",R.transform?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ge(e("div",Nl,[e("div",ql,[e("label",null,v(r.$t("layerPanel.transform.position")),1),e("div",Vl,[e("div",jl,[i[69]||(i[69]=e("span",null,"X",-1)),e("input",{type:"number",value:Math.round(p.value.x),onInput:i[9]||(i[9]=c=>b("x",parseInt(c.target.value)||0))},null,40,Gl)]),e("div",Kl,[i[70]||(i[70]=e("span",null,"Y",-1)),e("input",{type:"number",value:Math.round(p.value.y),onInput:i[10]||(i[10]=c=>b("y",parseInt(c.target.value)||0))},null,40,Jl)])])]),e("div",Ql,[e("label",null,v(r.$t("layerPanel.transform.size")),1),e("div",Zl,[e("div",_l,[i[71]||(i[71]=e("span",null,"W",-1)),e("input",{type:"number",value:Math.round(p.value.width),onInput:i[11]||(i[11]=c=>Le("width",parseInt(c.target.value)||50))},null,40,ei)]),e("div",ti,[i[72]||(i[72]=e("span",null,"H",-1)),e("input",{type:"number",value:Math.round(p.value.height),onInput:i[12]||(i[12]=c=>Le("height",parseInt(c.target.value)||50))},null,40,ai)]),e("button",{class:de(["icon-btn",{active:n.value}]),onClick:i[13]||(i[13]=c=>n.value=!n.value),title:r.$t("layerPanel.transform.maintainAspect")},[...i[73]||(i[73]=[e("i",{class:"fas fa-link"},null,-1)])],10,si)])]),e("div",ni,[e("label",null,v(r.$t("layerPanel.transform.rotation"))+": "+v(p.value.rotation)+"°",1),e("input",{type:"range",min:"-180",max:"180",value:p.value.rotation,onInput:i[14]||(i[14]=c=>b("rotation",parseInt(c.target.value)))},null,40,oi),e("div",li,[e("button",{class:"btn btn-sm",onClick:i[15]||(i[15]=c=>L(-90))},"-90°"),e("button",{class:"btn btn-sm",onClick:i[16]||(i[16]=c=>b("rotation",0))},"0°"),e("button",{class:"btn btn-sm",onClick:i[17]||(i[17]=c=>L(90))},"+90°")])]),e("div",ii,[e("label",null,v(r.$t("layerPanel.transform.flip")),1),e("div",ri,[e("button",{class:de(["btn btn-sm",{active:p.value.flipX}]),onClick:i[18]||(i[18]=c=>Be("flipX")),title:r.$t("layerPanel.transform.flipHorizontal")},[i[74]||(i[74]=e("i",{class:"fas fa-arrows-alt-h"},null,-1)),F(" "+v(r.$t("layerPanel.transform.horizontal")),1)],10,ui),e("button",{class:de(["btn btn-sm",{active:p.value.flipY}]),onClick:i[19]||(i[19]=c=>Be("flipY")),title:r.$t("layerPanel.transform.flipVertical")},[i[75]||(i[75]=e("i",{class:"fas fa-arrows-alt-v"},null,-1)),F(" "+v(r.$t("layerPanel.transform.vertical")),1)],10,di)])]),e("div",ci,[e("label",null,v(r.$t("layerPanel.transform.opacity"))+": "+v(p.value.opacity)+"%",1),e("input",{type:"range",min:"0",max:"100",value:p.value.opacity,onInput:i[20]||(i[20]=c=>b("opacity",parseInt(c.target.value)))},null,40,fi)])],512),[[Ke,R.transform]])])):me("",!0),p.value?(W(),N("div",vi,[e("h3",{class:"section-title collapsible",onClick:i[21]||(i[21]=c=>Y("filters"))},[i[76]||(i[76]=e("i",{class:"fas fa-sliders-h"},null,-1)),F(" "+v(r.$t("layerPanel.filters.title"))+" ",1),e("i",{class:de(["fas toggle-icon",R.filters?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ge(e("div",hi,[e("div",pi,[e("label",null,v(r.$t("layerPanel.filters.brightness"))+": "+v(p.value.filters.brightness)+"%",1),e("input",{type:"range",min:"0",max:"200",value:p.value.filters.brightness,onInput:i[22]||(i[22]=c=>Ce("brightness",parseInt(c.target.value)))},null,40,mi)]),e("div",gi,[e("label",null,v(r.$t("layerPanel.filters.contrast"))+": "+v(p.value.filters.contrast)+"%",1),e("input",{type:"range",min:"0",max:"200",value:p.value.filters.contrast,onInput:i[23]||(i[23]=c=>Ce("contrast",parseInt(c.target.value)))},null,40,wi)]),e("div",bi,[e("label",null,v(r.$t("layerPanel.filters.saturation"))+": "+v(p.value.filters.saturation)+"%",1),e("input",{type:"range",min:"0",max:"200",value:p.value.filters.saturation,onInput:i[24]||(i[24]=c=>Ce("saturation",parseInt(c.target.value)))},null,40,yi)]),e("div",$i,[e("label",null,v(r.$t("layerPanel.filters.grayscale"))+": "+v(p.value.filters.grayscale)+"%",1),e("input",{type:"range",min:"0",max:"100",value:p.value.filters.grayscale,onInput:i[25]||(i[25]=c=>Ce("grayscale",parseInt(c.target.value)))},null,40,xi)]),e("button",{class:"btn btn-secondary btn-full",onClick:V},[i[77]||(i[77]=e("i",{class:"fas fa-undo"},null,-1)),F(" "+v(r.$t("layerPanel.filters.reset")),1)])],512),[[Ke,R.filters]])])):me("",!0),p.value?(W(),N("div",ki,[e("h3",{class:"section-title collapsible",onClick:i[26]||(i[26]=c=>Y("border"))},[i[78]||(i[78]=e("i",{class:"fas fa-border-style"},null,-1)),F(" "+v(r.$t("layerPanel.border.title"))+" ",1),e("i",{class:de(["fas toggle-icon",R.border?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ge(e("div",Ci,[e("div",Ti,[e("label",null,v(r.$t("layerPanel.border.width"))+": "+v(Z.value.width)+"px",1),e("input",{type:"range",min:"0",max:"50",value:Z.value.width,onInput:i[27]||(i[27]=c=>Ge("width",parseInt(c.target.value)))},null,40,Ii)]),e("div",Si,[e("label",null,v(r.$t("layerPanel.border.color")),1),e("div",Pi,[e("input",{type:"color",value:Z.value.color,onInput:i[28]||(i[28]=c=>Ge("color",c.target.value)),class:"color-input"},null,40,Mi),e("input",{type:"text",value:Z.value.color,onInput:i[29]||(i[29]=c=>Ge("color",c.target.value)),class:"color-text-input",maxlength:"7"},null,40,Bi)])]),e("div",zi,[e("label",null,v(r.$t("layerPanel.border.radius"))+": "+v(Z.value.radius)+"%",1),e("input",{type:"range",min:"0",max:"50",value:Z.value.radius,onInput:i[30]||(i[30]=c=>Ge("radius",parseInt(c.target.value)))},null,40,Ri)])],512),[[Ke,R.border]])])):me("",!0),p.value?(W(),N("div",Li,[e("h3",{class:"section-title collapsible",onClick:i[31]||(i[31]=c=>Y("shadow"))},[i[79]||(i[79]=e("i",{class:"fas fa-clone"},null,-1)),F(" "+v(r.$t("layerPanel.shadow.title"))+" ",1),e("i",{class:de(["fas toggle-icon",R.shadow?"fa-chevron-up":"fa-chevron-down"])},null,2)]),ge(e("div",Oi,[e("div",Ui,[e("label",Di,[e("input",{type:"checkbox",checked:k.value.enabled,onChange:i[32]||(i[32]=c=>We("enabled",c.target.checked))},null,40,Fi),F(" "+v(r.$t("layerPanel.shadow.enable")),1)])]),k.value.enabled?(W(),N(qe,{key:0},[e("div",Xi,[e("label",null,v(r.$t("layerPanel.shadow.offsetX"))+": "+v(k.value.offsetX)+"px",1),e("input",{type:"range",min:"-50",max:"50",value:k.value.offsetX,onInput:i[33]||(i[33]=c=>We("offsetX",parseInt(c.target.value)))},null,40,Yi)]),e("div",Ei,[e("label",null,v(r.$t("layerPanel.shadow.offsetY"))+": "+v(k.value.offsetY)+"px",1),e("input",{type:"range",min:"-50",max:"50",value:k.value.offsetY,onInput:i[34]||(i[34]=c=>We("offsetY",parseInt(c.target.value)))},null,40,Ai)]),e("div",Wi,[e("label",null,v(r.$t("layerPanel.shadow.blur"))+": "+v(k.value.blur)+"px",1),e("input",{type:"range",min:"0",max:"50",value:k.value.blur,onInput:i[35]||(i[35]=c=>We("blur",parseInt(c.target.value)))},null,40,Hi)]),e("div",Ni,[e("label",null,v(r.$t("layerPanel.shadow.color")),1),e("div",qi,[e("input",{type:"color",value:k.value.color,onInput:i[36]||(i[36]=c=>We("color",c.target.value)),class:"color-input"},null,40,Vi),e("input",{type:"text",value:k.value.color,onInput:i[37]||(i[37]=c=>We("color",c.target.value)),class:"color-text-input",maxlength:"7"},null,40,ji)])]),e("div",Gi,[e("label",null,v(r.$t("layerPanel.shadow.opacity"))+": "+v(k.value.opacity)+"%",1),e("input",{type:"range",min:"0",max:"100",value:k.value.opacity,onInput:i[38]||(i[38]=c=>We("opacity",parseInt(c.target.value)))},null,40,Ki)])],64)):me("",!0)],512),[[Ke,R.shadow]])])):me("",!0),p.value?me("",!0):(W(),N("div",Ji,[e("p",Qi,[i[80]||(i[80]=e("i",{class:"fas fa-mouse-pointer"},null,-1)),F(" "+v(r.$t("layerPanel.hints.selectLayer")),1)])]))],512),[[Ke,y.value==="layers"]]),ge(e("div",Zi,[e("div",_i,[e("button",{class:"btn btn-primary btn-full",onClick:E},[i[81]||(i[81]=e("i",{class:"fas fa-plus"},null,-1)),F(" "+v(r.$t("layerPanel.text.addButton")),1)])]),$(t).texts&&$(t).texts.length>0?(W(),N("div",er,[e("h3",tr,[i[82]||(i[82]=e("i",{class:"fas fa-list"},null,-1)),F(" "+v(r.$t("layerPanel.text.listTitle"))+" ("+v($(t).texts.length)+") ",1)]),e("div",ar,[(W(!0),N(qe,null,Je($(t).texts,c=>(W(),N("div",{key:c.id,class:de(["text-item",{selected:c.id===z.value}]),onClick:j=>O(c.id)},[i[84]||(i[84]=e("div",{class:"text-preview"},[e("i",{class:"fas fa-font"})],-1)),e("div",nr,[e("span",or,v(c.content||c.txt||"Text"),1),e("span",lr,v(c.fontSize||32)+"px",1)]),e("button",{class:"icon-btn",onClick:tt(j=>S(c.id),["stop"]),title:r.$t("layerPanel.layers.delete")},[...i[83]||(i[83]=[e("i",{class:"fas fa-trash"},null,-1)])],8,ir)],10,sr))),128))])])):me("",!0),X.value?(W(),N("div",rr,[e("h3",ur,[i[85]||(i[85]=e("i",{class:"fas fa-edit"},null,-1)),F(" "+v(r.$t("layerPanel.text.editTitle")),1)]),e("div",dr,[e("label",null,v(r.$t("layerPanel.text.content")),1),e("input",{type:"text",value:X.value.content||X.value.txt,onInput:i[39]||(i[39]=c=>A("content",c.target.value)),class:"text-input"},null,40,cr)]),e("div",fr,[e("label",null,v(r.$t("layerPanel.text.fontSize"))+": "+v(X.value.fontSize||32)+"px",1),e("input",{type:"range",min:"8",max:"200",value:X.value.fontSize||32,onInput:i[40]||(i[40]=c=>A("fontSize",parseInt(c.target.value)))},null,40,vr)]),e("div",hr,[e("label",null,v(r.$t("layerPanel.text.fontFamily")),1),e("select",{value:X.value.fontFamily||"Arial",onChange:i[41]||(i[41]=c=>A("fontFamily",c.target.value)),class:"form-select font-select"},[e("optgroup",{label:r.$t("layerPanel.text.customFonts")},[(W(!0),N(qe,null,Je($(wt),c=>(W(),N("option",{key:c,value:c,style:je({fontFamily:c})},v(c),13,gr))),128))],8,mr),e("optgroup",{label:r.$t("layerPanel.text.systemFonts")},[(W(),N(qe,null,Je(ve,c=>e("option",{key:c,value:c,style:je({fontFamily:c})},v(c),13,br)),64))],8,wr)],40,pr)]),e("div",yr,[e("label",null,v(r.$t("layerPanel.text.color")),1),e("div",$r,[e("input",{type:"color",value:X.value.color||"#000000",onInput:i[42]||(i[42]=c=>A("color",c.target.value)),class:"color-input"},null,40,xr),e("input",{type:"text",value:X.value.color||"#000000",onInput:i[43]||(i[43]=c=>A("color",c.target.value)),class:"color-text-input",maxlength:"7"},null,40,kr)])]),e("div",Cr,[e("label",null,v(r.$t("layerPanel.text.opacity"))+": "+v(X.value.opacity||100)+"%",1),e("input",{type:"range",min:"0",max:"100",value:X.value.opacity||100,onInput:i[44]||(i[44]=c=>A("opacity",parseInt(c.target.value)))},null,40,Tr)]),e("div",Ir,[e("label",null,v(r.$t("layerPanel.text.rotation"))+": "+v(X.value.rotation||0)+"°",1),e("input",{type:"range",min:"-180",max:"180",value:X.value.rotation||0,onInput:i[45]||(i[45]=c=>A("rotation",parseInt(c.target.value)))},null,40,Sr)]),e("h4",Pr,v(r.$t("layerPanel.text.stroke")),1),e("div",Mr,[e("label",null,v(r.$t("layerPanel.text.strokeWidth"))+": "+v(X.value.strokeWidth||0)+"px",1),e("input",{type:"range",min:"0",max:"20",value:X.value.strokeWidth||0,onInput:i[46]||(i[46]=c=>A("strokeWidth",parseInt(c.target.value)))},null,40,Br)]),(X.value.strokeWidth||0)>0?(W(),N("div",zr,[e("label",null,v(r.$t("layerPanel.text.strokeColor")),1),e("div",Rr,[e("input",{type:"color",value:X.value.strokeColor||"#ffffff",onInput:i[47]||(i[47]=c=>A("strokeColor",c.target.value)),class:"color-input"},null,40,Lr),e("input",{type:"text",value:X.value.strokeColor||"#ffffff",onInput:i[48]||(i[48]=c=>A("strokeColor",c.target.value)),class:"color-text-input",maxlength:"7"},null,40,Or)])])):me("",!0),e("h4",Ur,v(r.$t("layerPanel.text.textShadow")),1),e("div",Dr,[e("label",null,v(r.$t("layerPanel.text.shadowBlur"))+": "+v(X.value.shadowBlur||0)+"px",1),e("input",{type:"range",min:"0",max:"30",value:X.value.shadowBlur||0,onInput:i[49]||(i[49]=c=>A("shadowBlur",parseInt(c.target.value)))},null,40,Fr)]),(X.value.shadowBlur||0)>0?(W(),N(qe,{key:1},[e("div",Xr,[e("label",null,v(r.$t("layerPanel.text.shadowX"))+": "+v(X.value.shadowOffsetX||2)+"px",1),e("input",{type:"range",min:"-20",max:"20",value:X.value.shadowOffsetX||2,onInput:i[50]||(i[50]=c=>A("shadowOffsetX",parseInt(c.target.value)))},null,40,Yr)]),e("div",Er,[e("label",null,v(r.$t("layerPanel.text.shadowY"))+": "+v(X.value.shadowOffsetY||2)+"px",1),e("input",{type:"range",min:"-20",max:"20",value:X.value.shadowOffsetY||2,onInput:i[51]||(i[51]=c=>A("shadowOffsetY",parseInt(c.target.value)))},null,40,Ar)]),e("div",Wr,[e("label",null,v(r.$t("layerPanel.text.shadowColor")),1),e("div",Hr,[e("input",{type:"color",value:X.value.shadowColor||"#000000",onInput:i[52]||(i[52]=c=>A("shadowColor",c.target.value)),class:"color-input"},null,40,Nr),e("input",{type:"text",value:X.value.shadowColor||"#000000",onInput:i[53]||(i[53]=c=>A("shadowColor",c.target.value)),class:"color-text-input",maxlength:"7"},null,40,qr)])])],64)):me("",!0),e("button",{class:"btn btn-danger btn-full",onClick:i[54]||(i[54]=c=>S(X.value.id))},[i[86]||(i[86]=e("i",{class:"fas fa-trash"},null,-1)),F(" "+v(r.$t("layerPanel.text.delete")),1)])])):me("",!0),!$(t).texts||$(t).texts.length===0?(W(),N("div",Vr,[e("p",jr,[i[87]||(i[87]=e("i",{class:"fas fa-font"},null,-1)),F(" "+v(r.$t("layerPanel.hints.addText")),1)])])):me("",!0)],512),[[Ke,y.value==="text"]])]))}},Kr=bt(Gr,[["__scopeId","data-v-2550558e"]]),Jr={class:"filter-presets"},Qr={class:"presets-header"},Zr={class:"presets-actions"},_r=["title"],eu=["title"],tu=["title"],au={class:"presets-grid"},su=["onClick","title"],nu={class:"preset-icon"},ou={class:"preset-name"},lu=["onClick","title"],iu={__name:"FilterPresets",props:{filters:{type:Object,required:!0}},emits:["apply-preset","filters-changed"],setup(d,{expose:m,emit:g}){const{t:u}=ct({useScope:"global"}),o=d,t=g,n=D(null),y=D([]),z=[{id:"normal",name:"Normal",icon:"📷",description:"Original",filters:{brightness:100,contrast:100,saturation:100,blur:0,hue:0,sepia:0,grayscale:0,vignette:0}},{id:"vintage",name:"Vintage",icon:"📸",description:"Retro-Look",filters:{brightness:110,contrast:90,saturation:70,blur:0,hue:0,sepia:40,vignette:30}},{id:"bw",name:"Schwarz/Weiß",icon:"⚫",description:"Klassisch",filters:{brightness:100,contrast:120,saturation:0,blur:0,hue:0,grayscale:100}},{id:"vivid",name:"Lebendig",icon:"🌈",description:"Kräftige Farben",filters:{brightness:105,contrast:120,saturation:150,blur:0,hue:0,exposure:5}},{id:"sepia",name:"Sepia",icon:"📜",description:"Nostalgischer Braun-Ton",filters:{brightness:105,contrast:95,saturation:80,blur:0,hue:0,sepia:70,vignette:20}},{id:"dramatic",name:"Dramatisch",icon:"🎭",description:"Hoher Kontrast",filters:{brightness:95,contrast:150,saturation:120,blur:0,hue:0,shadows:-20,highlights:20,vignette:25}},{id:"soft",name:"Soft",icon:"🌸",description:"Weiche Töne",filters:{brightness:110,contrast:85,saturation:90,blur:.5,hue:0,highlights:15,exposure:5}},{id:"hdr",name:"HDR",icon:"💎",description:"Sehr hohe Dynamik",filters:{brightness:105,contrast:130,saturation:140,blur:0,hue:0,highlights:30,shadows:30}},{id:"cold",name:"Kalt",icon:"❄️",description:"Kühle Töne",filters:{brightness:100,contrast:105,saturation:90,blur:0,hue:200,sepia:0,exposure:-5}},{id:"warm",name:"Warm",icon:"🔥",description:"Warme Töne",filters:{brightness:105,contrast:100,saturation:110,blur:0,hue:15,sepia:25,exposure:5}},{id:"sunset",name:"Sunset",icon:"🌅",description:"Orange/Rosa Sonnenuntergang",filters:{brightness:110,contrast:105,saturation:120,blur:0,hue:10,sepia:30,vignette:20}},{id:"ocean",name:"Ocean",icon:"🌊",description:"Blaue Meer-Stimmung",filters:{brightness:100,contrast:110,saturation:115,blur:0,hue:195,exposure:-5}},{id:"cinematic",name:"Cinematic",icon:"🎬",description:"Film-Look",filters:{brightness:95,contrast:120,saturation:95,blur:0,hue:5,vignette:35,shadows:-15}},{id:"faded",name:"Faded",icon:"👻",description:"Verblasst",filters:{brightness:115,contrast:75,saturation:70,blur:0,hue:0,exposure:10}},{id:"noir",name:"Noir",icon:"🖤",description:"Film Noir Stil",filters:{brightness:95,contrast:140,saturation:0,blur:0,hue:0,grayscale:100,vignette:45}},{id:"dreamy",name:"Dreamy",icon:"✨",description:"Verträumt",filters:{brightness:115,contrast:80,saturation:85,blur:1,hue:0,highlights:25,vignette:15}}],ee=ce(()=>[...z,...y.value]);function _(T){n.value=T.id,t("apply-preset",T),window.$toast&&window.$toast.success(u("toast.presets.applied",{name:T.name}))}function fe(){const T=prompt(u("presets.dialogs.saveName"),u("presets.dialogs.defaultName"));if(!T)return;const Z=prompt(u("presets.dialogs.saveDescription"),""),k={id:"custom_"+Date.now(),name:T.trim(),icon:"⭐",description:(Z==null?void 0:Z.trim())||u("presets.custom"),filters:{...o.filters},custom:!0};y.value.push(k),p(),window.$toast&&window.$toast.success(u("toast.presets.saved",{name:T.trim()}))}function R(T){if(!confirm(u("presets.dialogs.confirmDelete")))return;const Z=y.value.findIndex(k=>k.id===T);if(Z!==-1){const k=y.value[Z];y.value.splice(Z,1),p(),n.value===T&&(n.value=null),window.$toast&&window.$toast.success(u("toast.presets.deleted",{name:k.name}))}}function te(){if(y.value.length===0){window.$toast&&window.$toast.warning(u("toast.presets.noCustomPresets"));return}const T=JSON.stringify(y.value,null,2),Z=new Blob([T],{type:"application/json"}),k=URL.createObjectURL(Z),Y=document.createElement("a");Y.href=k,Y.download="filter-presets.json",Y.click(),URL.revokeObjectURL(k),window.$toast&&window.$toast.success(u("toast.presets.exported",{count:y.value.length}))}function ve(){const T=document.createElement("input");T.type="file",T.accept=".json",T.onchange=async Z=>{const k=Z.target.files[0];if(k)try{const Y=await k.text(),M=JSON.parse(Y);if(!Array.isArray(M))throw new Error(u("presets.errors.invalidFormat"));y.value=[...y.value,...M],p(),window.$toast&&window.$toast.success(u("toast.presets.imported",{count:M.length}))}catch(Y){console.error("Import-Fehler:",Y),window.$toast&&window.$toast.error(u("toast.presets.importError"),Y.message)}},T.click()}function p(){try{localStorage.setItem("bildkonverter_filterPresets",JSON.stringify(y.value))}catch(T){console.error("Fehler beim Speichern:",T)}}function H(){try{const T=localStorage.getItem("bildkonverter_filterPresets");T&&(y.value=JSON.parse(T))}catch(T){console.error("Fehler beim Laden:",T)}}yt(()=>{H()});function X(){n.value=null}return m({resetActivePreset:X}),(T,Z)=>(W(),N("div",Jr,[e("div",Qr,[e("h3",null,v(T.$t("presets.title")),1),e("div",Zr,[e("button",{onClick:fe,class:"action-btn",title:T.$t("presets.actions.save")},[...Z[0]||(Z[0]=[e("i",{class:"fas fa-save"},null,-1)])],8,_r),e("button",{onClick:ve,class:"action-btn",title:T.$t("presets.actions.import")},[...Z[1]||(Z[1]=[e("i",{class:"fas fa-file-import"},null,-1)])],8,eu),e("button",{onClick:te,class:"action-btn",title:T.$t("presets.actions.export")},[...Z[2]||(Z[2]=[e("i",{class:"fas fa-file-export"},null,-1)])],8,tu)])]),e("div",au,[(W(!0),N(qe,null,Je(ee.value,k=>(W(),N("button",{key:k.id,class:de(["preset-btn",{active:n.value===k.id}]),onClick:Y=>_(k),title:k.description},[e("span",nu,v(k.icon),1),e("span",ou,v(T.$t(`presets.${k.id}`,k.name)),1),k.custom?(W(),N("button",{key:0,onClick:tt(Y=>R(k.id),["stop"]),class:"delete-btn",title:T.$t("presets.actions.delete")},[...Z[3]||(Z[3]=[e("i",{class:"fas fa-times"},null,-1)])],8,lu)):me("",!0)],10,su))),128))])]))}},ru=bt(iu,[["__scopeId","data-v-4abeb2f3"]]),uu=()=>"/bildkonverter/api",It=uu(),Qt={convertImage:`${It}/convert-image`,uploadImage:`${It}/upload`,getFormats:`${It}/formats`};class gt{static async convertImage(m,g,u,o={}){const t=new FormData;t.append("image",m,"canvas_image.png"),t.append("format",g),t.append("filename",u),o.quality&&t.append("quality",o.quality);try{const n=await fetch(Qt.convertImage,{method:"POST",body:t});if(!n.ok){const y=await n.json().catch(()=>({}));throw new Error(y.message||`Server-Fehler: ${n.status}`)}return await n.blob()}catch(n){throw console.error("API-Fehler bei Bildkonvertierung:",n),n}}static async checkBackendAvailability(){try{return(await fetch(Qt.getFormats,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch(m){return console.warn("Backend nicht erreichbar:",m),!1}}}const ft={png:{name:"PNG",description:"Lossless, with transparency",extension:"png",mimeType:"image/png",supportsQuality:!1,requiresBackend:!1,maxSize:"500MB",recommended:"Logos, UI, Screenshots",icon:"🖼️"},jpeg:{name:"JPEG",description:"Lossy, small file size",extension:"jpg",mimeType:"image/jpeg",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Photos, Images",icon:"📷"},jpg:{name:"JPG",description:"Lossy, small file size",extension:"jpg",mimeType:"image/jpeg",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Photos, Images",icon:"📷"},webp:{name:"WebP",description:"Modern, efficient, small",extension:"webp",mimeType:"image/webp",supportsQuality:!0,requiresBackend:!1,maxSize:"500MB",recommended:"Web, modern browsers",icon:"🌐"},tiff:{name:"TIFF",description:"Professional format",extension:"tiff",mimeType:"image/tiff",supportsQuality:!1,requiresBackend:!0,maxSize:"1GB",recommended:"Print, Archiving",icon:"📄"},tif:{name:"TIF",description:"Professional format",extension:"tif",mimeType:"image/tiff",supportsQuality:!1,requiresBackend:!0,maxSize:"1GB",recommended:"Print, Archiving",icon:"📄"},heif:{name:"HEIF",description:"Modern, high efficiency",extension:"heif",mimeType:"image/heif",supportsQuality:!0,requiresBackend:!0,maxSize:"500MB",recommended:"Photos (newer devices)",icon:"📱"},heic:{name:"HEIC",description:"Modern, high efficiency (Apple)",extension:"heic",mimeType:"image/heic",supportsQuality:!0,requiresBackend:!0,maxSize:"500MB",recommended:"iOS, macOS",icon:"🍎"},gif:{name:"GIF",description:"Single-frame GIF",extension:"gif",mimeType:"image/gif",supportsQuality:!1,requiresBackend:!0,maxSize:"500MB",recommended:"Compatibility, Retro",icon:"🎨"},pdf:{name:"PDF",description:"Document, A4 format",extension:"pdf",mimeType:"application/pdf",supportsQuality:!1,requiresBackend:!1,maxSize:"500MB",recommended:"Documents, Print",icon:"📑"}},$t=Object.keys(ft);$t.filter(d=>!ft[d].requiresBackend);$t.filter(d=>ft[d].requiresBackend);class du{constructor(){this.jsPDF=null,this.backendAvailable=!1,this.initializePDF()}async initializePDF(){try{const{jsPDF:m}=await Pt(async()=>{const{jsPDF:g}=await import("./jspdf.es.min.hYDnrvS9.js").then(u=>u.j);return{jsPDF:g}},__vite__mapDeps([4,1,2,3]));return this.jsPDF=m,console.log("✅ jsPDF erfolgreich geladen"),!0}catch(m){return console.warn("⚠️ jsPDF konnte nicht geladen werden:",m),!1}}async checkBackend(){return this.backendAvailable=await gt.checkBackendAvailability(),this.backendAvailable}async exportImage(m,g,u="image",o={}){if(!m||!(m instanceof HTMLCanvasElement))throw new Error("Gültiges Canvas-Element erforderlich");if(g=g.toLowerCase(),!$t.includes(g))throw new Error(`Format ${g} wird nicht unterstützt`);this.validateCanvas(m);const t={quality:o.quality||.92,texts:o.texts||[],...o};try{switch(g){case"png":return await this.exportPNG(m,u,t);case"jpeg":case"jpg":return await this.exportJPEG(m,u,t);case"webp":return await this.exportWebP(m,u,t);case"tiff":case"tif":return await this.exportTIFF(m,u,t);case"heif":case"heic":return await this.exportHEIF(m,u,t);case"gif":return await this.exportGIF(m,u,t);case"pdf":return await this.exportPDF(m,u,t);default:return await this.exportPNG(m,u,t)}}catch(n){throw console.error(`Export-Fehler (${g}):`,n),new Error(`Export fehlgeschlagen: ${n.message}`)}}validateCanvas(m){const g=m.width*m.height,u=5e4*5e4;if(g>u){const o=Math.sqrt(u).toFixed(0);throw new Error(`Bild zu groß für Export. Maximum: ${o}x${o} Pixel`)}g>1e4*1e4&&console.warn("⚠️ Sehr großes Bild - Export kann länger dauern")}async exportPNG(m,g,u){const o=m.toDataURL("image/png");return this.downloadDataURL(o,`${g}.png`),{success:!0,format:"png",filename:`${g}.png`,size:this.getDataURLSize(o)}}async exportJPEG(m,g,u){const o=u.quality||.92,n=this.addWhiteBackground(m).toDataURL("image/jpeg",o);return this.downloadDataURL(n,`${g}.jpg`),{success:!0,format:"jpeg",filename:`${g}.jpg`,quality:Math.round(o*100),size:this.getDataURLSize(n)}}async exportWebP(m,g,u){if(!this.supportsWebP())throw new Error("WebP wird von diesem Browser nicht unterstützt");const o=u.quality||.85,t=m.toDataURL("image/webp",o);return this.downloadDataURL(t,`${g}.webp`),{success:!0,format:"webp",filename:`${g}.webp`,quality:Math.round(o*100),size:this.getDataURLSize(t)}}async exportTIFF(m,g,u){const o=await this.canvasToBlob(m,"image/png"),t=await gt.convertImage(o,"tiff",g,u);return this.downloadBlob(t,`${g}.tiff`),{success:!0,format:"tiff",filename:`${g}.tiff`,size:this.formatBytes(t.size)}}async exportHEIF(m,g,u){const o=await this.canvasToBlob(m,"image/png"),t=await gt.convertImage(o,"heif",g,u);return this.downloadBlob(t,`${g}.heif`),{success:!0,format:"heif",filename:`${g}.heif`,quality:u.quality?Math.round(u.quality*100):null,size:this.formatBytes(t.size)}}async exportGIF(m,g,u){const o=await this.canvasToBlob(m,"image/png"),t=await gt.convertImage(o,"gif",g,u);return this.downloadBlob(t,`${g}.gif`),{success:!0,format:"gif",filename:`${g}.gif`,size:this.formatBytes(t.size)}}async exportPDF(m,g,u){if(!this.jsPDF&&(await this.initializePDF(),!this.jsPDF))throw new Error("PDF-Export nicht verfügbar - jsPDF konnte nicht geladen werden");const o=this.calculatePDFDimensions(m),t=new this.jsPDF({orientation:o.orientation,unit:"mm",format:o.format,compress:!0});t.setProperties({title:g,subject:"Konvertiertes Bild",author:"Vue Bildkonverter",creator:"KodiniTools"});const n=m.toDataURL("image/jpeg",.92);return t.addImage(n,"JPEG",o.x,o.y,o.width,o.height,void 0,"FAST"),t.save(`${g}.pdf`),{success:!0,format:"pdf",filename:`${g}.pdf`,pages:1,orientation:o.orientation}}calculatePDFDimensions(m){const g=m.width/m.height;let u,o,t,n,y,z;const ee=210,_=297;return g>1?(o="landscape",u="a4",t=_-20,n=t/g,y=10,z=(ee-n)/2):(o="portrait",u="a4",t=ee-20,n=t/g,y=10,z=(_-n)/2,n>_-20&&(n=_-20,t=n*g,y=(ee-t)/2,z=10)),{orientation:o,format:u,width:t,height:n,x:y,y:z}}addWhiteBackground(m){const g=document.createElement("canvas");g.width=m.width,g.height=m.height;const u=g.getContext("2d");return u.fillStyle="#FFFFFF",u.fillRect(0,0,g.width,g.height),u.drawImage(m,0,0),g}canvasToBlob(m,g="image/png",u=.92){return new Promise((o,t)=>{m.toBlob(n=>{n?o(n):t(new Error("Canvas-zu-Blob-Konvertierung fehlgeschlagen"))},g,u)})}downloadDataURL(m,g){const u=document.createElement("a");u.download=g,u.href=m,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u)}downloadBlob(m,g){const u=URL.createObjectURL(m),o=document.createElement("a");o.download=g,o.href=u,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(u),1e3)}getDataURLSize(m){const g=m.split(",")[1],u=Math.round(g.length*3/4);return this.formatBytes(u)}formatBytes(m){return m<1024?`${m} B`:m<1024*1024?`${(m/1024).toFixed(1)} KB`:`${(m/(1024*1024)).toFixed(2)} MB`}supportsWebP(){const m=document.createElement("canvas");m.width=1,m.height=1;try{return m.toDataURL("image/webp").startsWith("data:image/webp")}catch{return!1}}}let St=null;function cu(){return St||(St=new du),St}async function fu(d,m,g,u){return await cu().exportImage(d,m,g,u)}function vu(d){return ft[d.toLowerCase()]||null}const hu={class:"editor-view"},pu={class:"editor-container"},mu={class:"toolbar"},gu={class:"toolbar-section"},wu={class:"toolbar-section"},bu=["disabled","title"],yu=["disabled","title"],$u=["disabled"],xu=["disabled"],ku=["disabled"],Cu=["disabled","title"],Tu=["disabled"],Iu={class:"editor-main"},Su={class:"sidebar"},Pu={class:"sidebar-section"},Mu=["value"],Bu={key:0,class:"format-info"},zu={class:"format-description"},Ru={class:"format-badge"},Lu={key:0,class:"backend-badge",title:"Benötigt Backend-API"},Ou={key:1,class:"filter-control"},Uu={key:2,class:"filter-control checkbox-control"},Du={class:"checkbox-label"},Fu={class:"filter-control"},Xu={class:"color-picker-row"},Yu=["disabled"],Eu=["disabled"],Au={class:"filter-control"},Wu=["disabled"],Hu={key:0,class:"hint-text"},Nu={class:"section-content"},qu={class:"filter-control"},Vu={class:"filter-label"},ju={class:"filter-value"},Gu={class:"slider-track"},Ku={class:"filter-control"},Ju={class:"filter-label"},Qu={class:"filter-value"},Zu={class:"slider-track"},_u={class:"filter-control"},ed={class:"filter-label"},td={class:"filter-value"},ad={class:"slider-track"},sd={class:"filter-control"},nd={class:"filter-label"},od={class:"filter-value"},ld={class:"slider-track"},id={class:"section-content"},rd={class:"filter-control"},ud={class:"filter-label"},dd={class:"filter-value"},cd={class:"slider-track"},fd={class:"filter-control"},vd={class:"filter-label"},hd={class:"filter-value"},pd={class:"slider-track"},md={class:"filter-control"},gd={class:"filter-label"},wd={class:"filter-value"},bd={class:"slider-track hue-slider"},yd={class:"filter-control"},$d={class:"filter-label"},xd={class:"filter-value"},kd={class:"slider-track warm-slider"},Cd={class:"section-content"},Td={class:"filter-control"},Id={class:"filter-label"},Sd={class:"filter-value"},Pd={class:"slider-track"},Md={class:"filter-control"},Bd={class:"filter-label"},zd={class:"filter-value"},Rd={class:"slider-track"},Ld={class:"filter-control"},Od={class:"filter-label"},Ud={class:"filter-value"},Dd={class:"slider-track"},Fd={class:"filter-control"},Xd={class:"filter-label"},Yd={class:"filter-value"},Ed={class:"slider-track"},Ad={class:"sidebar-section"},Wd={class:"sidebar-section"},Hd={class:"resize-controls"},Nd={class:"resize-presets"},qd=["disabled"],Vd={value:""},jd={class:"resize-input"},Gd=["disabled"],Kd={class:"resize-input"},Jd=["disabled"],Qd={class:"checkbox-label"},Zd=["disabled"],_d={key:0,class:"empty-canvas"},ec={key:1,class:"canvas-container"},tc={class:"canvas-info"},ac={class:"preview-comparison"},sc={class:"preview-item"},nc=["src"],oc={key:1,class:"preview-placeholder"},lc={class:"preview-item"},ic=["src"],rc={key:1,class:"preview-placeholder"},uc={__name:"EditorView",setup(d){const{t:m}=ct({useScope:"global"}),g=Zt(),u=Mt(),o=ls(),t=D(null),n=D(null),y=D(null),z=D(null),ee=D(""),_=D("png"),fe=D(""),R=D(92),te=D(!1),ve=D(!1),p=D(null),H=D(!1),X=D({x:0,y:0}),T=D(!1),Z=D({x:0,y:0}),k=D(!1),Y=D(!1),M=D(""),B=D(""),re=D(0),ae=D(!1),Xe=D(!1),G=cs(),b=fs(),Le=vs({onFilterChange:()=>P()}),{filters:L,background:Be,sectionsOpen:Ce,currentPreset:Ge}=Le,We=hs({maxHistorySize:50,onRestore:s=>fa(s)}),{history:V,historyIndex:E,canUndo:O,canRedo:S}=We,A=ms({getTexts:()=>u.texts,setTexts:s=>{u.texts=s},getSelectedTextId:()=>p.value,setSelectedTextId:s=>{p.value=s}}),{canUndoText:J,canRedoText:ue,saveTextHistory:we,initTextHistory:I,undoText:r,redoText:i}=A,c=gs({getCurrentDimensions:()=>{var s,a;return{width:((s=n.value)==null?void 0:s.width)||0,height:((a=n.value)==null?void 0:a.height)||0}},onResize:s=>{}}),{resizeWidth:j,resizeHeight:oe,maintainAspectRatio:Te}=c;ws({onImageLoad:async s=>{await loadImageFromUrl(s.url,s.name)},onError:s=>{console.error("Gallery load error:",s)}});const ye=bs(n),he=$t,Ye=ce(()=>!p.value||!u.texts?null:u.texts.find(s=>s.id===p.value)||null),Ee=ce(()=>vu(_.value)),Oe=ce(()=>{var s;return((s=Ee.value)==null?void 0:s.supportsQuality)||!1}),at=ce(()=>{var s;return((s=Ee.value)==null?void 0:s.requiresBackend)||!1}),Ve=ce(()=>{if(!G.cropOverlayStyle.value||!n.value)return null;const s=n.value.getBoundingClientRect(),a=n.value.parentElement.getBoundingClientRect(),f=s.width/n.value.width,C=s.height/n.value.height,x=s.left-a.left,U=s.top-a.top,ie=G.cropOverlayStyle.value,ke=Ue=>parseFloat(Ue)||0;return{left:`${x+ke(ie.left)*f}px`,top:`${U+ke(ie.top)*C}px`,width:`${ke(ie.width)*f}px`,height:`${ke(ie.height)*C}px`}}),Ie=D(0),xe=D(0),Qe=D(0);function xt(){if(!n.value){Ie.value=0,xe.value=0;return}Ie.value=n.value.width,xe.value=n.value.height}function lt(){if(!n.value){Qe.value=0;return}try{const a=n.value.toDataURL(`image/${_.value}`,.92).split(",")[1],f=a.endsWith("==")?2:a.endsWith("=")?1:0,C=a.length*3/4-f;Qe.value=Math.round(C)}catch{Qe.value=Math.round(n.value.toDataURL().length*.75)}}function vt(){xt(),lt()}ot(_,()=>{lt()});function Bt(){var s;(s=t.value)==null||s.click()}function ea(s){const a=s.target.files[0];if(!a)return;const f=a.type.split("/")[1];fe.value=f==="jpeg"?"jpg":f;const C=new FileReader;C.onload=x=>{const U=new Image;U.onload=async()=>{ee.value=x.target.result,await it(U);try{await u.loadImageFromFile(a)}catch(ie){console.warn("Store save failed:",ie)}},U.src=x.target.result,z.value=U},C.readAsDataURL(a)}function ta(s){const a=s.currentTarget,f=s.relatedTarget;a.contains(f)||(Xe.value=!1)}function aa(s){var U;Xe.value=!1;const a=(U=s.dataTransfer)==null?void 0:U.files;if(!a||a.length===0)return;const f=a[0];if(!f.type.startsWith("image/")){console.warn("Dropped file is not an image:",f.type);return}const C=f.type.split("/")[1];fe.value=C==="jpeg"?"jpg":C;const x=new FileReader;x.onload=ie=>{const ke=new Image;ke.onload=async()=>{ee.value=ie.target.result,await it(ke);try{await u.loadImageFromFile(f)}catch(Ue){console.warn("Store save failed:",Ue)}},ke.src=ie.target.result,z.value=ke},x.readAsDataURL(f)}async function it(s){if(y.value=s,G.resetCropState(),b.initTransformHistory(),await ht(),!n.value){console.warn("⚠️ Canvas noch nicht initialisiert, warte..."),setTimeout(()=>it(s),50);return}const a=1200,f=800;let C=s.width,x=s.height;if(C>a||x>f){const U=Math.min(a/C,f/x);C*=U,x*=U}n.value.width=C,n.value.height=x,c.initFromDimensions(C,x),P(),vt(),Me(),I()}function sa(s,a){if(s.save(),a.rotation!==0){const x=a.x+a.width/2,U=a.y+a.height/2;s.translate(x,U),s.rotate(a.rotation*Math.PI/180),s.translate(-x,-U)}s.strokeStyle="#3b82f6",s.lineWidth=2,s.setLineDash([5,5]),s.strokeRect(a.x-2,a.y-2,a.width+4,a.height+4),s.setLineDash([]),s.fillStyle="#3b82f6";const f=8;[{x:a.x-f/2,y:a.y-f/2},{x:a.x+a.width/2-f/2,y:a.y-f/2},{x:a.x+a.width-f/2,y:a.y-f/2},{x:a.x+a.width-f/2,y:a.y+a.height/2-f/2},{x:a.x+a.width-f/2,y:a.y+a.height-f/2},{x:a.x+a.width/2-f/2,y:a.y+a.height-f/2},{x:a.x-f/2,y:a.y+a.height-f/2},{x:a.x-f/2,y:a.y+a.height/2-f/2}].forEach(x=>{s.fillRect(x.x,x.y,f,f)}),s.restore()}function P(){if(ae.value&&u.hasImageLayers){if(!n.value)return;const l=n.value.getContext("2d");l.clearRect(0,0,n.value.width,n.value.height);const pe=u.canvasBackgroundColor;pe&&pe!=="transparent"&&(l.save(),l.fillStyle=pe,l.fillRect(0,0,n.value.width,n.value.height),l.restore()),u.imageLayers.forEach(w=>{var Ne,ut,le,se;if(!w.visible)return;if(!w.image||!w.image.complete){console.warn(`Layer "${w.name}" hat kein gültiges Bild`);return}l.save(),l.globalAlpha=w.opacity/100;const $e=[];if(w.filters.brightness!==100&&$e.push(`brightness(${w.filters.brightness}%)`),w.filters.contrast!==100&&$e.push(`contrast(${w.filters.contrast}%)`),w.filters.saturation!==100&&$e.push(`saturate(${w.filters.saturation}%)`),w.filters.grayscale>0&&$e.push(`grayscale(${w.filters.grayscale}%)`),w.filters.sepia>0&&$e.push(`sepia(${w.filters.sepia}%)`),l.filter=$e.length>0?$e.join(" "):"none",w.rotation!==0){const K=w.x+w.width/2,q=w.y+w.height/2;l.translate(K,q),l.rotate(w.rotation*Math.PI/180),l.translate(-K,-q)}if(w.flipX||w.flipY){const K=w.x+w.width/2,q=w.y+w.height/2;l.translate(K,q),l.scale(w.flipX?-1:1,w.flipY?-1:1),l.translate(-K,-q)}const be=w.shadow&&w.shadow.enabled,Se=((Ne=w.border)==null?void 0:Ne.radius)||0;if(be&&Se>0){l.save();const K=(w.shadow.opacity||50)/100,q=w.shadow.color||"#000000",Pe=parseInt(q.slice(1,3),16),Q=parseInt(q.slice(3,5),16),De=parseInt(q.slice(5,7),16);l.shadowColor=`rgba(${Pe}, ${Q}, ${De}, ${K})`,l.shadowBlur=w.shadow.blur||10,l.shadowOffsetX=w.shadow.offsetX||5,l.shadowOffsetY=w.shadow.offsetY||5;const ne=w.x,Re=w.y,_e=w.width,Ae=w.height,os=Math.min(_e,Ae),et=Se/100*(os/2);l.fillStyle="#ffffff",l.beginPath(),l.moveTo(ne+et,Re),l.lineTo(ne+_e-et,Re),l.quadraticCurveTo(ne+_e,Re,ne+_e,Re+et),l.lineTo(ne+_e,Re+Ae-et),l.quadraticCurveTo(ne+_e,Re+Ae,ne+_e-et,Re+Ae),l.lineTo(ne+et,Re+Ae),l.quadraticCurveTo(ne,Re+Ae,ne,Re+Ae-et),l.lineTo(ne,Re+et),l.quadraticCurveTo(ne,Re,ne+et,Re),l.closePath(),l.fill(),l.restore()}else if(be){const K=(w.shadow.opacity||50)/100,q=w.shadow.color||"#000000",Pe=parseInt(q.slice(1,3),16),Q=parseInt(q.slice(3,5),16),De=parseInt(q.slice(5,7),16);l.shadowColor=`rgba(${Pe}, ${Q}, ${De}, ${K})`,l.shadowBlur=w.shadow.blur||10,l.shadowOffsetX=w.shadow.offsetX||5,l.shadowOffsetY=w.shadow.offsetY||5}const He=((ut=w.border)==null?void 0:ut.width)||0;if(Se>0){l.save(),l.shadowColor="transparent",l.shadowBlur=0,l.shadowOffsetX=0,l.shadowOffsetY=0,l.beginPath();const K=w.x,q=w.y,Pe=w.width,Q=w.height,De=Math.min(Pe,Q),ne=Se/100*(De/2);l.moveTo(K+ne,q),l.lineTo(K+Pe-ne,q),l.quadraticCurveTo(K+Pe,q,K+Pe,q+ne),l.lineTo(K+Pe,q+Q-ne),l.quadraticCurveTo(K+Pe,q+Q,K+Pe-ne,q+Q),l.lineTo(K+ne,q+Q),l.quadraticCurveTo(K,q+Q,K,q+Q-ne),l.lineTo(K,q+ne),l.quadraticCurveTo(K,q,K+ne,q),l.closePath(),l.clip(),l.drawImage(w.image,w.x,w.y,w.width,w.height),l.restore(),l.shadowColor="transparent",l.shadowBlur=0,l.shadowOffsetX=0,l.shadowOffsetY=0,He>0&&(l.strokeStyle=((le=w.border)==null?void 0:le.color)||"#000000",l.lineWidth=He,l.beginPath(),l.moveTo(K+ne,q),l.lineTo(K+Pe-ne,q),l.quadraticCurveTo(K+Pe,q,K+Pe,q+ne),l.lineTo(K+Pe,q+Q-ne),l.quadraticCurveTo(K+Pe,q+Q,K+Pe-ne,q+Q),l.lineTo(K+ne,q+Q),l.quadraticCurveTo(K,q+Q,K,q+Q-ne),l.lineTo(K,q+ne),l.quadraticCurveTo(K,q,K+ne,q),l.closePath(),l.stroke())}else l.drawImage(w.image,w.x,w.y,w.width,w.height),l.shadowColor="transparent",l.shadowBlur=0,l.shadowOffsetX=0,l.shadowOffsetY=0,He>0&&(l.strokeStyle=((se=w.border)==null?void 0:se.color)||"#000000",l.lineWidth=He,l.strokeRect(w.x,w.y,w.width,w.height));l.restore(),w.id===u.selectedLayerId&&sa(l,w)}),l.filter="none",u.texts&&u.texts.length>0&&u.texts.forEach(w=>{l.save();const $e=w.opacity!==void 0?w.opacity:100;l.globalAlpha=$e/100;const be=w.fontSize||w.size||32;if(l.font=`${be}px ${w.fontFamily||"Arial"}`,l.fillStyle=w.color||"#000000",l.textBaseline="top",w.rotation&&w.rotation!==0){const Se=l.measureText(w.content||w.txt||""),He=(w.x||0)+Se.width/2,Ne=(w.y||0)+be/2;l.translate(He,Ne),l.rotate(w.rotation*Math.PI/180),l.translate(-He,-Ne)}if(w.shadowBlur&&w.shadowBlur>0&&(l.shadowColor=w.shadowColor||"#000000",l.shadowBlur=w.shadowBlur,l.shadowOffsetX=w.shadowOffsetX||2,l.shadowOffsetY=w.shadowOffsetY||2),w.strokeWidth&&w.strokeWidth>0&&(l.strokeStyle=w.strokeColor||"#000000",l.lineWidth=w.strokeWidth,l.lineJoin="round",l.strokeText(w.content||w.txt||"",w.x||0,w.y||0)),l.fillText(w.content||w.txt||"",w.x||0,w.y||0),w.id===p.value){l.shadowColor="transparent",l.shadowBlur=0;const Se=l.measureText(w.content||w.txt||"");l.strokeStyle="#007bff",l.lineWidth=2,l.setLineDash([5,5]),l.strokeRect((w.x||0)-4,(w.y||0)-4,Se.width+8,be+8),l.setLineDash([])}l.restore()}),xt();return}if(!n.value||!y.value)return;const s=n.value.getContext("2d");s.clearRect(0,0,n.value.width,n.value.height);let a=0;if(b.transforms.value.shadowEnabled){const l=Math.abs(b.transforms.value.shadowOffsetX),pe=Math.abs(b.transforms.value.shadowOffsetY),w=b.transforms.value.shadowBlur;a=Math.max(l,pe)+w+10}const f=a,C=a,x=n.value.width-a*2,U=n.value.height-a*2;Be.value.opacity>0&&(s.save(),s.globalAlpha=Be.value.opacity/100,s.fillStyle=Be.value.color,s.fillRect(0,0,n.value.width,n.value.height),s.restore());const ie=b.applyToCanvas(n.value,s),ke=100+L.value.exposure,Ue=100+L.value.highlights*.5,Ze=100+L.value.shadows*.3,h=`
    brightness(${L.value.brightness*(ke/100)*(Ue/100)}%)
    contrast(${L.value.contrast*(Ze/100)}%)
    saturate(${L.value.saturation}%)
    blur(${L.value.blur}px)
    hue-rotate(${L.value.hue}deg)
    sepia(${L.value.sepia}%)
    grayscale(${L.value.grayscale}%)
    invert(${L.value.invert}%)
  `;s.filter=h;const ze=()=>{const l=b.transforms.value.borderRadius,pe=Math.min(x,U);return l/100*pe};if(b.transforms.value.shadowEnabled){s.save(),s.filter="none";const l=b.transforms.value.shadowOpacity/100,pe=b.transforms.value.shadowColor,w=parseInt(pe.slice(1,3),16),$e=parseInt(pe.slice(3,5),16),be=parseInt(pe.slice(5,7),16);if(s.shadowColor=`rgba(${w}, ${$e}, ${be}, ${l})`,s.shadowBlur=b.transforms.value.shadowBlur,s.shadowOffsetX=b.transforms.value.shadowOffsetX,s.shadowOffsetY=b.transforms.value.shadowOffsetY,s.fillStyle="rgba(0, 0, 0, 1)",b.transforms.value.borderRadius>=50){const Se=f+x/2,He=C+U/2,Ne=Math.min(x,U)/2;s.beginPath(),s.arc(Se,He,Ne,0,Math.PI*2),s.fill()}else b.transforms.value.borderRadius>0?(nt(s,f,C,x,U,ze()),s.fill()):s.fillRect(f,C,x,U);s.restore(),s.filter=h}if(b.transforms.value.borderRadius>0)if(s.save(),b.transforms.value.borderRadius>=50){const l=f+x/2,pe=C+U/2,w=Math.min(x,U)/2;s.beginPath(),s.arc(l,pe,w,0,Math.PI*2),s.clip()}else nt(s,f,C,x,U,ze()),s.clip();if(s.drawImage(y.value,f,C,x,U),b.transforms.value.borderWidth>0)if(s.strokeStyle=b.transforms.value.borderColor,s.lineWidth=b.transforms.value.borderWidth,b.transforms.value.borderRadius>=50){const l=f+x/2,pe=C+U/2,w=Math.min(x,U)/2-b.transforms.value.borderWidth/2;s.beginPath(),s.arc(l,pe,w,0,Math.PI*2),s.stroke()}else b.transforms.value.borderRadius>0?(nt(s,f,C,x,U,ze()),s.stroke()):s.strokeRect(f,C,x,U);if(b.transforms.value.borderRadius>0&&s.restore(),L.value.vignette>0){s.save();const l=L.value.vignette/100,pe=n.value.width/2,w=n.value.height/2,$e=Math.max(pe,w)*(1.5-l*.5),be=s.createRadialGradient(pe,w,$e*.3,pe,w,$e);be.addColorStop(0,"rgba(0, 0, 0, 0)"),be.addColorStop(.5,`rgba(0, 0, 0, ${l*.3})`),be.addColorStop(1,`rgba(0, 0, 0, ${l*.8})`),s.fillStyle=be,s.fillRect(0,0,n.value.width,n.value.height),s.restore()}s.filter="none",ie&&ie(),u.texts&&u.texts.length>0&&u.texts.forEach(l=>{s.save();const pe=l.opacity!==void 0?l.opacity:100;s.globalAlpha=pe/100,s.font=`${l.fontSize||l.size||32}px ${l.fontFamily||"Arial"}`,s.fillStyle=l.color||"#000000",s.textBaseline="top",l.shadowBlur&&l.shadowBlur>0&&(s.shadowColor=l.shadowColor||"#000000",s.shadowBlur=l.shadowBlur,s.shadowOffsetX=l.shadowOffsetX||2,s.shadowOffsetY=l.shadowOffsetY||2);const w=l.rotation||0;if(w!==0){const be=s.measureText(l.content||l.txt||"").width,Se=l.fontSize||l.size||32,He=(l.x||0)+be/2,Ne=(l.y||0)+Se/2;s.translate(He,Ne),s.rotate(w*Math.PI/180),s.translate(-He,-Ne)}l.strokeWidth&&l.strokeWidth>0&&(s.strokeStyle=l.strokeColor||"#000000",s.lineWidth=l.strokeWidth,s.lineJoin="round",s.strokeText(l.content||l.txt||"",l.x||0,l.y||0)),s.fillText(l.content||l.txt||"",l.x||0,l.y||0),s.restore()}),xt(),na()}function na(){var C;if(!n.value||!p.value)return;const s=n.value.getContext("2d"),a=(C=u.texts)==null?void 0:C.find(x=>x.id===p.value);if(!a)return;s.save(),s.font=`${a.fontSize||a.size||32}px ${a.fontFamily||"Arial"}`;const f=s.measureText(a.content||a.txt||"");s.strokeStyle="#0066ff",s.lineWidth=2,s.setLineDash([5,5]),s.strokeRect(a.x-4,a.y-4,f.width+8,(a.fontSize||a.size||32)+8),s.setLineDash([]),s.restore()}function oa(s=!1){if(ae.value&&u.hasImageLayers){const h=n.value.getContext("2d");h.clearRect(0,0,n.value.width,n.value.height);const ze=u.canvasBackgroundColor;!s&&ze&&ze!=="transparent"&&(h.save(),h.fillStyle=ze,h.fillRect(0,0,n.value.width,n.value.height),h.restore()),u.imageLayers.forEach(l=>{var Se,He,Ne,ut;if(!l.visible||!l.image||!l.image.complete)return;h.save(),h.globalAlpha=l.opacity/100;const pe=[];if(l.filters.brightness!==100&&pe.push(`brightness(${l.filters.brightness}%)`),l.filters.contrast!==100&&pe.push(`contrast(${l.filters.contrast}%)`),l.filters.saturation!==100&&pe.push(`saturate(${l.filters.saturation}%)`),l.filters.grayscale>0&&pe.push(`grayscale(${l.filters.grayscale}%)`),l.filters.sepia>0&&pe.push(`sepia(${l.filters.sepia}%)`),h.filter=pe.length>0?pe.join(" "):"none",l.rotation!==0){const le=l.x+l.width/2,se=l.y+l.height/2;h.translate(le,se),h.rotate(l.rotation*Math.PI/180),h.translate(-le,-se)}if(l.flipX||l.flipY){const le=l.x+l.width/2,se=l.y+l.height/2;h.translate(le,se),h.scale(l.flipX?-1:1,l.flipY?-1:1),h.translate(-le,-se)}const w=l.shadow&&l.shadow.enabled,$e=((Se=l.border)==null?void 0:Se.radius)||0;if(w&&$e>0){h.save();const le=(l.shadow.opacity||50)/100,se=l.shadow.color||"#000000",K=parseInt(se.slice(1,3),16),q=parseInt(se.slice(3,5),16),Pe=parseInt(se.slice(5,7),16);h.shadowColor=`rgba(${K}, ${q}, ${Pe}, ${le})`,h.shadowBlur=l.shadow.blur||10,h.shadowOffsetX=l.shadow.offsetX||5,h.shadowOffsetY=l.shadow.offsetY||5;const Q=l.x,De=l.y,ne=l.width,Re=l.height,_e=Math.min(ne,Re),Ae=$e/100*(_e/2);h.fillStyle="#ffffff",h.beginPath(),h.moveTo(Q+Ae,De),h.lineTo(Q+ne-Ae,De),h.quadraticCurveTo(Q+ne,De,Q+ne,De+Ae),h.lineTo(Q+ne,De+Re-Ae),h.quadraticCurveTo(Q+ne,De+Re,Q+ne-Ae,De+Re),h.lineTo(Q+Ae,De+Re),h.quadraticCurveTo(Q,De+Re,Q,De+Re-Ae),h.lineTo(Q,De+Ae),h.quadraticCurveTo(Q,De,Q+Ae,De),h.closePath(),h.fill(),h.restore()}else if(w){const le=(l.shadow.opacity||50)/100,se=l.shadow.color||"#000000",K=parseInt(se.slice(1,3),16),q=parseInt(se.slice(3,5),16),Pe=parseInt(se.slice(5,7),16);h.shadowColor=`rgba(${K}, ${q}, ${Pe}, ${le})`,h.shadowBlur=l.shadow.blur||10,h.shadowOffsetX=l.shadow.offsetX||5,h.shadowOffsetY=l.shadow.offsetY||5}const be=((He=l.border)==null?void 0:He.width)||0;if($e>0){h.save(),h.shadowColor="transparent",h.shadowBlur=0,h.shadowOffsetX=0,h.shadowOffsetY=0,h.beginPath();const le=l.x,se=l.y,K=l.width,q=l.height,Pe=Math.min(K,q),Q=$e/100*(Pe/2);h.moveTo(le+Q,se),h.lineTo(le+K-Q,se),h.quadraticCurveTo(le+K,se,le+K,se+Q),h.lineTo(le+K,se+q-Q),h.quadraticCurveTo(le+K,se+q,le+K-Q,se+q),h.lineTo(le+Q,se+q),h.quadraticCurveTo(le,se+q,le,se+q-Q),h.lineTo(le,se+Q),h.quadraticCurveTo(le,se,le+Q,se),h.closePath(),h.clip(),h.drawImage(l.image,l.x,l.y,l.width,l.height),h.restore(),h.shadowColor="transparent",h.shadowBlur=0,h.shadowOffsetX=0,h.shadowOffsetY=0,be>0&&(h.strokeStyle=((Ne=l.border)==null?void 0:Ne.color)||"#000000",h.lineWidth=be,h.beginPath(),h.moveTo(le+Q,se),h.lineTo(le+K-Q,se),h.quadraticCurveTo(le+K,se,le+K,se+Q),h.lineTo(le+K,se+q-Q),h.quadraticCurveTo(le+K,se+q,le+K-Q,se+q),h.lineTo(le+Q,se+q),h.quadraticCurveTo(le,se+q,le,se+q-Q),h.lineTo(le,se+Q),h.quadraticCurveTo(le,se,le+Q,se),h.closePath(),h.stroke())}else h.drawImage(l.image,l.x,l.y,l.width,l.height),h.shadowColor="transparent",h.shadowBlur=0,h.shadowOffsetX=0,h.shadowOffsetY=0,be>0&&(h.strokeStyle=((ut=l.border)==null?void 0:ut.color)||"#000000",h.lineWidth=be,h.strokeRect(l.x,l.y,l.width,l.height));h.restore()}),h.filter="none",u.texts&&u.texts.length>0&&u.texts.forEach(l=>{h.save();const pe=l.opacity!==void 0?l.opacity:100;h.globalAlpha=pe/100;const w=l.fontSize||l.size||32;if(h.font=`${w}px ${l.fontFamily||"Arial"}`,h.fillStyle=l.color||"#000000",h.textBaseline="top",l.rotation&&l.rotation!==0){const $e=h.measureText(l.content||l.txt||""),be=(l.x||0)+$e.width/2,Se=(l.y||0)+w/2;h.translate(be,Se),h.rotate(l.rotation*Math.PI/180),h.translate(-be,-Se)}l.shadowBlur&&l.shadowBlur>0&&(h.shadowColor=l.shadowColor||"#000000",h.shadowBlur=l.shadowBlur,h.shadowOffsetX=l.shadowOffsetX||2,h.shadowOffsetY=l.shadowOffsetY||2),l.strokeWidth&&l.strokeWidth>0&&(h.strokeStyle=l.strokeColor||"#000000",h.lineWidth=l.strokeWidth,h.lineJoin="round",h.strokeText(l.content||l.txt||"",l.x||0,l.y||0)),h.fillText(l.content||l.txt||"",l.x||0,l.y||0),h.restore()});return}if(!n.value||!y.value)return;const a=n.value.getContext("2d");a.clearRect(0,0,n.value.width,n.value.height);let f=0;if(b.transforms.value.shadowEnabled){const h=Math.abs(b.transforms.value.shadowOffsetX),ze=Math.abs(b.transforms.value.shadowOffsetY),l=b.transforms.value.shadowBlur;f=Math.max(h,ze)+l+10}const C=f,x=f,U=n.value.width-f*2,ie=n.value.height-f*2;!s&&Be.value.opacity>0&&(a.save(),a.globalAlpha=Be.value.opacity/100,a.fillStyle=Be.value.color,a.fillRect(0,0,n.value.width,n.value.height),a.restore());const ke=b.applyToCanvas(n.value,a),Ue=`
    brightness(${L.value.brightness}%)
    contrast(${L.value.contrast}%)
    saturate(${L.value.saturation}%)
    blur(${L.value.blur}px)
    hue-rotate(${L.value.hue}deg)
  `;a.filter=Ue;const Ze=()=>{const h=b.transforms.value.borderRadius,ze=Math.min(U,ie);return h/100*ze};if(b.transforms.value.shadowEnabled){a.save(),a.filter="none";const h=b.transforms.value.shadowOpacity/100,ze=b.transforms.value.shadowColor,l=parseInt(ze.slice(1,3),16),pe=parseInt(ze.slice(3,5),16),w=parseInt(ze.slice(5,7),16);if(a.shadowColor=`rgba(${l}, ${pe}, ${w}, ${h})`,a.shadowBlur=b.transforms.value.shadowBlur,a.shadowOffsetX=b.transforms.value.shadowOffsetX,a.shadowOffsetY=b.transforms.value.shadowOffsetY,a.fillStyle="rgba(0, 0, 0, 1)",b.transforms.value.borderRadius>=50){const $e=C+U/2,be=x+ie/2,Se=Math.min(U,ie)/2;a.beginPath(),a.arc($e,be,Se,0,Math.PI*2),a.fill()}else b.transforms.value.borderRadius>0?(nt(a,C,x,U,ie,Ze()),a.fill()):a.fillRect(C,x,U,ie);a.restore(),a.filter=Ue}if(b.transforms.value.borderRadius>0)if(a.save(),b.transforms.value.borderRadius>=50){const h=C+U/2,ze=x+ie/2,l=Math.min(U,ie)/2;a.beginPath(),a.arc(h,ze,l,0,Math.PI*2),a.clip()}else nt(a,C,x,U,ie,Ze()),a.clip();if(a.drawImage(y.value,C,x,U,ie),b.transforms.value.borderWidth>0)if(a.strokeStyle=b.transforms.value.borderColor,a.lineWidth=b.transforms.value.borderWidth,b.transforms.value.borderRadius>=50){const h=C+U/2,ze=x+ie/2,l=Math.min(U,ie)/2-b.transforms.value.borderWidth/2;a.beginPath(),a.arc(h,ze,l,0,Math.PI*2),a.stroke()}else b.transforms.value.borderRadius>0?(nt(a,C,x,U,ie,Ze()),a.stroke()):a.strokeRect(C,x,U,ie);b.transforms.value.borderRadius>0&&a.restore(),a.filter="none",ke&&ke(),u.texts&&u.texts.length>0&&u.texts.forEach(h=>{a.save();const ze=h.opacity!==void 0?h.opacity:100;a.globalAlpha=ze/100,a.font=`${h.fontSize||h.size||32}px ${h.fontFamily||"Arial"}`,a.fillStyle=h.color||"#000000",a.textBaseline="top",h.shadowBlur&&h.shadowBlur>0&&(a.shadowColor=h.shadowColor||"#000000",a.shadowBlur=h.shadowBlur,a.shadowOffsetX=h.shadowOffsetX||2,a.shadowOffsetY=h.shadowOffsetY||2);const l=h.rotation||0;if(l!==0){const w=a.measureText(h.content||h.txt||"").width,$e=h.fontSize||h.size||32,be=(h.x||0)+w/2,Se=(h.y||0)+$e/2;a.translate(be,Se),a.rotate(l*Math.PI/180),a.translate(-be,-Se)}h.strokeWidth&&h.strokeWidth>0&&(a.strokeStyle=h.strokeColor||"#000000",a.lineWidth=h.strokeWidth,a.lineJoin="round",a.strokeText(h.content||h.txt||"",h.x||0,h.y||0)),a.fillText(h.content||h.txt||"",h.x||0,h.y||0),a.restore()})}function la(){if(!y.value||!z.value||!confirm(`Do you really want to discard all changes?

The image will be reset to its original state. All filters, texts, crops and transformations will be lost.`))return;Le.resetAll(),G.resetCropState(),b.resetTransforms(),u.texts.splice(0,u.texts.length),p.value=null,y.value=z.value;const a=1200,f=800;let C=z.value.width,x=z.value.height;if(C>a||x>f){const U=Math.min(a/C,f/x);C*=U,x*=U}n.value.width=C,n.value.height=x,c.initFromDimensions(C,x),P(),vt(),V.value=[],E.value=-1,Me(),console.log("✅ Bild auf Originalzustand zurückgesetzt"),window.$toast&&window.$toast.success("Image has been reset to its original state")}function ia(){if(!y.value&&!ae.value)return;const s=ae.value?"Möchten Sie die Collage wirklich entfernen? Alle Layer und Änderungen gehen verloren.":"Möchten Sie das Bild wirklich entfernen? Alle Änderungen gehen verloren.";confirm(s)&&(ae.value&&(u.clearImageLayers(),ae.value=!1,ye.removeListeners()),y.value=null,z.value=null,ee.value="",fe.value="",Ie.value=0,xe.value=0,Qe.value=0,n.value&&(n.value.getContext("2d").clearRect(0,0,n.value.width,n.value.height),n.value.width=0,n.value.height=0),L.value={brightness:100,contrast:100,saturation:100,blur:0,hue:0,sepia:0,grayscale:0,invert:0,exposure:0,highlights:0,shadows:0,sharpness:0,vignette:0},Ge.value=null,G.resetCropState(),b.resetTransforms(),V.value=[],E.value=-1,j.value=null,oe.value=null,o&&typeof o.clearAllTexts=="function"&&o.clearAllTexts(),p.value=null,u&&typeof u.clearImage=="function"&&u.clearImage(),t.value&&(t.value.value=""),console.log("🗑️ Bild erfolgreich gelöscht"),window.$toast&&window.$toast.success(m("toast.editor.imageDeleted")))}function ra(s){Le.applyPreset(s),Me()}function zt(s){c.onDimensionChange(s)}function ua(s){!s||!y.value||c.applyPreset(s)}function da(){!n.value||!y.value||(n.value.width=j.value,n.value.height=oe.value,P(),lt(),Me(),window.$toast&&window.$toast.success(m("toast.editor.resizeSuccess",{width:j.value,height:oe.value})))}async function ca(){if(n.value){te.value=!0;try{const s=`image-${Date.now()}`,a=_.value==="png"&&ve.value;oa(a);const f=await fu(n.value,_.value,s,{quality:R.value/100,texts:u.texts||[]});console.log("✅ Export erfolgreich:",f),window.$toast&&window.$toast.success(`Bild erfolgreich als ${f.format.toUpperCase()} exportiert`+(f.size?` (${f.size})`:""))}catch(s){console.error("❌ Export fehlgeschlagen:",s),window.$toast?window.$toast.error(`Export fehlgeschlagen: ${s.message}`):alert(`Export fehlgeschlagen: ${s.message}`)}finally{te.value=!1,P()}}}function Me(){n.value&&We.saveState({imageData:n.value.toDataURL(),filters:{...L.value},background:{...Be.value},width:n.value.width,height:n.value.height})}function Rt(){We.undo()}function Lt(){We.redo()}function fa(s){const a=new Image;a.onload=()=>{n.value.width=s.width,n.value.height=s.height,s.filters&&Le.importState({filters:s.filters,background:s.background}),n.value.getContext("2d").drawImage(a,0,0),vt(),P()},a.src=s.imageData}function va(s){if(s===0)return"0 Bytes";const a=1024,f=["Bytes","KB","MB"],C=Math.floor(Math.log(s)/Math.log(a));return Math.round(s/Math.pow(a,C)*100)/100+" "+f[C]}function ha(){const s=G.toggleCropMode();s==="finish"?Ot():s==="activated"&&n.value&&G.setCanvasSize(n.value.width,n.value.height)}function Ot(){G.finishCrop({canvas:n,currentImage:y,filters:L,imageStore:u,onCropComplete:(s,a,f,C)=>{y.value=s,n.value.width=a,n.value.height=f,c.initFromDimensions(a,f),C&&b.setBorderRadius(50,!1),P(),lt(),Me()}})}function pa(){G.undoCrop({imageStore:u,onUndoComplete:(s,a)=>{y.value=s,n.value.width=a.width,n.value.height=a.height,c.initFromDimensions(a.width,a.height),L.value={...a.filters},P(),lt(),Me()}})}function ma(s){G.setAspectRatio(s)}function ga(s){b.setOpacity(s),P()}function wa(s){b.setRotation(s),P()}function ba(s){b.setScale(s),P()}function ya(s){b.setBorderRadius(s),P()}function $a(s){b.setBorderWidth(s),P()}function xa(s){b.setBorderColor(s),P()}function ka(s){b.setShadowEnabled(s),P()}function Ca(s){b.setShadowOffsetX(s),P()}function Ta(s){b.setShadowOffsetY(s),P()}function Ia(s){b.setShadowBlur(s),P()}function Sa(s){b.setShadowColor(s),P()}function Pa(s){b.setShadowOpacity(s),P()}function Ma(s){b.setSkewX(s),P()}function Ba(s){b.setSkewY(s),P()}function Ut(){b.rotate90(),P(),window.$toast&&window.$toast.success(m("toast.transform.rotated90"))}function Dt(){b.rotate90Counter(),P(),window.$toast&&window.$toast.success(m("toast.transform.rotated90"))}function Ft(){b.rotate180(),P(),window.$toast&&window.$toast.success(m("toast.transform.rotated180"))}function Xt(){b.flipHorizontal(),P(),window.$toast&&window.$toast.success(m("toast.transform.flippedHorizontal"))}function Yt(){b.flipVertical(),P(),window.$toast&&window.$toast.success(m("toast.transform.flippedVertical"))}function Et(){b.undoTransform()&&(P(),window.$toast&&window.$toast.info(m("toast.transform.undo","Transformation rückgängig")))}function At(){b.redoTransform()&&(P(),window.$toast&&window.$toast.info(m("toast.transform.redo","Transformation wiederhergestellt")))}function za(){b.commitTransform()}function Ra(){b.resetPan(),P(),window.$toast&&window.$toast.info(m("toast.transform.panReset","Ansicht zurückgesetzt"))}function nt(s,a,f,C,x,U){s.beginPath(),s.moveTo(a+U,f),s.lineTo(a+C-U,f),s.quadraticCurveTo(a+C,f,a+C,f+U),s.lineTo(a+C,f+x-U),s.quadraticCurveTo(a+C,f+x,a+C-U,f+x),s.lineTo(a+U,f+x),s.quadraticCurveTo(a,f+x,a,f+x-U),s.lineTo(a,f+U),s.quadraticCurveTo(a,f,a+U,f),s.closePath()}function La(){if(!y.value)return;const s={id:Date.now(),content:"Neuer Text",x:Math.floor(n.value.width/2)-50,y:Math.floor(n.value.height/2),fontSize:32,fontFamily:"Satoshi Regular",color:"#000000",rotation:0,opacity:100,strokeWidth:0,strokeColor:"#000000",shadowBlur:0,shadowOffsetX:2,shadowOffsetY:2,shadowColor:"#000000"};u.texts.push(s),p.value=s.id,P(),Me()}function Oa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.content=s,a.txt=s,P())}function Ua(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.fontSize=s,a.size=s,P())}function Da(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.fontFamily=s,P(),Me())}function Fa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.color=s,P())}function Xa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.rotation=s,P())}function Ya(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.opacity=s,P())}function Ea(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.strokeWidth=s,P())}function Aa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.strokeColor=s,P())}function Wa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.shadowBlur=s,s>0&&!a.shadowOffsetX&&(a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowColor=a.shadowColor||"#000000"),P())}function Ha(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.shadowOffsetX=s,P())}function Na(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.shadowOffsetY=s,P())}function qa(s){if(!p.value)return;const a=u.texts.find(f=>f.id===p.value);a&&(a.shadowColor=s,P())}function Va(){if(!p.value)return;const s=u.texts.findIndex(a=>a.id===p.value);s!==-1&&(u.texts.splice(s,1),p.value=null,P(),Me())}function ja(){p.value=null,P()}function Ga(){we()}function Ka(){r(),P()}function Ja(){i(),P()}function kt(s){const a=n.value.getBoundingClientRect(),f=s.clientX-a.left,C=s.clientY-a.top,x=n.value.width/a.width,U=n.value.height/a.height;return{x:f*x,y:C*U}}function Wt(){return n.value?n.value.getBoundingClientRect().width/n.value.width:1}function Qa(s){p.value=s,P()}function rt(s,a){if(!u.texts||u.texts.length===0)return null;const f=n.value.getContext("2d");for(let C=u.texts.length-1;C>=0;C--){const x=u.texts[C],U=x.fontSize||x.size||32,ie=x.content||x.txt||"";f.font=`${U}px ${x.fontFamily||"Arial"}`;const ke=f.measureText(ie),Ue=8;if(s>=x.x-Ue&&s<=x.x+ke.width+Ue&&a>=x.y-Ue&&a<=x.y+U+Ue)return x}return null}function Za(s){const a=kt(s),f=Wt();if((s.button===1||k.value&&s.button===0)&&b.canPan.value){s.preventDefault(),T.value=!0,Z.value={x:s.clientX,y:s.clientY},n.value.style.cursor="grabbing";return}if(G.handleMouseDown(a,f))return;if(ae.value){const ke=rt(a.x,a.y);if(ke){p.value=ke.id,H.value=!0,X.value={x:a.x-ke.x,y:a.y-ke.y},n.value.style.cursor="grabbing",u.selectImageLayer(null),P();return}p.value=null,ye.handleMouseDown(s),P();return}const ie=rt(a.x,a.y);ie?(p.value=ie.id,H.value=!0,X.value={x:a.x-ie.x,y:a.y-ie.y},n.value.style.cursor="grabbing"):p.value=null,P()}function _a(s){const a=kt(s);if(T.value){const C=s.clientX-Z.value.x,x=s.clientY-Z.value.y;Z.value={x:s.clientX,y:s.clientY},b.pan(C,x),P();return}if(!G.handleMouseMove(a)){if(ae.value){if(H.value&&p.value){const C=u.texts.find(x=>x.id===p.value);C&&(C.x=a.x-X.value.x,C.y=a.y-X.value.y,P());return}ye.handleMouseMove(s),(ye.isDragging.value||ye.isResizing.value)&&P(),!ye.isDragging.value&&!ye.isResizing.value&&rt(a.x,a.y)&&(n.value.style.cursor="grab");return}if(H.value&&p.value){const C=u.texts.find(x=>x.id===p.value);C&&(C.x=a.x-X.value.x,C.y=a.y-X.value.y,P())}else{const C=rt(a.x,a.y);let x="default";if(k.value&&b.canPan.value)x="grab";else if(G.cropMode.value){const U=Wt();x=G.getCursorForPosition(a.x,a.y,U)}else C&&(x="grab");n.value.style.cursor=x}}}function es(){if(T.value){T.value=!1,n.value.style.cursor=k.value&&b.canPan.value?"grab":"default";return}if(G.handleMouseUp()){Ot();return}if(ae.value){if(H.value){H.value=!1,n.value.style.cursor="default",P();return}ye.handleMouseUp(),P();return}H.value&&(H.value=!1,n.value.style.cursor="default",Me())}function ts(s){const a=kt(s),f=rt(a.x,a.y);f&&o.openEditTextModal(f.id)}ot(()=>u.texts,()=>{P()},{deep:!0});function as(){!y.value||!n.value||(P(),setTimeout(()=>{M.value=ee.value||u.workingUrl||"",n.value&&(B.value=n.value.toDataURL("image/png")),re.value++,Y.value=!0,console.log("🖼️ Preview aktualisiert:",{hasOriginal:!!M.value,hasEdited:!!B.value,trigger:re.value})},100))}function Ht(){Y.value=!1}function ss(){n.value&&(P(),setTimeout(()=>{u.imageLayers.length>0?M.value=u.imageLayers[0].url||"":M.value="",n.value&&(B.value=n.value.toDataURL("image/png")),re.value++,Y.value=!0},100))}async function ns(){const s=u.imageLayers;if(!s||s.length===0)return;console.log(`🔄 Lade ${s.length} Layer-Bilder neu...`);const a=s.map(f=>new Promise(C=>{if(f.image&&f.image.complete&&f.image.naturalWidth>0){console.log(`✓ Layer "${f.name}" bereits geladen`),C();return}const x=new Image;x.crossOrigin="anonymous",x.onload=()=>{f.image=x,console.log(`✓ Layer "${f.name}" neu geladen`),C()},x.onerror=()=>{console.error(`✗ Fehler beim Laden von Layer "${f.name}"`),C()},x.src=f.url}));await Promise.all(a),console.log("✅ Alle Layer-Bilder geladen")}async function Nt(s){if(!s)return!1;try{const{useGalleryStore:a}=await Pt(async()=>{const{useGalleryStore:x}=await import("./galleryStore.V44e_1hc.js");return{useGalleryStore:x}},__vite__mapDeps([0,1,2,3])),C=a().getImage(Number(s));if(C){console.log("Lade Bild aus Galerie:",C.name);const x=new Image;return x.onload=async()=>{ee.value=C.url,z.value=x;const U=C.name.match(/\.(\w+)$/);if(U){const ie=U[1].toLowerCase();fe.value=ie==="jpeg"?"jpg":ie}await it(x),console.log("✅ Bild aus Galerie geladen (inkl. Original für Vorschau)"),window.$toast&&window.$toast.success(m("toast.editor.galleryLoaded"))},x.src=C.url,!0}}catch(a){console.error("Fehler beim Laden aus Galerie:",a),window.$toast&&window.$toast.error(m("toast.editor.galleryError"),a.message)}return!1}function qt(s){const a=G.isDragging.value||G.isResizing.value||G.isCreating.value;if(!a&&!T.value&&!H.value||!n.value)return;const f=n.value.getBoundingClientRect(),C=s.clientX-f.left,x=s.clientY-f.top,U=n.value.width/f.width,ie=n.value.height/f.height,ke={x:C*U,y:x*ie};if(a){G.handleMouseMove(ke);return}if(T.value){const Ue=s.clientX-Z.value.x,Ze=s.clientY-Z.value.y;Z.value={x:s.clientX,y:s.clientY},b.pan(Ue,Ze),P();return}if(H.value&&p.value){const Ue=u.texts.find(Ze=>Ze.id===p.value);Ue&&(Ue.x=ke.x-X.value.x,Ue.y=ke.y-X.value.y,P())}}function Vt(){(G.isDragging.value||G.isResizing.value||G.isCreating.value)&&G.cancelDragResize(),H.value&&(H.value=!1,n.value&&(n.value.style.cursor="default")),T.value&&(T.value=!1,n.value&&(n.value.style.cursor=k.value&&b.canPan.value?"grab":"default"))}yt(async()=>{if(window.addEventListener("keydown",jt),window.addEventListener("keyup",Gt),window.addEventListener("mousemove",qt),window.addEventListener("mouseup",Vt),await ht(),g.query.collageMode==="true"&&u.hasImageLayers){ae.value=!0,await ht(),n.value?(n.value.width=1200,n.value.height=800,u.initCanvas(n.value),await ns(),u.draw(),vt(),console.log(`✅ Collage-Modus aktiviert mit ${u.imageLayerCount} Layern`)):console.error("❌ Canvas nicht gefunden im Collage-Modus");return}!await Nt(g.query.galleryImageId)&&u.hasImage&&u.originalImage&&(y.value=u.originalImage,await ht(),n.value&&it(u.originalImage))}),ot(()=>g.query.galleryImageId,async(s,a)=>{s&&s!==a&&(console.log("🔄 Galerie-Bild-ID geändert:",s),await Nt(s))}),_t(()=>{window.removeEventListener("keydown",jt),window.removeEventListener("keyup",Gt),window.removeEventListener("mousemove",qt),window.removeEventListener("mouseup",Vt),ae.value&&ye.removeListeners()});function jt(s){var f,C,x;const a=((f=document.activeElement)==null?void 0:f.tagName)==="INPUT"||((C=document.activeElement)==null?void 0:C.tagName)==="TEXTAREA"||((x=document.activeElement)==null?void 0:x.tagName)==="SELECT";if(s.code==="Space"&&b.canPan.value&&!s.repeat&&(a||(s.preventDefault(),k.value=!0,n.value&&(n.value.style.cursor="grab"))),s.ctrlKey||s.metaKey){s.key==="z"&&!s.shiftKey?(s.preventDefault(),b.canUndoTransform.value?Et():Rt()):(s.key==="y"||s.key==="z"&&s.shiftKey)&&(s.preventDefault(),b.canRedoTransform.value?At():Lt());return}if(y.value&&!a)switch(s.key){case"h":case"H":s.preventDefault(),Xt();break;case"v":case"V":s.preventDefault(),Yt();break;case"ArrowLeft":s.preventDefault(),s.shiftKey?b.setRotation(b.transforms.value.rotation-15,!0):b.setRotation(b.transforms.value.rotation-1,!0),P();break;case"ArrowRight":s.preventDefault(),s.shiftKey?b.setRotation(b.transforms.value.rotation+15,!0):b.setRotation(b.transforms.value.rotation+1,!0),P();break;case"r":case"R":s.preventDefault(),b.transforms.value.rotation!==0&&(b.setRotation(0,!0),P(),window.$toast&&window.$toast.info(m("toast.transform.rotationReset","Rotation zurückgesetzt")));break;case"1":s.preventDefault(),Dt();break;case"2":s.preventDefault(),Ft();break;case"3":s.preventDefault(),Ut();break;case"Delete":case"Backspace":p.value&&(s.preventDefault(),u.deleteText(p.value),p.value=null);break}}function Gt(s){s.code==="Space"&&(k.value=!1,T.value=!1,n.value&&(n.value.style.cursor="default"))}return(s,a)=>(W(),N("div",hu,[e("div",pu,[e("div",mu,[e("div",gu,[e("button",{class:"btn btn-primary",onClick:Bt},[a[30]||(a[30]=e("i",{class:"fas fa-file-upload"},null,-1)),F(" "+v(s.$t("editor.toolbar.upload")),1)]),e("input",{ref_key:"fileInput",ref:t,type:"file",accept:"image/*",onChange:ea,style:{display:"none"}},null,544)]),e("div",wu,[e("button",{class:"btn btn-secondary",onClick:Rt,disabled:!$(O),title:s.$t("editor.toolbar.undo","Rückgängig")},[...a[31]||(a[31]=[e("i",{class:"fas fa-undo"},null,-1)])],8,bu),e("button",{class:"btn btn-secondary",onClick:Lt,disabled:!$(S),title:s.$t("editor.toolbar.redo","Wiederholen")},[...a[32]||(a[32]=[e("i",{class:"fas fa-redo"},null,-1)])],8,yu),a[37]||(a[37]=e("span",{class:"toolbar-divider"},null,-1)),e("button",{class:"btn btn-secondary",onClick:La,disabled:!y.value&&!ae.value},[...a[33]||(a[33]=[e("i",{class:"fas fa-font"},null,-1),F(" Text ",-1)])],8,$u),e("button",{class:"btn btn-secondary",onClick:as,disabled:!y.value&&!ae.value},[a[34]||(a[34]=e("i",{class:"fas fa-eye"},null,-1)),F(" "+v(s.$t("editor.toolbar.preview","Vorschau")),1)],8,xu),e("button",{class:"btn btn-secondary",onClick:la,disabled:!y.value&&!ae.value},[a[35]||(a[35]=e("i",{class:"fas fa-sync-alt"},null,-1)),F(" "+v(s.$t("editor.toolbar.reset")),1)],8,ku),e("button",{class:"btn btn-danger",onClick:ia,disabled:!y.value&&!ae.value,title:s.$t("editor.toolbar.clearImage","Bild entfernen")},[a[36]||(a[36]=e("i",{class:"fas fa-trash"},null,-1)),F(" "+v(s.$t("editor.toolbar.clearImage","Löschen")),1)],8,Cu),e("button",{class:"btn btn-success",onClick:ca,disabled:!y.value&&!ae.value||te.value},[e("i",{class:de(te.value?"fas fa-spinner fa-spin":"fas fa-download")},null,2),F(" "+v(te.value?"Exportiere...":s.$t("editor.toolbar.download")),1)],8,Tu)])]),e("div",Iu,[e("aside",Su,[e("div",Pu,[e("h3",null,v(s.$t("editor.sidebar.format")),1),ge(e("select",{"onUpdate:modelValue":a[0]||(a[0]=f=>_.value=f),class:"form-select"},[(W(!0),N(qe,null,Je($(he),f=>{var C;return W(),N("option",{key:f,value:f},v((C=$(ft)[f])==null?void 0:C.icon)+" "+v(f.toUpperCase()),9,Mu)}),128))],512),[[rs,_.value]]),Ee.value?(W(),N("div",Bu,[e("p",zu,v(Ee.value.description),1),e("span",Ru,v(Ee.value.recommended),1),at.value?(W(),N("span",Lu," 🌐 Backend ")):me("",!0)])):me("",!0),Oe.value?(W(),N("div",Ou,[e("label",null,v(s.$t("editor.export.quality","Qualität")),1),ge(e("input",{type:"range",min:"1",max:"100","onUpdate:modelValue":a[1]||(a[1]=f=>R.value=f)},null,512),[[Fe,R.value,void 0,{number:!0}]]),e("span",null,v(R.value)+"%",1)])):me("",!0),_.value==="png"?(W(),N("div",Uu,[e("label",Du,[ge(e("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=f=>ve.value=f)},null,512),[[Kt,ve.value]]),e("span",null,v(s.$t("editor.export.transparentBackground","Transparenter Hintergrund")),1)])])):me("",!0)]),e("div",{class:de(["sidebar-section",{"disabled-section":!y.value}])},[e("h3",null,v(s.$t("editor.sidebar.background","Hintergrund")),1),e("div",Fu,[e("label",null,v(s.$t("editor.background.color","Farbe")),1),e("div",Xu,[ge(e("input",{type:"color","onUpdate:modelValue":a[3]||(a[3]=f=>$(Be).color=f),onInput:P,class:"color-input",disabled:!y.value},null,40,Yu),[[Fe,$(Be).color]]),ge(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=f=>$(Be).color=f),onInput:P,class:"color-text-input",maxlength:"7",disabled:!y.value},null,40,Eu),[[Fe,$(Be).color]])])]),e("div",Au,[e("label",null,v(s.$t("editor.background.opacity","Deckkraft")),1),ge(e("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":a[5]||(a[5]=f=>$(Be).opacity=f),onInput:P,disabled:!y.value},null,40,Wu),[[Fe,$(Be).opacity,void 0,{number:!0}]]),e("span",null,v($(Be).opacity)+"%",1)]),y.value?me("",!0):(W(),N("p",Hu,[a[38]||(a[38]=e("i",{class:"fas fa-info-circle"},null,-1)),F(" "+v(s.$t("editor.background.hint","Bild laden um Hintergrund anzupassen")),1)]))],2),e("div",{class:de(["sidebar-section collapsible",{collapsed:!$(Ce).adjustments}])},[e("h3",{onClick:a[6]||(a[6]=f=>$(Ce).adjustments=!$(Ce).adjustments),class:"section-header"},[a[39]||(a[39]=e("i",{class:"fas fa-sliders-h section-icon"},null,-1)),F(" "+v(s.$t("editor.sidebar.adjustments"))+" ",1),e("i",{class:de([$(Ce).adjustments?"fas fa-chevron-up":"fas fa-chevron-down","toggle-icon"])},null,2)]),ge(e("div",Nu,[e("div",qu,[e("label",null,[e("span",Vu,v(s.$t("editor.filters.brightness")),1),e("span",ju,v($(L).brightness)+"%",1)]),e("div",Gu,[ge(e("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[7]||(a[7]=f=>$(L).brightness=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).brightness,void 0,{number:!0}]])])]),e("div",Ku,[e("label",null,[e("span",Ju,v(s.$t("editor.filters.contrast")),1),e("span",Qu,v($(L).contrast)+"%",1)]),e("div",Zu,[ge(e("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[8]||(a[8]=f=>$(L).contrast=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).contrast,void 0,{number:!0}]])])]),e("div",_u,[e("label",null,[e("span",ed,v(s.$t("editor.filters.saturation")),1),e("span",td,v($(L).saturation)+"%",1)]),e("div",ad,[ge(e("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":a[9]||(a[9]=f=>$(L).saturation=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).saturation,void 0,{number:!0}]])])]),e("div",sd,[e("label",null,[e("span",nd,v(s.$t("editor.filters.exposure","Belichtung")),1),e("span",od,v($(L).exposure>0?"+":"")+v($(L).exposure),1)]),e("div",ld,[ge(e("input",{type:"range",min:"-50",max:"50","onUpdate:modelValue":a[10]||(a[10]=f=>$(L).exposure=f),onInput:P,onChange:Me,class:"modern-slider center-zero"},null,544),[[Fe,$(L).exposure,void 0,{number:!0}]])])])],512),[[Ke,$(Ce).adjustments]])],2),e("div",{class:de(["sidebar-section collapsible",{collapsed:!$(Ce).lightColor}])},[e("h3",{onClick:a[11]||(a[11]=f=>$(Ce).lightColor=!$(Ce).lightColor),class:"section-header"},[a[40]||(a[40]=e("i",{class:"fas fa-sun section-icon"},null,-1)),F(" "+v(s.$t("editor.sidebar.lightColor","Licht & Farbe"))+" ",1),e("i",{class:de([$(Ce).lightColor?"fas fa-chevron-up":"fas fa-chevron-down","toggle-icon"])},null,2)]),ge(e("div",id,[e("div",rd,[e("label",null,[e("span",ud,v(s.$t("editor.filters.highlights","Lichter")),1),e("span",dd,v($(L).highlights>0?"+":"")+v($(L).highlights),1)]),e("div",cd,[ge(e("input",{type:"range",min:"-100",max:"100","onUpdate:modelValue":a[12]||(a[12]=f=>$(L).highlights=f),onInput:P,onChange:Me,class:"modern-slider center-zero"},null,544),[[Fe,$(L).highlights,void 0,{number:!0}]])])]),e("div",fd,[e("label",null,[e("span",vd,v(s.$t("editor.filters.shadows","Schatten")),1),e("span",hd,v($(L).shadows>0?"+":"")+v($(L).shadows),1)]),e("div",pd,[ge(e("input",{type:"range",min:"-100",max:"100","onUpdate:modelValue":a[13]||(a[13]=f=>$(L).shadows=f),onInput:P,onChange:Me,class:"modern-slider center-zero"},null,544),[[Fe,$(L).shadows,void 0,{number:!0}]])])]),e("div",md,[e("label",null,[e("span",gd,v(s.$t("editor.filters.hue")),1),e("span",wd,v($(L).hue)+"°",1)]),e("div",bd,[ge(e("input",{type:"range",min:"0",max:"360","onUpdate:modelValue":a[14]||(a[14]=f=>$(L).hue=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).hue,void 0,{number:!0}]])])]),e("div",yd,[e("label",null,[e("span",$d,v(s.$t("editor.filters.sepia","Wärme")),1),e("span",xd,v($(L).sepia)+"%",1)]),e("div",kd,[ge(e("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":a[15]||(a[15]=f=>$(L).sepia=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).sepia,void 0,{number:!0}]])])])],512),[[Ke,$(Ce).lightColor]])],2),e("div",{class:de(["sidebar-section collapsible",{collapsed:!$(Ce).effects}])},[e("h3",{onClick:a[16]||(a[16]=f=>$(Ce).effects=!$(Ce).effects),class:"section-header"},[a[41]||(a[41]=e("i",{class:"fas fa-magic section-icon"},null,-1)),F(" "+v(s.$t("editor.sidebar.effects","Effekte"))+" ",1),e("i",{class:de([$(Ce).effects?"fas fa-chevron-up":"fas fa-chevron-down","toggle-icon"])},null,2)]),ge(e("div",Cd,[e("div",Td,[e("label",null,[e("span",Id,v(s.$t("editor.filters.blur")),1),e("span",Sd,v($(L).blur)+"px",1)]),e("div",Pd,[ge(e("input",{type:"range",min:"0",max:"20",step:"0.5","onUpdate:modelValue":a[17]||(a[17]=f=>$(L).blur=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).blur,void 0,{number:!0}]])])]),e("div",Md,[e("label",null,[e("span",Bd,v(s.$t("editor.filters.vignette","Vignette")),1),e("span",zd,v($(L).vignette)+"%",1)]),e("div",Rd,[ge(e("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":a[18]||(a[18]=f=>$(L).vignette=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).vignette,void 0,{number:!0}]])])]),e("div",Ld,[e("label",null,[e("span",Od,v(s.$t("editor.filters.grayscale","Graustufen")),1),e("span",Ud,v($(L).grayscale)+"%",1)]),e("div",Dd,[ge(e("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":a[19]||(a[19]=f=>$(L).grayscale=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).grayscale,void 0,{number:!0}]])])]),e("div",Fd,[e("label",null,[e("span",Xd,v(s.$t("editor.filters.invert","Invertieren")),1),e("span",Yd,v($(L).invert)+"%",1)]),e("div",Ed,[ge(e("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":a[20]||(a[20]=f=>$(L).invert=f),onInput:P,onChange:Me,class:"modern-slider"},null,544),[[Fe,$(L).invert,void 0,{number:!0}]])])])],512),[[Ke,$(Ce).effects]])],2),e("div",Ad,[e("h3",null,v(s.$t("editor.sidebar.presets")),1),us(ru,{filters:$(L),onApplyPreset:ra},null,8,["filters"])]),e("div",Wd,[e("h3",null,v(s.$t("editor.sidebar.resize")),1),e("div",Hd,[e("div",Nd,[e("label",null,v(s.$t("editor.resize.presets","Presets")),1),e("select",{class:"form-select form-select-sm",onChange:a[21]||(a[21]=f=>{ua(f.target.value),f.target.value=""}),disabled:!y.value},[e("option",Vd,v(s.$t("editor.resize.selectPreset","Preset wählen...")),1),a[42]||(a[42]=Jt('<option value="instagram" data-v-c2ff0642>📷 Instagram Post (1080×1080)</option><option value="instagramStory" data-v-c2ff0642>📱 Instagram Story (1080×1920)</option><option value="facebook" data-v-c2ff0642>👤 Facebook Post (1200×630)</option><option value="twitter" data-v-c2ff0642>🐦 Twitter Post (1200×675)</option><option value="youtube" data-v-c2ff0642>▶️ YouTube Thumbnail (1280×720)</option><option value="hd" data-v-c2ff0642>🖥️ Full HD (1920×1080)</option><option value="4k" data-v-c2ff0642>📺 4K UHD (3840×2160)</option>',7))],40,qd)]),e("div",jd,[e("label",null,v(s.$t("editor.resize.width")),1),ge(e("input",{type:"number","onUpdate:modelValue":a[22]||(a[22]=f=>Ct(j)?j.value=f:null),disabled:!y.value,onChange:a[23]||(a[23]=f=>zt("width"))},null,40,Gd),[[Fe,$(j),void 0,{number:!0}]])]),e("div",Kd,[e("label",null,v(s.$t("editor.resize.height")),1),ge(e("input",{type:"number","onUpdate:modelValue":a[24]||(a[24]=f=>Ct(oe)?oe.value=f:null),disabled:!y.value,onChange:a[25]||(a[25]=f=>zt("height"))},null,40,Jd),[[Fe,$(oe),void 0,{number:!0}]])]),e("label",Qd,[ge(e("input",{type:"checkbox","onUpdate:modelValue":a[26]||(a[26]=f=>Ct(Te)?Te.value=f:null)},null,512),[[Kt,$(Te)]]),F(" "+v(s.$t("editor.resize.maintainAspect")),1)]),e("button",{class:"btn btn-primary",onClick:da,disabled:!y.value},v(s.$t("editor.resize.apply")),9,Zd)])])]),e("div",{class:de(["canvas-area",{"drag-over":Xe.value}]),onDragenter:a[27]||(a[27]=tt(f=>Xe.value=!0,["prevent"])),onDragover:a[28]||(a[28]=tt(f=>Xe.value=!0,["prevent"])),onDragleave:tt(ta,["prevent"]),onDrop:tt(aa,["prevent"])},[!y.value&&!ae.value?(W(),N("div",_d,[a[44]||(a[44]=e("i",{class:"fas fa-image"},null,-1)),e("h2",null,v(s.$t("editor.canvas.empty.title")),1),e("p",null,v(s.$t("editor.canvas.empty.description")),1),e("button",{class:"btn btn-primary btn-large",onClick:Bt},[a[43]||(a[43]=e("i",{class:"fas fa-file-upload"},null,-1)),F(" "+v(s.$t("editor.canvas.empty.button")),1)])])):(W(),N("div",ec,[e("canvas",{ref_key:"canvas",ref:n,class:"main-canvas",style:je({cursor:$(G).cropMode.value?"crosshair":"default"}),onMousedown:Za,onMousemove:_a,onMouseup:es,onDblclick:ts},null,36),$(G).cropping.value&&Ve.value?(W(),N("div",{key:0,class:de(["crop-overlay",{dragging:$(G).isDragging.value,resizing:$(G).isResizing.value}]),style:je(Ve.value)},[...a[45]||(a[45]=[Jt('<div class="resize-handle handle-nw" data-v-c2ff0642></div><div class="resize-handle handle-n" data-v-c2ff0642></div><div class="resize-handle handle-ne" data-v-c2ff0642></div><div class="resize-handle handle-e" data-v-c2ff0642></div><div class="resize-handle handle-se" data-v-c2ff0642></div><div class="resize-handle handle-s" data-v-c2ff0642></div><div class="resize-handle handle-sw" data-v-c2ff0642></div><div class="resize-handle handle-w" data-v-c2ff0642></div><div class="move-indicator" data-v-c2ff0642><i class="fas fa-arrows-alt" data-v-c2ff0642></i></div>',9)])],6)):me("",!0),e("div",tc,[e("span",null,[a[46]||(a[46]=e("i",{class:"fas fa-expand-arrows-alt"},null,-1)),F(" "+v(Ie.value)+" × "+v(xe.value)+"px",1)]),e("span",null,[a[47]||(a[47]=e("i",{class:"fas fa-file"},null,-1)),F(" "+v(va(Qe.value)),1)]),e("span",null,[a[48]||(a[48]=e("i",{class:"fas fa-image"},null,-1)),F(" "+v(fe.value.toUpperCase()),1)])])]))],34),ae.value?(W(),Tt(Kr,{key:0,"canvas-selected-text-id":p.value,onRender:P,onSelectText:Qa,onPreview:ss},null,8,["canvas-selected-text-id"])):y.value?(W(),Tt(rl,{key:1,"crop-mode":$(G).cropMode.value,"has-cropped":$(G).hasCropped.value,"selected-aspect-ratio":$(G).selectedAspectRatio.value,"aspect-ratio-presets":$(dt),transforms:$(b).transforms.value,"can-pan":$(b).canPan.value,"has-pan":$(b).hasPan.value,"selected-text":Ye.value,"has-texts":$(u).texts&&$(u).texts.length>0,"can-undo-text":$(J),"can-redo-text":$(ue),"can-undo-transform":$(b).canUndoTransform.value,"can-redo-transform":$(b).canRedoTransform.value,onToggleCrop:ha,onUndoCrop:pa,onSetAspectRatio:ma,"onUpdate:opacity":ga,"onUpdate:rotation":wa,"onUpdate:scale":ba,"onUpdate:borderRadius":ya,"onUpdate:borderWidth":$a,"onUpdate:borderColor":xa,"onUpdate:shadowEnabled":ka,"onUpdate:shadowOffsetX":Ca,"onUpdate:shadowOffsetY":Ta,"onUpdate:shadowBlur":Ia,"onUpdate:shadowColor":Sa,"onUpdate:shadowOpacity":Pa,"onUpdate:skewX":Ma,"onUpdate:skewY":Ba,onRotate90:Ut,onRotate90Counter:Dt,onRotate180:Ft,onFlipHorizontal:Xt,onFlipVertical:Yt,onResetPan:Ra,onUndoTransform:Et,onRedoTransform:At,onCommitTransform:za,"onUpdate:textContent":Oa,"onUpdate:textFontSize":Ua,"onUpdate:textFontFamily":Da,"onUpdate:textColor":Fa,"onUpdate:textRotation":Xa,"onUpdate:textOpacity":Ya,"onUpdate:textStrokeWidth":Ea,"onUpdate:textStrokeColor":Aa,"onUpdate:textShadowBlur":Wa,"onUpdate:textShadowOffsetX":Ha,"onUpdate:textShadowOffsetY":Na,"onUpdate:textShadowColor":qa,onSaveTextHistory:Ga,onUndoText:Ka,onRedoText:Ja,onDeleteText:Va,onDeselectText:ja},null,8,["crop-mode","has-cropped","selected-aspect-ratio","aspect-ratio-presets","transforms","can-pan","has-pan","selected-text","has-texts","can-undo-text","can-redo-text","can-undo-transform","can-redo-transform"])):me("",!0)])]),(W(),Tt(ds,{to:"body"},[Y.value?(W(),N("div",{key:0,class:"preview-modal-overlay",onClick:Ht},[e("div",{class:"preview-modal-content",onClick:a[29]||(a[29]=tt(()=>{},["stop"]))},[e("button",{class:"preview-close-btn",onClick:Ht},[...a[49]||(a[49]=[e("i",{class:"fas fa-times"},null,-1)])]),e("div",ac,[e("div",sc,[e("h3",null,v(s.$t("editor.preview.before","Before (Original)")),1),M.value?(W(),N("img",{key:0,src:M.value,alt:"Original"},null,8,nc)):(W(),N("div",oc,v(s.$t("editor.preview.noOriginal","No original available")),1))]),a[50]||(a[50]=e("div",{class:"preview-divider"},null,-1)),e("div",lc,[e("h3",null,v(s.$t("editor.preview.after","After (Edited)")),1),B.value?(W(),N("img",{key:0,src:B.value,alt:"Edited"},null,8,ic)):(W(),N("div",rc,v(s.$t("editor.preview.noEdited","No edits available")),1))])])])])):me("",!0)]))]))}},fc=bt(uc,[["__scopeId","data-v-c2ff0642"]]);export{fc as default};
