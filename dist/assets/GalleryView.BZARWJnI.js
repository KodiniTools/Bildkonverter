import{B as u,C as l,G as n,R as m,y as o,L as h,H as b,F as S,E as U,M as H,P as k,O as K,r as C,K as c}from"./vendor.3OznsCWS.js";import{c as W,u as O,b as Z,f as J}from"./index.6CLsGXka.js";import{useGalleryStore as Q}from"./galleryStore.DKHYbofZ.js";const X={class:"gallery-view"},Y={class:"gallery-header"},j={class:"gallery-subtitle"},x={class:"actions-bar"},ee={class:"left-actions"},te=["title"],le={key:1,class:"image-count"},se={key:0,class:"center-actions"},ae={key:1,class:"right-actions"},ne={key:0,class:"empty-state"},oe={key:1,class:"gallery-grid"},ie=["onClick"],re={class:"thumbnail-wrapper"},ce=["src","alt"],ue=["onClick"],de={key:1,class:"selection-indicator"},ge=["onClick","title"],me={class:"image-info"},fe=["title"],he={class:"image-meta"},ye={class:"image-date"},pe={class:"preview-image-container"},ve=["src","alt"],be={class:"preview-info"},Ie={class:"preview-meta"},we={class:"preview-actions"},ke={__name:"GalleryView",setup(Ce){const{t:f}=O({useScope:"global"}),I=J(),s=Q(),A=Z(),$=C(null),d=C(null),g=C(!1);function D(){var e;(e=$.value)==null||e.click()}async function B(e){const t=Array.from(e.target.files);if(t.length!==0){console.log(`Lade ${t.length} Datei(en) hoch...`);for(const a of t)try{await F(a)}catch(i){console.error(`Fehler beim Laden von ${a.name}:`,i),alert(f("gallery.uploadError",{name:a.name})+": "+i.message)}e.target.value=""}}async function F(e){return new Promise((t,a)=>{if(!e.type.startsWith("image/")){a(new Error("Datei ist kein Bild"));return}if(e.size>50*1024*1024){a(new Error("Datei zu groß (max. 50MB)"));return}const i=new FileReader;i.onload=p=>{const r=new Image;r.onload=()=>{const y=_(r,300,300),v={id:Date.now()+Math.random(),name:e.name,url:p.target.result,thumbnail:y,width:r.width,height:r.height,size:e.size,uploadedAt:new Date,file:e};s.addImage(v),t(v)},r.onerror=()=>{a(new Error("Fehler beim Laden des Bildes"))},r.src=p.target.result},i.onerror=()=>{a(new Error("Fehler beim Lesen der Datei"))},i.readAsDataURL(e)})}function _(e,t,a){const i=document.createElement("canvas"),p=i.getContext("2d");let r=e.width,y=e.height;const v=Math.min(t/r,a/y);return r*=v,y*=v,i.width=r,i.height=y,p.drawImage(e,0,0,r,y),i.toDataURL("image/jpeg",.8)}function z(e){d.value=e}function w(){d.value=null}async function L(){const e=s.selectedImage();if(e)try{await I.push({path:"/editor",query:{galleryImageId:e.id}}),console.log("✅ Navigation zum Editor")}catch(t){console.error("Fehler beim Öffnen im Editor:",t),alert("Fehler beim Öffnen im Editor: "+t.message)}}async function q(){if(d.value)try{await I.push({path:"/editor",query:{galleryImageId:d.value.id}}),w()}catch(e){console.error("Fehler beim Öffnen im Editor:",e),alert("Fehler beim Öffnen im Editor: "+e.message)}}function G(){const e=s.selectedImage();!e||!confirm(f("gallery.confirmDelete",{name:e.name}))||s.removeImage(e.id)}function T(){const e=s.images.length;if(e===0)return;const t=f(e===1?"gallery.imageCount.single":"gallery.imageCount.plural"),a=f("gallery.confirmDeleteAll",{count:e,images:t});if(!confirm(a))return;s.images.map(r=>r.id).forEach(r=>{s.removeImage(r)}),console.log(f("gallery.deleteSuccess",{count:e,images:t}))}function V(e){const t=document.createElement("a");t.href=e.url,t.download=e.name,t.click()}function E(e){if(e===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB"],i=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,i)*100)/100+" "+a[i]}function M(e){return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}function P(){g.value=!g.value,g.value||s.deselectAllImages()}function R(e){g.value?s.toggleImageSelection(e):s.selectImage(e)}async function N(){const e=s.selectedImages;if(e.length<2){alert(f("gallery.errors.minTwoImages","Bitte wählen Sie mindestens 2 Bilder aus"));return}try{await A.addImageLayersFromGallery(e),g.value=!1,s.deselectAllImages(),await I.push({path:"/editor",query:{collageMode:"true"}}),console.log(`✅ Collage mit ${e.length} Bildern erstellt`)}catch(t){console.error("Fehler beim Erstellen der Collage:",t),alert(f("gallery.errors.collageError","Fehler beim Erstellen der Collage")+": "+t.message)}}return(e,t)=>(c(),u("div",X,[l("header",Y,[l("h1",null,n(e.$t("gallery.title","Galerie")),1),l("p",j,n(e.$t("gallery.subtitle","Verwalten Sie Ihre Bilder")),1)]),l("div",x,[l("div",ee,[l("button",{class:"btn btn-primary",onClick:D},[t[3]||(t[3]=l("i",{class:"fas fa-upload"},null,-1)),m(" "+n(e.$t("gallery.buttons.upload")),1)]),l("input",{ref_key:"fileInput",ref:$,type:"file",accept:"image/*",multiple:"",onChange:B,style:{display:"none"}},null,544),o(s).images.length>0?(c(),u("button",{key:0,class:"btn btn-danger-outline",onClick:T,title:e.$t("gallery.tooltips.deleteAll")},[t[4]||(t[4]=l("i",{class:"fas fa-trash-alt"},null,-1)),m(" "+n(e.$t("gallery.buttons.deleteAll")),1)],8,te)):h("",!0),o(s).images.length>0?(c(),u("span",le,n(o(s).images.length)+" "+n(o(s).images.length===1?e.$t("gallery.imageCount.single"):e.$t("gallery.imageCount.plural")),1)):h("",!0)]),o(s).images.length>1?(c(),u("div",se,[l("button",{class:"btn btn-secondary-outline",onClick:P},[l("i",{class:b(["fas",g.value?"fa-times":"fa-object-group"])},null,2),m(" "+n(g.value?e.$t("gallery.buttons.cancelSelection","Abbrechen"):e.$t("gallery.buttons.selectMultiple","Mehrfachauswahl")),1)]),g.value?(c(),u(S,{key:0},[l("button",{class:"btn btn-secondary-outline",onClick:t[0]||(t[0]=a=>o(s).selectedImageIds.length===o(s).images.length?o(s).deselectAllImages():o(s).selectAllImages())},[l("i",{class:b(["fas",o(s).selectedImageIds.length===o(s).images.length?"fa-square":"fa-check-square"])},null,2),m(" "+n(o(s).selectedImageIds.length===o(s).images.length?e.$t("gallery.buttons.deselectAll","Alle abwählen"):e.$t("gallery.buttons.selectAll","Alle auswählen")),1)]),o(s).hasMultipleSelected?(c(),u("button",{key:0,class:"btn btn-success",onClick:N},[t[5]||(t[5]=l("i",{class:"fas fa-layer-group"},null,-1)),m(" "+n(e.$t("gallery.buttons.createCollage","Collage erstellen"))+" ("+n(o(s).selectedImageIds.length)+") ",1)])):h("",!0)],64)):h("",!0)])):h("",!0),o(s).selectedImage()&&!g.value?(c(),u("div",ae,[l("button",{class:"btn btn-success",onClick:L},[t[6]||(t[6]=l("i",{class:"fas fa-edit"},null,-1)),m(" "+n(e.$t("gallery.buttons.addToEditor")),1)]),l("button",{class:"btn btn-danger",onClick:G},[t[7]||(t[7]=l("i",{class:"fas fa-trash"},null,-1)),m(" "+n(e.$t("gallery.buttons.delete")),1)])])):h("",!0)]),o(s).images.length===0?(c(),u("div",ne,[t[8]||(t[8]=l("i",{class:"fas fa-images"},null,-1)),l("h3",null,n(e.$t("gallery.empty.title")),1),l("p",null,n(e.$t("gallery.empty.description")),1)])):(c(),u("div",oe,[(c(!0),u(S,null,U(o(s).images,a=>(c(),u("div",{key:a.id,class:b(["gallery-item",{selected:!g.value&&o(s).selectedImageId===a.id,"multi-selected":g.value&&o(s).isImageSelected(a.id)}]),onClick:i=>R(a.id)},[l("div",re,[l("img",{src:a.thumbnail,alt:a.name,class:"thumbnail"},null,8,ce),g.value?(c(),u("div",{key:0,class:"multi-select-checkbox",onClick:k(i=>o(s).toggleImageSelection(a.id),["stop"])},[l("i",{class:b(["fas",o(s).isImageSelected(a.id)?"fa-check-square":"fa-square"])},null,2)],8,ue)):(c(),u("div",de,[l("i",{class:b(["fas",o(s).selectedImageId===a.id?"fa-check-circle":"fa-circle"])},null,2)])),l("button",{class:"preview-btn",onClick:k(i=>z(a),["stop"]),title:e.$t("gallery.buttons.preview")},[...t[9]||(t[9]=[l("i",{class:"fas fa-search-plus"},null,-1)])],8,ge)]),l("div",me,[l("div",{class:"image-name",title:a.name},n(a.name),9,fe),l("div",he,[l("span",null,n(a.width)+" × "+n(a.height)+"px",1),l("span",null,n(E(a.size)),1)]),l("div",ye,n(M(a.uploadedAt)),1)])],10,ie))),128))])),(c(),H(K,{to:"body"},[d.value?(c(),u("div",{key:0,class:"preview-overlay",onClick:w},[l("div",{class:"preview-content",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[l("button",{class:"preview-close",onClick:w},[...t[10]||(t[10]=[l("i",{class:"fas fa-times"},null,-1)])]),l("div",pe,[l("img",{src:d.value.url,alt:d.value.name},null,8,ve)]),l("div",be,[l("h3",null,n(d.value.name),1),l("div",Ie,[l("span",null,[t[11]||(t[11]=l("i",{class:"fas fa-ruler-combined"},null,-1)),m(" "+n(d.value.width)+" × "+n(d.value.height)+"px",1)]),l("span",null,[t[12]||(t[12]=l("i",{class:"fas fa-file"},null,-1)),m(" "+n(E(d.value.size)),1)]),l("span",null,[t[13]||(t[13]=l("i",{class:"fas fa-calendar"},null,-1)),m(" "+n(M(d.value.uploadedAt)),1)])])]),l("div",we,[l("button",{class:"btn btn-success",onClick:q},[...t[14]||(t[14]=[l("i",{class:"fas fa-edit"},null,-1),m(" Zum Editor hinzufügen ",-1)])]),l("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=a=>V(d.value))},[...t[15]||(t[15]=[l("i",{class:"fas fa-download"},null,-1),m(" Herunterladen ",-1)])])])])])):h("",!0)]))]))}},Se=W(ke,[["__scopeId","data-v-638e5401"]]);export{Se as default};
